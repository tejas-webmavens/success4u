Object.defineProperty&&Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(Element.prototype,"textContent")&&!Object.getOwnPropertyDescriptor(Element.prototype,"textContent").get&&!function(){var a=Object.getOwnPropertyDescriptor(Element.prototype,"innerText");Object.defineProperty(Element.prototype,"textContent",{get:function(){return a.get.call(this)},set:function(b){return a.set.call(this,b)}})}(),Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)});var wysihtml5={version:"0.4.15",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},INVISIBLE_SPACE:"\ufeff",EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,DELETE_KEY:46};!function(a,b){"function"==typeof define&&define.amd?define(a):b.rangy=a()}(function(){function h(c,d){var e=typeof c[d];return e==b||!(e!=a||!c[d])||"unknown"==e}function i(b,c){return!(typeof b[c]!=a||!b[c])}function j(a,b){return typeof a[b]!=c}function k(a){return function(b,c){for(var d=c.length;d--;)if(!a(b,c[d]))return!1;return!0}}function o(a){return a&&l(a,g)&&n(a,f)}function p(a){return i(a,"body")?a.body:a.getElementsByTagName("body")[0]}function s(a){i(window,"console")&&h(window.console,"log")&&window.console.log(a)}function t(a,b){b?window.alert(a):s(a)}function u(a){r.initialized=!0,r.supported=!1,t("Rangy is not supported on this page in your browser. Reason: "+a,r.config.alertOnFail)}function v(a){t("Rangy warning: "+a,r.config.alertOnWarn)}function y(a){return a.message||a.description||String(a)}function z(){if(!r.initialized){var a,b=!1,c=!1;h(document,"createRange")&&(a=document.createRange(),l(a,e)&&n(a,d)&&(b=!0));var f=p(document);if(!f||"body"!=f.nodeName.toLowerCase())return void u("No body element found");if(f&&h(f,"createTextRange")&&(a=f.createTextRange(),o(a)&&(c=!0)),!b&&!c)return void u("Neither Range nor TextRange are available");r.initialized=!0,r.features={implementsDomRange:b,implementsTextRange:c};var g,i;for(var j in q)(g=q[j])instanceof C&&g.init(g,r);for(var k=0,m=x.length;k<m;++k)try{x[k](r)}catch(a){i="Rangy init listener threw an exception. Continuing. Detail: "+y(a),s(i)}}}function B(a){a=a||window,z();for(var b=0,c=A.length;b<c;++b)A[b](a)}function C(a,b,c){this.name=a,this.dependencies=b,this.initialized=!1,this.supported=!1,this.initializer=c}function D(a,b,c,d){var e=new C(b,c,function(a){if(!a.initialized){a.initialized=!0;try{d(r,a),a.supported=!0}catch(a){var c="Module '"+b+"' failed to load: "+y(a);s(c)}}});q[b]=e}function E(){}function F(){}var a="object",b="function",c="undefined",d=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],e=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],f=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],g=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],l=k(h),m=k(i),n=k(j),q={},r={version:"1.3alpha.20140804",initialized:!1,supported:!0,util:{isHostMethod:h,isHostObject:i,isHostProperty:j,areHostMethods:l,areHostObjects:m,areHostProperties:n,isTextRange:o,getBody:p},features:{},modules:q,config:{alertOnFail:!0,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==c||rangyAutoInitialize}};r.fail=u,r.warn=v,{}.hasOwnProperty?r.util.extend=function(a,b,c){var d,e;for(var f in b)b.hasOwnProperty(f)&&(d=a[f],e=b[f],c&&null!==d&&"object"==typeof d&&null!==e&&"object"==typeof e&&r.util.extend(d,e,!0),a[f]=e);return b.hasOwnProperty("toString")&&(a.toString=b.toString),a}:u("hasOwnProperty not supported"),function(){var a=document.createElement("div");a.appendChild(document.createElement("span"));var c,b=[].slice;try{1==b.call(a.childNodes,0)[0].nodeType&&(c=function(a){return b.call(a,0)})}catch(a){}c||(c=function(a){for(var b=[],c=0,d=a.length;c<d;++c)b[c]=a[c];return b}),r.util.toArray=c}();var w;h(document,"addEventListener")?w=function(a,b,c){a.addEventListener(b,c,!1)}:h(document,"attachEvent")?w=function(a,b,c){a.attachEvent("on"+b,c)}:u("Document does not have required addEventListener or attachEvent method"),r.util.addListener=w;var x=[];r.init=z,r.addInitListener=function(a){r.initialized?a(r):x.push(a)};var A=[];r.addShimListener=function(a){A.push(a)},r.shim=r.createMissingNativeApi=B,C.prototype={init:function(){for(var d,e,a=this.dependencies||[],b=0,c=a.length;b<c;++b){if(e=a[b],d=q[e],!(d&&d instanceof C))throw new Error("required module '"+e+"' not found");if(d.init(),!d.supported)throw new Error("required module '"+e+"' not supported")}this.initializer(this)},fail:function(a){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+a)},warn:function(a){r.warn("Module "+this.name+": "+a)},deprecationNotice:function(a,b){r.warn("DEPRECATED: "+a+" in module "+this.name+"is deprecated. Please use "+b+" instead")},createError:function(a){return new Error("Error in Rangy "+this.name+" module: "+a)}},r.createModule=function(a){var b,c;2==arguments.length?(b=arguments[1],c=[]):(b=arguments[2],c=arguments[1]);var d=D(!1,a,c,b);r.initialized&&d.init()},r.createCoreModule=function(a,b,c){D(!0,a,b,c)},r.RangePrototype=E,r.rangePrototype=new E,r.selectionPrototype=new F;var G=!1,H=function(a){G||(G=!0,!r.initialized&&r.config.autoInitialize&&z())};return typeof window==c?void u("No window found"):typeof document==c?void u("No document found"):(h(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",H,!1),w(window,"load",H),r.createCoreModule("DomUtil",[],function(a,b){function h(a){var b;return typeof a.namespaceURI==c||null===(b=a.namespaceURI)||"http://www.w3.org/1999/xhtml"==b}function i(a){var b=a.parentNode;return 1==b.nodeType?b:null}function j(a){for(var b=0;a=a.previousSibling;)++b;return b}function k(a){switch(a.nodeType){case 7:case 10:return 0;case 3:case 8:return a.length;default:return a.childNodes.length}}function l(a,b){var d,c=[];for(d=a;d;d=d.parentNode)c.push(d);for(d=b;d;d=d.parentNode)if(g(c,d))return d;return null}function m(a,b,c){for(var d=c?b:b.parentNode;d;){if(d===a)return!0;d=d.parentNode}return!1}function n(a,b){return m(a,b,!0)}function o(a,b,c){for(var d,e=c?a:a.parentNode;e;){if(d=e.parentNode,d===b)return e;e=d}return null}function p(a){var b=a.nodeType;return 3==b||4==b||8==b}function q(a){if(!a)return!1;var b=a.nodeType;return 3==b||8==b}function r(a,b){var c=b.nextSibling,d=b.parentNode;return c?d.insertBefore(a,c):d.appendChild(a),a}function s(a,b,c){var d=a.cloneNode(!1);if(d.deleteData(0,b),a.deleteData(b,a.length-b),r(d,a),c)for(var f,e=0;f=c[e++];)f.node==a&&f.offset>b?(f.node=d,f.offset-=b):f.node==a.parentNode&&f.offset>j(a)&&++f.offset;return d}function t(a){if(9==a.nodeType)return a;if(typeof a.ownerDocument!=c)return a.ownerDocument;if(typeof a.document!=c)return a.document;if(a.parentNode)return t(a.parentNode);throw b.createError("getDocument: no document found for node")}function u(a){var d=t(a);if(typeof d.defaultView!=c)return d.defaultView;if(typeof d.parentWindow!=c)return d.parentWindow;throw b.createError("Cannot get a window object for node")}function v(a){if(typeof a.contentDocument!=c)return a.contentDocument;if(typeof a.contentWindow!=c)return a.contentWindow.document;throw b.createError("getIframeDocument: No Document object found for iframe element")}function w(a){if(typeof a.contentWindow!=c)return a.contentWindow;if(typeof a.contentDocument!=c)return a.contentDocument.defaultView;throw b.createError("getIframeWindow: No Window object found for iframe element")}function x(a){return a&&d.isHostMethod(a,"setTimeout")&&d.isHostObject(a,"document")}function y(a,b,c){var e;if(a?d.isHostProperty(a,"nodeType")?e=1==a.nodeType&&"iframe"==a.tagName.toLowerCase()?v(a):t(a):x(a)&&(e=a.document):e=document,!e)throw b.createError(c+"(): Parameter must be a Window object or DOM node");return e}function z(a){for(var b;b=a.parentNode;)a=b;return a}function A(a,c,d,e){var f,g,h,i,k;if(a==d)return c===e?0:c<e?-1:1;if(f=o(d,a,!0))return c<=j(f)?-1:1;if(f=o(a,d,!0))return j(f)<e?-1:1;if(g=l(a,d),!g)throw new Error("comparePoints error: nodes have no common ancestor");if(h=a===g?g:o(a,g,!0),i=d===g?g:o(d,g,!0),h===i)throw b.createError("comparePoints got to case 4 and childA and childB are the same!");for(k=g.firstChild;k;){if(k===h)return-1;if(k===i)return 1;k=k.nextSibling}}function C(a){var b;try{return b=a.parentNode,!1}catch(a){return!0}}function D(a){if(!a)return"[No node]";if(B&&C(a))return"[Broken node]";if(p(a))return'"'+a.data+'"';if(1==a.nodeType){var b=a.id?' id="'+a.id+'"':"";return"<"+a.nodeName+b+">[index:"+j(a)+",length:"+a.childNodes.length+"]["+(a.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return a.nodeName}function E(a){for(var c,b=t(a).createDocumentFragment();c=a.firstChild;)b.appendChild(c);return b}function G(a){this.root=a,this._next=a}function H(a){return new G(a)}function I(a,b){this.node=a,this.offset=b}function J(a){this.code=this[a],this.codeName=a,this.message="DOMException: "+this.codeName}var c="undefined",d=a.util;d.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||b.fail("document missing a Node creation method"),d.isHostMethod(document,"getElementsByTagName")||b.fail("document missing getElementsByTagName method");var e=document.createElement("div");d.areHostMethods(e,["insertBefore","appendChild","cloneNode"]||!d.areHostObjects(e,["previousSibling","nextSibling","childNodes","parentNode"]))||b.fail("Incomplete Element implementation"),d.isHostProperty(e,"innerHTML")||b.fail("Element is missing innerHTML property");var f=document.createTextNode("test");d.areHostMethods(f,["splitText","deleteData","insertData","appendData","cloneNode"]||!d.areHostObjects(e,["previousSibling","nextSibling","childNodes","parentNode"])||!d.areHostProperties(f,["data"]))||b.fail("Incomplete Text Node implementation");var g=function(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1},B=!1;!function(){var b=document.createElement("b");b.innerHTML="1";var c=b.firstChild;b.innerHTML="<br>",B=C(c),a.features.crashyTextNodes=B}();var F;typeof window.getComputedStyle!=c?F=function(a,b){return u(a).getComputedStyle(a,null)[b]}:typeof document.documentElement.currentStyle!=c?F=function(a,b){return a.currentStyle[b]}:b.fail("No means of obtaining computed style properties found"),G.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var b,c,a=this._current=this._next;if(this._current)if(b=a.firstChild)this._next=b;else{for(c=null;a!==this.root&&!(c=a.nextSibling);)a=a.parentNode;this._next=c}return this._current},detach:function(){this._current=this._next=this.root=null}},I.prototype={equals:function(a){return!!a&&this.node===a.node&&this.offset==a.offset},inspect:function(){return"[DomPosition("+D(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},J.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},J.prototype.toString=function(){return this.message},a.dom={arrayContains:g,isHtmlNamespace:h,parentElement:i,getNodeIndex:j,getNodeLength:k,getCommonAncestor:l,isAncestorOf:m,isOrIsAncestorOf:n,getClosestAncestorIn:o,isCharacterDataNode:p,isTextOrCommentNode:q,insertAfter:r,splitDataNode:s,getDocument:t,getWindow:u,getIframeWindow:w,getIframeDocument:v,getBody:d.getBody,isWindow:x,getContentDocument:y,getRootContainer:z,comparePoints:A,isBrokenNode:C,inspectNode:D,getComputedStyleProperty:F,fragmentFromNodeChildren:E,createIterator:H,DomPosition:I},a.DOMException=J}),r.createCoreModule("DomRange",["DomUtil"],function(a,b){function r(a,b){return 3!=a.nodeType&&(i(a,b.startContainer)||i(a,b.endContainer))}function s(a){return a.document||j(a.startContainer)}function t(a){return new e(a.parentNode,h(a))}function u(a){return new e(a.parentNode,h(a)+1)}function v(a,b,d){var e=11==a.nodeType?a.firstChild:a;return g(b)?d==b.length?c.insertAfter(a,b):b.parentNode.insertBefore(a,0==d?b:l(b,d)):d>=b.childNodes.length?b.appendChild(a):b.insertBefore(a,b.childNodes[d]),e}function w(a,b,c){if(W(a),W(b),s(b)!=s(a))throw new f("WRONG_DOCUMENT_ERR");var d=k(a.startContainer,a.startOffset,b.endContainer,b.endOffset),e=k(a.endContainer,a.endOffset,b.startContainer,b.startOffset);return c?d<=0&&e>=0:d<0&&e>0}function x(a){for(var b,c,e,d=s(a.range).createDocumentFragment();c=a.next();){if(b=a.isPartiallySelectedSubtree(),c=c.cloneNode(!b),b&&(e=a.getSubtreeIterator(),c.appendChild(x(e)),e.detach()),10==c.nodeType)throw new f("HIERARCHY_REQUEST_ERR");d.appendChild(c)}return d}function y(a,b,d){var e,f;d=d||{stop:!1};for(var g,h;g=a.next();)if(a.isPartiallySelectedSubtree()){if(b(g)===!1)return void(d.stop=!0);if(h=a.getSubtreeIterator(),y(h,b,d),h.detach(),d.stop)return}else for(e=c.createIterator(g);f=e.next();)if(b(f)===!1)return void(d.stop=!0)}function z(a){for(var b;a.next();)a.isPartiallySelectedSubtree()?(b=a.getSubtreeIterator(),z(b),b.detach()):a.remove()}function A(a){for(var b,d,c=s(a.range).createDocumentFragment();b=a.next();){if(a.isPartiallySelectedSubtree()?(b=b.cloneNode(!1),d=a.getSubtreeIterator(),b.appendChild(A(d)),d.detach()):a.remove(),10==b.nodeType)throw new f("HIERARCHY_REQUEST_ERR");c.appendChild(b)}return c}function B(a,b,c){var e,d=!(!b||!b.length),f=!!c;d&&(e=new RegExp("^("+b.join("|")+")$"));var h=[];return y(new D(a,!1),function(b){if((!d||e.test(b.nodeType))&&(!f||c(b))){var i=a.startContainer;if(b!=i||!g(i)||a.startOffset!=i.length){var j=a.endContainer;b==j&&g(j)&&0==a.endOffset||h.push(b)}}}),h}function C(a){var b="undefined"==typeof a.getName?"Range":a.getName();return"["+b+"("+c.inspectNode(a.startContainer)+":"+a.startOffset+", "+c.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function D(a,b){if(this.range=a,this.clonePartiallySelectedTextNodes=b,!a.collapsed){this.sc=a.startContainer,this.so=a.startOffset,this.ec=a.endContainer,this.eo=a.endOffset;var c=a.commonAncestorContainer;this.sc===this.ec&&g(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==c||g(this.sc)?m(this.sc,c,!0):this.sc.childNodes[this.so],this._last=this.ec!==c||g(this.ec)?m(this.ec,c,!0):this.ec.childNodes[this.eo-1])}}function J(a){return function(b,c){for(var d,e=c?b:b.parentNode;e;){if(d=e.nodeType,o(a,d))return e;e=e.parentNode}return null}}function N(a,b){if(M(a,b))throw new f("INVALID_NODE_TYPE_ERR")}function O(a,b){if(!o(b,a.nodeType))throw new f("INVALID_NODE_TYPE_ERR")}function P(a,b){if(b<0||b>(g(a)?a.length:a.childNodes.length))throw new f("INDEX_SIZE_ERR")}function Q(a,b){if(K(a,!0)!==K(b,!0))throw new f("WRONG_DOCUMENT_ERR")}function R(a){if(L(a,!0))throw new f("NO_MODIFICATION_ALLOWED_ERR")}function S(a,b){if(!a)throw new f(b)}function T(a){return q&&c.isBrokenNode(a)||!o(F,a.nodeType)&&!K(a,!0)}function U(a,b){return b<=(g(a)?a.length:a.childNodes.length)}function V(a){return!!a.startContainer&&!!a.endContainer&&!T(a.startContainer)&&!T(a.endContainer)&&U(a.startContainer,a.startOffset)&&U(a.endContainer,a.endOffset)}function W(a){if(!V(a))throw new Error("Range error: Range is no longer valid after DOM mutation ("+a.inspect()+")")}function $(a,b){W(a);var c=a.startContainer,d=a.startOffset,e=a.endContainer,f=a.endOffset,i=c===e;g(e)&&f>0&&f<e.length&&l(e,f,b),g(c)&&d>0&&d<c.length&&(c=l(c,d,b),i?(f-=d,e=c):e==c.parentNode&&f>=h(c)&&f++,d=0),a.setStartAndEnd(c,d,e,f)}function _(a){W(a);var b=a.commonAncestorContainer.parentNode.cloneNode(!1);return b.appendChild(a.cloneContents()),b.innerHTML}function ja(a){a.START_TO_START=ba,a.START_TO_END=ca,a.END_TO_END=da,a.END_TO_START=ea,a.NODE_BEFORE=fa,a.NODE_AFTER=ga,a.NODE_BEFORE_AND_AFTER=ha,a.NODE_INSIDE=ia}function ka(a){ja(a),ja(a.prototype)}function la(a,b){return function(){W(this);var g,h,c=this.startContainer,d=this.startOffset,e=this.commonAncestorContainer,f=new D(this,!0);c!==e&&(g=m(c,e,!0),h=u(g),c=h.node,d=h.offset),y(f,R),f.reset();var i=a(f);return f.detach(),b(this,c,d,c,d),i}}function ma(b,c){function e(a,b){return function(c){O(c,E),O(p(c),F);var d=(a?t:u)(c);(b?f:i)(this,d.node,d.offset)}}function f(a,b,d){var e=a.endContainer,f=a.endOffset;b===a.startContainer&&d===a.startOffset||(p(b)==p(e)&&1!=k(b,d,e,f)||(e=b,f=d),c(a,b,d,e,f))}function i(a,b,d){var e=a.startContainer,f=a.startOffset;b===a.endContainer&&d===a.endOffset||(p(b)==p(e)&&k(b,d,e,f)!=-1||(e=b,f=d),c(a,e,f,b,d))}var j=function(){};j.prototype=a.rangePrototype,b.prototype=new j,d.extend(b.prototype,{setStart:function(a,b){N(a,!0),P(a,b),f(this,a,b)},setEnd:function(a,b){N(a,!0),P(a,b),i(this,a,b)},setStartAndEnd:function(){var a=arguments,b=a[0],d=a[1],e=b,f=d;switch(a.length){case 3:f=a[2];break;case 4:e=a[2],f=a[3]}c(this,b,d,e,f)},setBoundary:function(a,b,c){this["set"+(c?"Start":"End")](a,b)},setStartBefore:e(!0,!0),setStartAfter:e(!1,!0),setEndBefore:e(!0,!1),setEndAfter:e(!1,!1),collapse:function(a){W(this),a?c(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):c(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){N(a,!0),c(this,a,0,a,n(a))},selectNode:function(a){N(a,!1),O(a,E);var b=t(a),d=u(a);c(this,b.node,b.offset,d.node,d.offset)},extractContents:la(A,c),deleteContents:la(z,c),canSurroundContents:function(){W(this),R(this.startContainer),R(this.endContainer);var a=new D(this,!0),b=a._first&&r(a._first,this)||a._last&&r(a._last,this);return a.detach(),!b},splitBoundaries:function(){$(this)},splitBoundariesPreservingPositions:function(a){$(this,a)},normalizeBoundaries:function(){W(this);var a=this.startContainer,b=this.startOffset,d=this.endContainer,e=this.endOffset,f=function(a){var b=a.nextSibling;b&&b.nodeType==a.nodeType&&(d=a,e=a.length,a.appendData(b.data),b.parentNode.removeChild(b))},i=function(c){var f=c.previousSibling;if(f&&f.nodeType==c.nodeType){a=c;var g=c.length;if(b=f.length,c.insertData(0,f.data),f.parentNode.removeChild(f),a==d)e+=b,d=a;else if(d==c.parentNode){var i=h(c);e==i?(d=c,e=g):e>i&&e--}}},j=!0;if(g(d))d.length==e&&f(d);else{if(e>0){var k=d.childNodes[e-1];k&&g(k)&&f(k)}j=!this.collapsed}if(j){if(g(a))0==b&&i(a);else if(b<a.childNodes.length){var l=a.childNodes[b];l&&g(l)&&i(l)}}else a=d,b=e;c(this,a,b,d,e)},collapseToPoint:function(a,b){N(a,!0),P(a,b),this.setStartAndEnd(a,b)}}),ka(b)}function na(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset,a.commonAncestorContainer=a.collapsed?a.startContainer:c.getCommonAncestor(a.startContainer,a.endContainer)}function oa(a,b,d,e,f){a.startContainer=b,a.startOffset=d,a.endContainer=e,a.endOffset=f,a.document=c.getDocument(b),na(a)}function pa(a){this.startContainer=a,this.startOffset=0,this.endContainer=a,this.endOffset=0,this.document=a,na(this)}var c=a.dom,d=a.util,e=c.DomPosition,f=a.DOMException,g=c.isCharacterDataNode,h=c.getNodeIndex,i=c.isOrIsAncestorOf,j=c.getDocument,k=c.comparePoints,l=c.splitDataNode,m=c.getClosestAncestorIn,n=c.getNodeLength,o=c.arrayContains,p=c.getRootContainer,q=a.features.crashyTextNodes;D.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next;return a&&(this._next=a!==this._last?a.nextSibling:null,g(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so))),a},remove:function(){var b,c,a=this._current;!g(a)||a!==this.sc&&a!==this.ec?a.parentNode&&a.parentNode.removeChild(a):(b=a===this.sc?this.so:0,c=a===this.ec?this.eo:a.length,b!=c&&a.deleteData(b,c-b))},isPartiallySelectedSubtree:function(){var a=this._current;return r(a,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode)a=this.range.cloneRange(),a.collapse(!1);else{a=new pa(s(this.range));var b=this._current,c=b,d=0,e=b,f=n(b);i(b,this.sc)&&(c=this.sc,d=this.so),i(b,this.ec)&&(e=this.ec,f=this.eo),oa(a,c,d,e,f)}return new D(a,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var E=[1,3,4,5,7,8,10],F=[2,9,11],G=[5,6,10,12],H=[1,3,4,5,7,8,10,11],I=[1,3,4,5,7,8],K=J([9,11]),L=J(G),M=J([6,10,12]),X=document.createElement("style"),Y=!1;try{X.innerHTML="<b>x</b>",Y=3==X.firstChild.nodeType}catch(a){}a.features.htmlParsingConforms=Y;var Z=Y?function(a){var b=this.startContainer,d=j(b);if(!b)throw new f("INVALID_STATE_ERR");var e=null;return 1==b.nodeType?e=b:g(b)&&(e=c.parentElement(b)),e=null===e||"HTML"==e.nodeName&&c.isHtmlNamespace(j(e).documentElement)&&c.isHtmlNamespace(e)?d.createElement("body"):e.cloneNode(!1),e.innerHTML=a,c.fragmentFromNodeChildren(e)}:function(a){var b=s(this),d=b.createElement("body");return d.innerHTML=a,c.fragmentFromNodeChildren(d)},aa=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],ba=0,ca=1,da=2,ea=3,fa=0,ga=1,ha=2,ia=3;d.extend(a.rangePrototype,{compareBoundaryPoints:function(a,b){W(this),Q(this.startContainer,b.startContainer);var c,d,e,f,g=a==ea||a==ba?"start":"end",h=a==ca||a==ba?"start":"end";return c=this[g+"Container"],d=this[g+"Offset"],e=b[h+"Container"],f=b[h+"Offset"],k(c,d,e,f)},insertNode:function(a){if(W(this),O(a,H),R(this.startContainer),i(a,this.startContainer))throw new f("HIERARCHY_REQUEST_ERR");var b=v(a,this.startContainer,this.startOffset);this.setStartBefore(b)},cloneContents:function(){W(this);var a,b;if(this.collapsed)return s(this).createDocumentFragment();if(this.startContainer===this.endContainer&&g(this.startContainer))return a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),b=s(this).createDocumentFragment(),b.appendChild(a),b;var c=new D(this,!0);return a=x(c),c.detach(),a},canSurroundContents:function(){W(this),R(this.startContainer),R(this.endContainer);var a=new D(this,!0),b=a._first&&r(a._first,this)||a._last&&r(a._last,this);return a.detach(),!b},surroundContents:function(a){if(O(a,I),!this.canSurroundContents())throw new f("INVALID_STATE_ERR");var b=this.extractContents();if(a.hasChildNodes())for(;a.lastChild;)a.removeChild(a.lastChild);v(a,this.startContainer,this.startOffset),a.appendChild(b),this.selectNode(a)},cloneRange:function(){W(this);for(var c,a=new pa(s(this)),b=aa.length;b--;)c=aa[b],a[c]=this[c];return a},toString:function(){W(this);var a=this.startContainer;if(a===this.endContainer&&g(a))return 3==a.nodeType||4==a.nodeType?a.data.slice(this.startOffset,this.endOffset):"";var b=[],c=new D(this,!0);return y(c,function(a){3!=a.nodeType&&4!=a.nodeType||b.push(a.data)}),c.detach(),b.join("")},compareNode:function(a){W(this);var b=a.parentNode,c=h(a);if(!b)throw new f("NOT_FOUND_ERR");var d=this.comparePoint(b,c),e=this.comparePoint(b,c+1);return d<0?e>0?ha:fa:e>0?ga:ia},comparePoint:function(a,b){return W(this),S(a,"HIERARCHY_REQUEST_ERR"),Q(a,this.startContainer),k(a,b,this.startContainer,this.startOffset)<0?-1:k(a,b,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:Z,toHtml:function(){return _(this)},intersectsNode:function(a,b){if(W(this),S(a,"NOT_FOUND_ERR"),j(a)!==s(this))return!1;var c=a.parentNode,d=h(a);S(c,"NOT_FOUND_ERR");var e=k(c,d,this.endContainer,this.endOffset),f=k(c,d+1,this.startContainer,this.startOffset);return b?e<=0&&f>=0:e<0&&f>0},isPointInRange:function(a,b){return W(this),S(a,"HIERARCHY_REQUEST_ERR"),Q(a,this.startContainer),k(a,b,this.startContainer,this.startOffset)>=0&&k(a,b,this.endContainer,this.endOffset)<=0},intersectsRange:function(a){return w(this,a,!1)},intersectsOrTouchesRange:function(a){return w(this,a,!0)},intersection:function(a){if(this.intersectsRange(a)){var b=k(this.startContainer,this.startOffset,a.startContainer,a.startOffset),c=k(this.endContainer,this.endOffset,a.endContainer,a.endOffset),d=this.cloneRange();return b==-1&&d.setStart(a.startContainer,a.startOffset),1==c&&d.setEnd(a.endContainer,a.endOffset),d}return null},union:function(a){if(this.intersectsOrTouchesRange(a)){var b=this.cloneRange();return k(a.startContainer,a.startOffset,this.startContainer,this.startOffset)==-1&&b.setStart(a.startContainer,a.startOffset),1==k(a.endContainer,a.endOffset,this.endContainer,this.endOffset)&&b.setEnd(a.endContainer,a.endOffset),b}throw new f("Ranges do not intersect")},containsNode:function(a,b){return b?this.intersectsNode(a,!1):this.compareNode(a)==ia},containsNodeContents:function(a){return this.comparePoint(a,0)>=0&&this.comparePoint(a,n(a))<=0},containsRange:function(a){var b=this.intersection(a);return null!==b&&a.equals(b)},containsNodeText:function(a){var b=this.cloneRange();b.selectNode(a);var c=b.getNodes([3]);if(c.length>0){b.setStart(c[0],0);var d=c.pop();return b.setEnd(d,d.length),this.containsRange(b)}return this.containsNodeContents(a)},getNodes:function(a,b){return W(this),B(this,a,b)},getDocument:function(){return s(this)},collapseBefore:function(a){this.setEndBefore(a),this.collapse(!1)},collapseAfter:function(a){this.setStartAfter(a),this.collapse(!0)},getBookmark:function(b){var d=s(this),e=a.createRange(d);b=b||c.getBody(d),e.selectNodeContents(b);var f=this.intersection(e),g=0,h=0;return f&&(e.setEnd(f.startContainer,f.startOffset),g=e.toString().length,h=g+f.toString().length),{start:g,end:h,containerNode:b}},moveToBookmark:function(a){var b=a.containerNode,c=0;this.setStart(b,0),this.collapse(!0);for(var e,h,i,j,d=[b],f=!1,g=!1;!g&&(e=d.pop());)if(3==e.nodeType)h=c+e.length,!f&&a.start>=c&&a.start<=h&&(this.setStart(e,a.start-c),f=!0),f&&a.end>=c&&a.end<=h&&(this.setEnd(e,a.end-c),g=!0),c=h;else for(j=e.childNodes,i=j.length;i--;)d.push(j[i])},getName:function(){return"DomRange"},equals:function(a){return pa.rangesEqual(this,a)},isValid:function(){return V(this)},inspect:function(){return C(this)},detach:function(){}}),ma(pa,oa),d.extend(pa,{rangeProperties:aa,RangeIterator:D,copyComparisonConstants:ka,createPrototypeRange:ma,inspect:C,toHtml:_,getRangeDocument:s,rangesEqual:function(a,b){return a.startContainer===b.startContainer&&a.startOffset===b.startOffset&&a.endContainer===b.endContainer&&a.endOffset===b.endOffset}}),a.DomRange=pa}),r.createCoreModule("WrappedRange",["DomRange"],function(a,b){var c,d,e=a.dom,f=a.util,g=e.DomPosition,h=a.DomRange,i=e.getBody,j=e.getContentDocument,k=e.isCharacterDataNode;if(a.features.implementsDomRange&&!function(){function k(a){for(var c,b=g.length;b--;)c=g[b],a[c]=a.nativeRange[c];a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset}function l(a,b,c,d,e){var f=a.startContainer!==b||a.startOffset!=c,g=a.endContainer!==d||a.endOffset!=e,h=!a.equals(a.nativeRange);(f||g||h)&&(a.setEnd(d,e),a.setStart(b,c))}var d,m,g=h.rangeProperties;c=function(a){if(!a)throw b.createError("WrappedRange: Range must be specified");this.nativeRange=a,k(this)},h.createPrototypeRange(c,l),d=c.prototype,d.selectNode=function(a){this.nativeRange.selectNode(a),k(this)},d.cloneContents=function(){return this.nativeRange.cloneContents()},d.surroundContents=function(a){this.nativeRange.surroundContents(a),k(this)},d.collapse=function(a){this.nativeRange.collapse(a),k(this)},d.cloneRange=function(){return new c(this.nativeRange.cloneRange())},d.refresh=function(){k(this)},d.toString=function(){return this.nativeRange.toString()};var n=document.createTextNode("test");i(document).appendChild(n);var o=document.createRange();o.setStart(n,0),o.setEnd(n,0);try{o.setStart(n,1),d.setStart=function(a,b){this.nativeRange.setStart(a,b),k(this)},d.setEnd=function(a,b){this.nativeRange.setEnd(a,b),k(this)},m=function(a){return function(b){this.nativeRange[a](b),k(this)}}}catch(a){d.setStart=function(a,b){try{this.nativeRange.setStart(a,b)}catch(c){this.nativeRange.setEnd(a,b),this.nativeRange.setStart(a,b)}k(this)},d.setEnd=function(a,b){try{this.nativeRange.setEnd(a,b)}catch(c){this.nativeRange.setStart(a,b),this.nativeRange.setEnd(a,b)}k(this)},m=function(a,b){return function(c){try{this.nativeRange[a](c)}catch(d){this.nativeRange[b](c),this.nativeRange[a](c)}k(this)}}}d.setStartBefore=m("setStartBefore","setEndBefore"),d.setStartAfter=m("setStartAfter","setEndAfter"),d.setEndBefore=m("setEndBefore","setStartBefore"),d.setEndAfter=m("setEndAfter","setStartAfter"),d.selectNodeContents=function(a){this.setStartAndEnd(a,0,e.getNodeLength(a))},o.selectNodeContents(n),o.setEnd(n,3);var p=document.createRange();p.selectNodeContents(n),p.setEnd(n,4),p.setStart(n,2),o.compareBoundaryPoints(o.START_TO_END,p)==-1&&1==o.compareBoundaryPoints(o.END_TO_START,p)?d.compareBoundaryPoints=function(a,b){return b=b.nativeRange||b,a==b.START_TO_END?a=b.END_TO_START:a==b.END_TO_START&&(a=b.START_TO_END),this.nativeRange.compareBoundaryPoints(a,b)}:d.compareBoundaryPoints=function(a,b){return this.nativeRange.compareBoundaryPoints(a,b.nativeRange||b)};var q=document.createElement("div");q.innerHTML="123";var r=q.firstChild,s=i(document);s.appendChild(q),o.setStart(r,1),o.setEnd(r,2),o.deleteContents(),"13"==r.data&&(d.deleteContents=function(){this.nativeRange.deleteContents(),k(this)},d.extractContents=function(){var a=this.nativeRange.extractContents();return k(this),a}),s.removeChild(q),s=null,f.isHostMethod(o,"createContextualFragment")&&(d.createContextualFragment=function(a){return this.nativeRange.createContextualFragment(a)}),i(document).removeChild(n),d.getName=function(){return"WrappedRange"},a.WrappedRange=c,a.createNativeRange=function(a){return a=j(a,b,"createNativeRange"),a.createRange()}}(),a.features.implementsTextRange){var l=function(a){var b=a.parentElement(),c=a.duplicate();c.collapse(!0);var d=c.parentElement();c=a.duplicate(),c.collapse(!1);var f=c.parentElement(),g=d==f?d:e.getCommonAncestor(d,f);return g==b?g:e.getCommonAncestor(b,g)},m=function(a){return 0==a.compareEndPoints("StartToEnd",a)},n=function(a,b,c,d,f){var h=a.duplicate();h.collapse(c);var i=h.parentElement();if(e.isOrIsAncestorOf(b,i)||(i=b),!i.canHaveHTML){var j=new g(i.parentNode,e.getNodeIndex(i));return{boundaryPosition:j,nodeInfo:{nodeIndex:j.offset,containerElement:j.node}}}var l=e.getDocument(i).createElement("span");l.parentNode&&l.parentNode.removeChild(l);for(var m,o,p,q,r,n=c?"StartToStart":"StartToEnd",s=f&&f.containerElement==i?f.nodeIndex:0,t=i.childNodes.length,u=t,v=u;;){if(v==t?i.appendChild(l):i.insertBefore(l,i.childNodes[v]),h.moveToElementText(l),m=h.compareEndPoints(n,a),0==m||s==u)break;if(m==-1){if(u==s+1)break;s=v}else u=u==s+1?s:v;v=Math.floor((s+u)/2),i.removeChild(l)}if(r=l.nextSibling,m==-1&&r&&k(r)){h.setEndPoint(c?"EndToStart":"EndToEnd",a);var w;if(/[\r\n]/.test(r.data)){var x=h.duplicate(),y=x.text.replace(/\r\n/g,"\r").length;for(w=x.moveStart("character",y);(m=x.compareEndPoints("StartToEnd",x))==-1;)w++,x.moveStart("character",1)}else w=h.text.length;q=new g(r,w)}else o=(d||!c)&&l.previousSibling,p=(d||c)&&l.nextSibling,q=p&&k(p)?new g(p,0):o&&k(o)?new g(o,o.data.length):new g(i,e.getNodeIndex(l));return l.parentNode.removeChild(l),{boundaryPosition:q,nodeInfo:{nodeIndex:v,containerElement:i}}},o=function(a,b){var c,d,h,j,f=a.offset,g=e.getDocument(a.node),l=i(g).createTextRange(),m=k(a.node);return m?(c=a.node,d=c.parentNode):(j=a.node.childNodes,c=f<j.length?j[f]:null,d=a.node),h=g.createElement("span"),h.innerHTML="&#feff;",c?d.insertBefore(h,c):d.appendChild(h),l.moveToElementText(h),l.collapse(!b),d.removeChild(h),m&&l[b?"moveStart":"moveEnd"]("character",f),l};d=function(a){this.textRange=a,this.refresh()},d.prototype=new h(document),
d.prototype.refresh=function(){var a,b,c,d=l(this.textRange);m(this.textRange)?b=a=n(this.textRange,d,!0,!0).boundaryPosition:(c=n(this.textRange,d,!0,!1),a=c.boundaryPosition,b=n(this.textRange,d,!1,!1,c.nodeInfo).boundaryPosition),this.setStart(a.node,a.offset),this.setEnd(b.node,b.offset)},d.prototype.getName=function(){return"WrappedTextRange"},h.copyComparisonConstants(d);var p=function(a){if(a.collapsed)return o(new g(a.startContainer,a.startOffset),!0);var b=o(new g(a.startContainer,a.startOffset),!0),c=o(new g(a.endContainer,a.endOffset),!1),d=i(h.getRangeDocument(a)).createTextRange();return d.setEndPoint("StartToStart",b),d.setEndPoint("EndToEnd",c),d};if(d.rangeToTextRange=p,d.prototype.toTextRange=function(){return p(this)},a.WrappedTextRange=d,!a.features.implementsDomRange||a.config.preferTextRange){var q=function(){return this}();"undefined"==typeof q.Range&&(q.Range=d),a.createNativeRange=function(a){return a=j(a,b,"createNativeRange"),i(a).createTextRange()},a.WrappedRange=d}}a.createRange=function(c){return c=j(c,b,"createRange"),new a.WrappedRange(a.createNativeRange(c))},a.createRangyRange=function(a){return a=j(a,b,"createRangyRange"),new h(a)},a.createIframeRange=function(c){return b.deprecationNotice("createIframeRange()","createRange(iframeEl)"),a.createRange(c)},a.createIframeRangyRange=function(c){return b.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)"),a.createRangyRange(c)},a.addShimListener(function(b){var c=b.document;"undefined"==typeof c.createRange&&(c.createRange=function(){return a.createRange(c)}),c=b=null})}),r.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(a,b){function s(a){return"string"==typeof a?/^backward(s)?$/i.test(a):!!a}function t(a,c){if(a){if(e.isWindow(a))return a;if(a instanceof W)return a.win;var d=e.getContentDocument(a,b,c);return e.getWindow(d)}return window}function u(a){return t(a,"getWinSelection").getSelection()}function v(a){return t(a,"getDocSelection").document.selection}function w(a){var b=!1;return a.anchorNode&&(b=1==e.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset)),b}function L(a,b,c){var d=c?"end":"start",e=c?"start":"end";a.anchorNode=b[d+"Container"],a.anchorOffset=b[d+"Offset"],a.focusNode=b[e+"Container"],a.focusOffset=b[e+"Offset"]}function M(a){var b=a.nativeSelection;a.anchorNode=b.anchorNode,a.anchorOffset=b.anchorOffset,a.focusNode=b.focusNode,a.focusOffset=b.focusOffset}function N(a){a.anchorNode=a.focusNode=null,a.anchorOffset=a.focusOffset=0,a.rangeCount=0,a.isCollapsed=!0,a._ranges.length=0}function O(b){var c;return b instanceof h?(c=a.createNativeRange(b.getDocument()),c.setEnd(b.endContainer,b.endOffset),c.setStart(b.startContainer,b.startOffset)):b instanceof i?c=b.nativeRange:n.implementsDomRange&&b instanceof e.getWindow(b.startContainer).Range&&(c=b),c}function P(a){if(!a.length||1!=a[0].nodeType)return!1;for(var b=1,c=a.length;b<c;++b)if(!e.isAncestorOf(a[0],a[b]))return!1;return!0}function Q(a){var c=a.getNodes();if(!P(c))throw b.createError("getSingleElementFromRange: range "+a.inspect()+" did not consist of a single element");return c[0]}function R(a){return!!a&&"undefined"!=typeof a.text}function S(a,b){var c=new i(b);a._ranges=[c],L(a,c,!1),a.rangeCount=1,a.isCollapsed=c.collapsed}function T(b){if(b._ranges.length=0,"None"==b.docSelection.type)N(b);else{var c=b.docSelection.createRange();if(R(c))S(b,c);else{b.rangeCount=c.length;for(var d,e=p(c.item(0)),f=0;f<b.rangeCount;++f)d=a.createRange(e),d.selectNode(c.item(f)),b._ranges.push(d);b.isCollapsed=1==b.rangeCount&&b._ranges[0].collapsed,L(b,b._ranges[b.rangeCount-1],!1)}}}function U(a,c){for(var d=a.docSelection.createRange(),e=Q(c),f=p(d.item(0)),g=q(f).createControlRange(),h=0,i=d.length;h<i;++h)g.add(d.item(h));try{g.add(e)}catch(a){throw b.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}g.select(),T(a)}function W(a,b,c){this.nativeSelection=a,this.docSelection=b,this._ranges=[],this.win=c,this.refresh()}function X(a){a.win=a.anchorNode=a.focusNode=a._ranges=null,a.rangeCount=a.anchorOffset=a.focusOffset=0,a.detached=!0}function Z(a,b){for(var d,e,c=Y.length;c--;)if(d=Y[c],e=d.selection,"deleteAll"==b)X(e);else if(d.win==a)return"delete"==b?(Y.splice(c,1),!0):e;return"deleteAll"==b&&(Y.length=0),null}function aa(a,c){for(var g,d=p(c[0].startContainer),e=q(d).createControlRange(),f=0,h=c.length;f<h;++f){g=Q(c[f]);try{e.add(g)}catch(a){throw b.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}e.select(),T(a)}function fa(a,b){if(a.win.document!=p(b))throw new j("WRONG_DOCUMENT_ERR")}function ga(b){return function(c,d){var e;this.rangeCount?(e=this.getRangeAt(0),e["set"+(b?"Start":"End")](c,d)):(e=a.createRange(this.win.document),e.setStartAndEnd(c,d)),this.setSingleRange(e,this.isBackward())}}function ha(a){var b=[],c=new k(a.anchorNode,a.anchorOffset),d=new k(a.focusNode,a.focusOffset),e="function"==typeof a.getName?a.getName():"Selection";if("undefined"!=typeof a.rangeCount)for(var f=0,g=a.rangeCount;f<g;++f)b[f]=h.inspect(a.getRangeAt(f));return"["+e+"(Ranges: "+b.join(", ")+")(anchor: "+c.inspect()+", focus: "+d.inspect()+"]"}a.config.checkSelectionRanges=!0;var l,m,c="boolean",d="number",e=a.dom,f=a.util,g=f.isHostMethod,h=a.DomRange,i=a.WrappedRange,j=a.DOMException,k=e.DomPosition,n=a.features,o="Control",p=e.getDocument,q=e.getBody,r=h.rangesEqual,x=g(window,"getSelection"),y=f.isHostObject(document,"selection");n.implementsWinGetSelection=x,n.implementsDocSelection=y;var z=y&&(!x||a.config.preferTextRange);z?(l=v,a.isSelectionValid=function(a){var b=t(a,"isSelectionValid").document,c=b.selection;return"None"!=c.type||p(c.createRange().parentElement())==b}):x?(l=u,a.isSelectionValid=function(){return!0}):b.fail("Neither document.selection or window.getSelection() detected."),a.getNativeSelection=l;var A=l(),B=a.createNativeRange(document),C=q(document),D=f.areHostProperties(A,["anchorNode","focusNode","anchorOffset","focusOffset"]);n.selectionHasAnchorAndFocus=D;var E=g(A,"extend");n.selectionHasExtend=E;var F=typeof A.rangeCount==d;n.selectionHasRangeCount=F;var G=!1,H=!0,I=E?function(b,c){var d=h.getRangeDocument(c),e=a.createRange(d);e.collapseToPoint(c.endContainer,c.endOffset),b.addRange(O(e)),b.extend(c.startContainer,c.startOffset)}:null;f.areHostMethods(A,["addRange","getRangeAt","removeAllRanges"])&&typeof A.rangeCount==d&&n.implementsDomRange&&!function(){var b=window.getSelection();if(b){for(var c=b.rangeCount,d=c>1,e=[],f=w(b),g=0;g<c;++g)e[g]=b.getRangeAt(g);var h=q(document),i=h.appendChild(document.createElement("div"));i.contentEditable="false";var j=i.appendChild(document.createTextNode("   ")),k=document.createRange();if(k.setStart(j,1),k.collapse(!0),b.addRange(k),H=1==b.rangeCount,b.removeAllRanges(),!d){var l=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(l&&parseInt(l[1])>=36)G=!1;else{var m=k.cloneRange();k.setStart(j,0),m.setEnd(j,3),m.setStart(j,2),b.addRange(k),b.addRange(m),G=2==b.rangeCount}}for(h.removeChild(i),b.removeAllRanges(),g=0;g<c;++g)0==g&&f?I?I(b,e[g]):(a.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),b.addRange(e[g])):b.addRange(e[g])}}(),n.selectionSupportsMultipleRanges=G,n.collapsedNonEditableSelectionsSupported=H;var K,J=!1;C&&g(C,"createControlRange")&&(K=C.createControlRange(),f.areHostProperties(K,["item","add"])&&(J=!0)),n.implementsControlRange=J,m=D?function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:function(a){return!!a.rangeCount&&a.getRangeAt(a.rangeCount-1).collapsed};var V;g(A,"getRangeAt")?V=function(a,b){try{return a.getRangeAt(b)}catch(a){return null}}:D&&(V=function(b){var c=p(b.anchorNode),d=a.createRange(c);return d.setStartAndEnd(b.anchorNode,b.anchorOffset,b.focusNode,b.focusOffset),d.collapsed!==this.isCollapsed&&d.setStartAndEnd(b.focusNode,b.focusOffset,b.anchorNode,b.anchorOffset),d}),W.prototype=a.selectionPrototype;var Y=[],$=function(a){if(a&&a instanceof W)return a.refresh(),a;a=t(a,"getNativeSelection");var b=Z(a),c=l(a),d=y?v(a):null;return b?(b.nativeSelection=c,b.docSelection=d,b.refresh()):(b=new W(c,d,a),Y.push({win:a,selection:b})),b};a.getSelection=$,a.getIframeSelection=function(c){return b.deprecationNotice("getIframeSelection()","getSelection(iframeEl)"),a.getSelection(e.getIframeWindow(c))};var _=W.prototype;if(!z&&D&&f.areHostMethods(A,["removeAllRanges","addRange"])){_.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),N(this)};var ba=function(a,b){I(a.nativeSelection,b),a.refresh()};F?_.addRange=function(b,c){if(J&&y&&this.docSelection.type==o)U(this,b);else if(s(c)&&E)ba(this,b);else{var d;if(G?d=this.rangeCount:(this.removeAllRanges(),d=0),this.nativeSelection.addRange(O(b).cloneRange()),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==d+1){if(a.config.checkSelectionRanges){var e=V(this.nativeSelection,this.rangeCount-1);e&&!r(e,b)&&(b=new i(e))}this._ranges[this.rangeCount-1]=b,L(this,b,ea(this.nativeSelection)),this.isCollapsed=m(this)}else this.refresh()}}:_.addRange=function(a,b){s(b)&&E?ba(this,a):(this.nativeSelection.addRange(O(a)),this.refresh())},_.setRanges=function(a){if(J&&y&&a.length>1)aa(this,a);else{this.removeAllRanges();for(var b=0,c=a.length;b<c;++b)this.addRange(a[b])}}}else{if(!(g(A,"empty")&&g(B,"select")&&J&&z))return b.fail("No means of selecting a Range or TextRange was found"),!1;_.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var a;if(this.anchorNode)a=p(this.anchorNode);else if(this.docSelection.type==o){var b=this.docSelection.createRange();b.length&&(a=p(b.item(0)))}if(a){var c=q(a).createTextRange();c.select(),this.docSelection.empty()}}}catch(a){}N(this)},_.addRange=function(b){this.docSelection.type==o?U(this,b):(a.WrappedTextRange.rangeToTextRange(b).select(),this._ranges[0]=b,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,L(this,b,!1))},_.setRanges=function(a){this.removeAllRanges();var b=a.length;b>1?aa(this,a):b&&this.addRange(a[0])}}_.getRangeAt=function(a){if(a<0||a>=this.rangeCount)throw new j("INDEX_SIZE_ERR");return this._ranges[a].cloneRange()};var ca;if(z)ca=function(b){var c;a.isSelectionValid(b.win)?c=b.docSelection.createRange():(c=q(b.win.document).createTextRange(),c.collapse(!0)),b.docSelection.type==o?T(b):R(c)?S(b,c):N(b)};else if(g(A,"getRangeAt")&&typeof A.rangeCount==d)ca=function(b){if(J&&y&&b.docSelection.type==o)T(b);else if(b._ranges.length=b.rangeCount=b.nativeSelection.rangeCount,b.rangeCount){for(var c=0,d=b.rangeCount;c<d;++c)b._ranges[c]=new a.WrappedRange(b.nativeSelection.getRangeAt(c));L(b,b._ranges[b.rangeCount-1],ea(b.nativeSelection)),b.isCollapsed=m(b)}else N(b)};else{if(!D||typeof A.isCollapsed!=c||typeof B.collapsed!=c||!n.implementsDomRange)return b.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;ca=function(a){var b,c=a.nativeSelection;c.anchorNode?(b=V(c,0),a._ranges=[b],a.rangeCount=1,M(a),a.isCollapsed=m(a)):N(a)}}_.refresh=function(a){var b=a?this._ranges.slice(0):null,c=this.anchorNode,d=this.anchorOffset;if(ca(this),a){var e=b.length;if(e!=this._ranges.length)return!0;if(this.anchorNode!=c||this.anchorOffset!=d)return!0;for(;e--;)if(!r(b[e],this._ranges[e]))return!0;return!1}};var da=function(a,b){var c=a.getAllRanges();a.removeAllRanges();for(var d=0,e=c.length;d<e;++d)r(b,c[d])||a.addRange(c[d]);a.rangeCount||N(a)};J&&y?_.removeRange=function(a){if(this.docSelection.type==o){for(var f,b=this.docSelection.createRange(),c=Q(a),d=p(b.item(0)),e=q(d).createControlRange(),g=!1,h=0,i=b.length;h<i;++h)f=b.item(h),f!==c||g?e.add(b.item(h)):g=!0;e.select(),T(this)}else da(this,a)}:_.removeRange=function(a){da(this,a)};var ea;!z&&D&&n.implementsDomRange?(ea=w,_.isBackward=function(){return ea(this)}):ea=_.isBackward=function(){return!1},_.isBackwards=_.isBackward,_.toString=function(){for(var a=[],b=0,c=this.rangeCount;b<c;++b)a[b]=""+this._ranges[b];return a.join("")},_.collapse=function(b,c){fa(this,b);var d=a.createRange(b);d.collapseToPoint(b,c),this.setSingleRange(d),this.isCollapsed=!0},_.collapseToStart=function(){if(!this.rangeCount)throw new j("INVALID_STATE_ERR");var a=this._ranges[0];this.collapse(a.startContainer,a.startOffset)},_.collapseToEnd=function(){if(!this.rangeCount)throw new j("INVALID_STATE_ERR");var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)},_.selectAllChildren=function(b){fa(this,b);var c=a.createRange(b);c.selectNodeContents(b),this.setSingleRange(c)},_.deleteFromDocument=function(){if(J&&y&&this.docSelection.type==o){for(var b,a=this.docSelection.createRange();a.length;)b=a.item(0),a.remove(b),b.parentNode.removeChild(b);this.refresh()}else if(this.rangeCount){var c=this.getAllRanges();if(c.length){this.removeAllRanges();for(var d=0,e=c.length;d<e;++d)c[d].deleteContents();this.addRange(c[e-1])}}},_.eachRange=function(a,b){for(var c=0,d=this._ranges.length;c<d;++c)if(a(this.getRangeAt(c)))return b},_.getAllRanges=function(){var a=[];return this.eachRange(function(b){a.push(b)}),a},_.setSingleRange=function(a,b){this.removeAllRanges(),this.addRange(a,b)},_.callMethodOnEachRange=function(a,b){var c=[];return this.eachRange(function(d){c.push(d[a].apply(d,b))}),c},_.setStart=ga(!0),_.setEnd=ga(!1),a.rangePrototype.select=function(a){$(this.getDocument()).setSingleRange(this,a)},_.changeEachRange=function(a){var b=[],c=this.isBackward();this.eachRange(function(c){a(c),b.push(c)}),this.removeAllRanges(),c&&1==b.length?this.addRange(b[0],"backward"):this.setRanges(b)},_.containsNode=function(a,b){return this.eachRange(function(c){return c.containsNode(a,b)},!0)||!1},_.getBookmark=function(a){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[a])}},_.moveToBookmark=function(b){for(var e,f,c=[],d=0;e=b.rangeBookmarks[d++];)f=a.createRange(this.win),f.moveToBookmark(e),c.push(f);b.backward?this.setSingleRange(c[0],"backward"):this.setRanges(c)},_.toHtml=function(){var a=[];return this.eachRange(function(b){a.push(h.toHtml(b))}),a.join("")},n.implementsTextRange&&(_.getNativeTextRange=function(){var c;if(c=this.docSelection){var e=c.createRange();if(R(e))return e;throw b.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return a.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw b.createError("getNativeTextRange: selection contains no range")}),_.getName=function(){return"WrappedSelection"},_.inspect=function(){return ha(this)},_.detach=function(){Z(this.win,"delete"),X(this)},W.detachAll=function(){Z(null,"deleteAll")},W.inspect=ha,W.isDirectionBackward=s,a.Selection=W,a.selectionPrototype=_,a.addShimListener(function(a){"undefined"==typeof a.getSelection&&(a.getSelection=function(){return $(a)}),a=null})}),r)},this),function(a,b){"function"==typeof define&&define.amd?define(["rangy"],a):a(b.rangy)}(function(a){a.createModule("SaveRestore",["WrappedRange"],function(a,b){function e(a,b){return(b||document).getElementById(a)}function f(a,b){var f,e="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),g=c.getDocument(a.startContainer),h=a.cloneRange();return h.collapse(b),f=g.createElement("span"),f.id=e,f.style.lineHeight="0",f.style.display="none",f.className="rangySelectionBoundary",f.appendChild(g.createTextNode(d)),h.insertNode(f),f}function g(a,c,d,f){var g=e(d,a);g?(c[f?"setStartBefore":"setEndBefore"](g),g.parentNode.removeChild(g)):b.warn("Marker element has been removed. Cannot restore selection.")}function h(a,b){return b.compareBoundaryPoints(a.START_TO_START,a)}function i(b,c){var d,e,g=a.DomRange.getRangeDocument(b),h=b.toString();return b.collapsed?(e=f(b,!1),{document:g,markerId:e.id,collapsed:!0}):(e=f(b,!1),d=f(b,!0),{document:g,startMarkerId:d.id,endMarkerId:e.id,collapsed:!1,backward:c,toString:function(){return"original text: '"+h+"', new text: '"+b.toString()+"'"}})}function j(c,d){var f=c.document;"undefined"==typeof d&&(d=!0);var h=a.createRange(f);if(c.collapsed){var i=e(c.markerId,f);if(i){i.style.display="inline";var j=i.previousSibling;j&&3==j.nodeType?(i.parentNode.removeChild(i),h.collapseToPoint(j,j.length)):(h.collapseBefore(i),i.parentNode.removeChild(i))}else b.warn("Marker element has been removed. Cannot restore selection.")}else g(f,h,c.startMarkerId,!0),g(f,h,c.endMarkerId,!1);return d&&h.normalizeBoundaries(),h}function k(b,c){var f,g,d=[];b=b.slice(0),b.sort(h);for(var j=0,k=b.length;j<k;++j)d[j]=i(b[j],c);for(j=k-1;j>=0;--j)f=b[j],g=a.DomRange.getRangeDocument(f),f.collapsed?f.collapseAfter(e(d[j].markerId,g)):(f.setEndBefore(e(d[j].endMarkerId,g)),f.setStartAfter(e(d[j].startMarkerId,g)));return d}function l(c){if(!a.isSelectionValid(c))return b.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var d=a.getSelection(c),e=d.getAllRanges(),f=1==e.length&&d.isBackward(),g=k(e,f);return f?d.setSingleRange(e[0],"backward"):d.setRanges(e),{win:c,rangeInfos:g,restored:!1}}function m(a){for(var b=[],c=a.length,d=c-1;d>=0;d--)b[d]=j(a[d],!0);return b}function n(b,c){if(!b.restored){var d=b.rangeInfos,e=a.getSelection(b.win),f=m(d),g=d.length;1==g&&c&&a.features.selectionHasExtend&&d[0].backward?(e.removeAllRanges(),e.addRange(f[0],!0)):e.setRanges(f),b.restored=!0}}function o(a,b){var c=e(b,a);c&&c.parentNode.removeChild(c)}function p(a){for(var e,b=a.rangeInfos,c=0,d=b.length;c<d;++c)e=b[c],e.collapsed?o(a.doc,e.markerId):(o(a.doc,e.startMarkerId),o(a.doc,e.endMarkerId))}var c=a.dom,d="\ufeff";a.util.extend(a,{saveRange:i,restoreRange:j,saveRanges:k,restoreRanges:m,saveSelection:l,restoreSelection:n,removeMarkerElement:o,removeMarkers:p})})},this);var Base=function(){};Base.extend=function(a,b){var c=Base.prototype.extend;Base._prototyping=!0;var d=new this;c.call(d,a),d.base=function(){},delete Base._prototyping;var e=d.constructor,f=d.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==f)this._constructing=!0,e.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||c).call(arguments[0],d)};return f.ancestor=this,f.extend=this.extend,f.forEach=this.forEach,f.implement=this.implement,f.prototype=d,f.toString=this.toString,f.valueOf=function(a){return"object"==a?f:e.valueOf()},c.call(f,b),"function"==typeof f.init&&f.init(),f},Base.prototype={extend:function(a,b){if(arguments.length>1){var c=this[a];if(c&&"function"==typeof b&&(!c.valueOf||c.valueOf()!=b.valueOf())&&/\bbase\b/.test(b)){var d=b.valueOf();b=function(){var a=this.base||Base.prototype.base;this.base=c;var b=d.apply(this,arguments);return this.base=a,b},b.valueOf=function(a){return"object"==a?b:d},b.toString=Base.toString}this[a]=b}else if(a){var e=Base.prototype.extend;Base._prototyping||"function"==typeof this||(e=this.extend||e);for(var f={toSource:null},g=["constructor","toString","valueOf"],h=Base._prototyping?0:1;i=g[h++];)a[i]!=f[i]&&e.call(this,i,a[i]);for(var i in a)f[i]||e.call(this,i,a[i])}return this}},Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(a,b,c){for(var d in a)void 0===this.prototype[d]&&b.call(c,a[d],d,a)},implement:function(){for(var a=0;a<arguments.length;a++)"function"==typeof arguments[a]?arguments[a](this.prototype):this.prototype.extend(arguments[a]);return this},toString:function(){return String(this.valueOf())}}),wysihtml5.browser=function(){function g(a){return+(/ipad|iphone|ipod/.test(a)&&a.match(/ os (\d+).+? like mac os x/)||[void 0,0])[1]}function h(a){return+(a.match(/android (\d+)/)||[void 0,0])[1]}function i(a,b){var d,c=-1;return"Microsoft Internet Explorer"==navigator.appName?d=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"):"Netscape"==navigator.appName&&(d=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})")),d&&null!=d.exec(navigator.userAgent)&&(c=parseFloat(RegExp.$1)),c!==-1&&(!a||(b?"<"===b?a<c:">"===b?a>c:"<="===b?a<=c:">="===b?a>=c:void 0:a===c))}var a=navigator.userAgent,b=document.createElement("div"),c=a.indexOf("Gecko")!==-1&&a.indexOf("KHTML")===-1,d=a.indexOf("AppleWebKit/")!==-1,e=a.indexOf("Chrome/")!==-1,f=a.indexOf("Opera/")!==-1;return{USER_AGENT:a,supported:function(){var a=this.USER_AGENT.toLowerCase(),c="contentEditable"in b,d=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,e=document.querySelector&&document.querySelectorAll,f=this.isIos()&&g(a)<5||this.isAndroid()&&h(a)<4||a.indexOf("opera mobi")!==-1||a.indexOf("hpwos/")!==-1;return c&&d&&e&&!f},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){return/ipad|iphone|ipod/i.test(this.USER_AGENT)},isAndroid:function(){return this.USER_AGENT.indexOf("Android")!==-1},supportsSandboxedIframes:function(){return i()},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return!("querySelector"in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return i()},hasCurrentStyleProperty:function(){return"currentStyle"in b},hasHistoryIssue:function(){return c&&"Mac"===navigator.platform.substr(0,3)},insertsLineBreaksOnReturn:function(){return c},supportsPlaceholderAttributeOn:function(a){return"placeholder"in a},supportsEvent:function(a){return"on"+a in b||function(){return b.setAttribute("on"+a,"return;"),"function"==typeof b["on"+a]}()},supportsEventsInIframeCorrectly:function(){return!f},supportsHTML5Tags:function(a){var b=a.createElement("div"),c="<article>foo</article>";return b.innerHTML=c,b.innerHTML.toLowerCase()===c},supportsCommand:function(){var a={formatBlock:i(10,"<="),insertUnorderedList:i(),insertOrderedList:i()},b={insertHTML:c};return function(c,d){var e=a[d];if(!e){try{return c.queryCommandSupported(d)}catch(a){}try{return c.queryCommandEnabled(d)}catch(a){return!!b[d]}}return!1}}(),doesAutoLinkingInContentEditable:function(){return i()},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return c||f||d},supportsGetAttributeCorrectly:function(){var a=document.createElement("td");return"1"!=a.getAttribute("rowspan")},canSelectImagesInContentEditable:function(){return c||i()||f},autoScrollsToCaret:function(){return!d},autoClosesUnclosedTags:function(){var c,d,a=b.cloneNode(!1);return a.innerHTML="<p><div></div>",d=a.innerHTML.toLowerCase(),c="<p></p><div></div>"===d||"<p><div></div></p>"===d,this.autoClosesUnclosedTags=function(){return c},c},supportsNativeGetElementsByClassName:function(){return String(document.getElementsByClassName).indexOf("[native code]")!==-1},supportsSelectionModify:function(){return"getSelection"in window&&"modify"in window.getSelection()},needsSpaceAfterLineBreak:function(){return f},supportsSpeechApiOn:function(b){var c=a.match(/Chrome\/(\d+)/)||[void 0,0];return c[1]>=11&&("onwebkitspeechchange"in b||"speech"in b)},crashesWhenDefineProperty:function(a){return i(9)&&("XMLHttpRequest"===a||"XDomainRequest"===a)},doesAsyncFocus:function(){return i()},hasProblemsSettingCaretAfterImg:function(){return i()},hasUndoInContextMenu:function(){return c||e||f},hasInsertNodeIssue:function(){return f},hasIframeFocusIssue:function(){return i()},createsNestedInvalidMarkupAfterPaste:function(){return d},supportsMutationEvents:function(){return"MutationEvent"in window},supportsModenPaste:function(){return!("clipboardData"in window)}}}(),wysihtml5.lang.array=function(a){return{contains:function(b){if(Array.isArray(b)){for(var c=b.length;c--;)if(wysihtml5.lang.array(a).indexOf(b[c])!==-1)return!0;return!1}return wysihtml5.lang.array(a).indexOf(b)!==-1},indexOf:function(b){if(a.indexOf)return a.indexOf(b);for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1},without:function(b){b=wysihtml5.lang.array(b);for(var c=[],d=0,e=a.length;d<e;d++)b.contains(a[d])||c.push(a[d]);return c},get:function(){for(var b=0,c=a.length,d=[];b<c;b++)d.push(a[b]);return d},map:function(b,c){if(Array.prototype.map)return a.map(b,c);for(var d=a.length>>>0,e=new Array(d),f=0;f<d;f++)e[f]=b.call(c,a[f],f,a);return e},unique:function(){for(var b=[],c=a.length,d=0;d<c;)wysihtml5.lang.array(b).contains(a[d])||b.push(a[d]),d++;return b}}},wysihtml5.lang.Dispatcher=Base.extend({on:function(a,b){return this.events=this.events||{},this.events[a]=this.events[a]||[],this.events[a].push(b),this},off:function(a,b){this.events=this.events||{};var d,e,c=0;if(a){for(d=this.events[a]||[],e=[];c<d.length;c++)d[c]!==b&&b&&e.push(d[c]);this.events[a]=e}else this.events={};return this},fire:function(a,b){this.events=this.events||{};for(var c=this.events[a]||[],d=0;d<c.length;d++)c[d].call(this,b);return this},observe:function(){return this.on.apply(this,arguments)},stopObserving:function(){return this.off.apply(this,arguments)}}),wysihtml5.lang.object=function(a){return{merge:function(b){for(var c in b)a[c]=b[c];return this},get:function(){return a},clone:function(b){var d,c={};if(null===a||!wysihtml5.lang.object(a).isPlainObject())return a;for(d in a)a.hasOwnProperty(d)&&(b?c[d]=wysihtml5.lang.object(a[d]).clone(b):c[d]=a[d]);return c},isArray:function(){return"[object Array]"===Object.prototype.toString.call(a)},isFunction:function(){return"[object Function]"===Object.prototype.toString.call(a)},isPlainObject:function(){return"[object Object]"===Object.prototype.toString.call(a)}}},function(){var a=/^\s+/,b=/\s+$/,c=/[&<>\t"]/g,d={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","\t":"&nbsp; "};wysihtml5.lang.string=function(e){return e=String(e),{trim:function(){return e.replace(a,"").replace(b,"")},interpolate:function(a){for(var b in a)e=this.replace("#{"+b+"}").by(a[b]);return e},replace:function(a){return{by:function(b){return e.split(a).join(b)}}},escapeHTML:function(a,b){var f=e.replace(c,function(a){return d[a]});return a&&(f=f.replace(/(?:\r\n|\r|\n)/g,"<br />")),b&&(f=f.replace(/  /gi,"&nbsp; ")),f}}}}(),function(a){function g(a,b){return k(a,b)?a:(a===a.ownerDocument.documentElement&&(a=a.ownerDocument.body),l(a,b))}function h(a){return a.replace(c,function(a,b){var c=(b.match(d)||[])[1]||"",g=f[c];b=b.replace(d,""),b.split(g).length>b.split(c).length&&(b+=c,c="");var h=b,i=b;return b.length>e&&(i=i.substr(0,e)+"..."),"www."===h.substr(0,4)&&(h="http://"+h),'<a href="'+h+'">'+i+"</a>"+c})}function i(a){var b=a._wysihtml5_tempElement;return b||(b=a._wysihtml5_tempElement=a.createElement("div")),b}function j(b){var c=b.parentNode,d=a.lang.string(b.data).escapeHTML(),e=i(c.ownerDocument);for(e.innerHTML="<span></span>"+h(d),e.removeChild(e.firstChild);e.firstChild;)c.insertBefore(e.firstChild,b);c.removeChild(b)}function k(c,d){for(var e;c.parentNode;){if(c=c.parentNode,e=c.nodeName,c.className&&a.lang.array(c.className.split(" ")).contains(d))return!0;if(b.contains(e))return!0;if("body"===e)return!1}return!1}function l(d,e){if(!(b.contains(d.nodeName)||d.className&&a.lang.array(d.className.split(" ")).contains(e))){if(d.nodeType===a.TEXT_NODE&&d.data.match(c))return void j(d);for(var f=a.lang.array(d.childNodes).get(),g=f.length,h=0;h<g;h++)l(f[h],e);return d}}var b=a.lang.array(["CODE","PRE","A","SCRIPT","HEAD","TITLE","STYLE"]),c=/((https?:\/\/|www\.)[^\s<]{3,})/gi,d=/([^\w\/\-](,?))$/i,e=100,f={")":"(","]":"[","}":"{"};a.dom.autoLink=g,a.dom.autoLink.URL_REG_EXP=c}(wysihtml5),function(a){var b=a.dom;b.addClass=function(a,c){var d=a.classList;return d?d.add(c):void(b.hasClass(a,c)||(a.className+=" "+c))},b.removeClass=function(a,b){var c=a.classList;return c?c.remove(b):void(a.className=a.className.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)")," "))},b.hasClass=function(a,b){var c=a.classList;if(c)return c.contains(b);var d=a.className;return d.length>0&&(d==b||new RegExp("(^|\\s)"+b+"(\\s|$)").test(d))}}(wysihtml5),wysihtml5.dom.contains=function(){var a=document.documentElement;return a.contains?function(a,b){return b.nodeType!==wysihtml5.ELEMENT_NODE&&(b=b.parentNode),a!==b&&a.contains(b)}:a.compareDocumentPosition?function(a,b){return!!(16&a.compareDocumentPosition(b))}:void 0}(),wysihtml5.dom.convertToList=function(){function a(a,b){var c=a.createElement("li");return b.appendChild(c),c}function b(a,b){return a.createElement(b)}function c(c,d,e){if("UL"===c.nodeName||"OL"===c.nodeName||"MENU"===c.nodeName)return c;var j,k,l,m,n,o,p,q,r,f=c.ownerDocument,g=b(f,d),h=c.querySelectorAll("br"),i=h.length;for(r=0;r<i;r++)for(m=h[r];(n=m.parentNode)&&n!==c&&n.lastChild===m;){if("block"===wysihtml5.dom.getStyle("display").from(n)){n.removeChild(m);break}wysihtml5.dom.insert(m).after(m.parentNode)}for(j=wysihtml5.lang.array(c.childNodes).get(),k=j.length,r=0;r<k;r++)q=q||a(f,g),l=j[r],o="block"===wysihtml5.dom.getStyle("display").from(l),p="BR"===l.nodeName,!o||e&&wysihtml5.dom.hasClass(l,e)?p?q=q.firstChild?null:q:q.appendChild(l):(q=q.firstChild?a(f,g):q,q.appendChild(l),q=null);return 0===j.length&&a(f,g),c.parentNode.replaceChild(g,c),g}return c}(),wysihtml5.dom.copyAttributes=function(a){return{from:function(b){return{to:function(c){for(var d,e=0,f=a.length;e<f;e++)d=a[e],"undefined"!=typeof b[d]&&""!==b[d]&&(c[d]=b[d]);return{andTo:arguments.callee}}}}}},function(a){var b=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"],c=function(b){return!!d(b)&&parseInt(a.getStyle("width").from(b),10)<b.offsetWidth},d=function(c){for(var d=0,e=b.length;d<e;d++)if("border-box"===a.getStyle(b[d]).from(c))return b[d]};a.copyStyles=function(d){return{from:function(e){c(e)&&(d=wysihtml5.lang.array(d).without(b));for(var i,f="",g=d.length,h=0;h<g;h++)i=d[h],f+=i+":"+a.getStyle(i).from(e)+";";return{to:function(b){return a.setStyles(f).on(b),{andTo:arguments.callee}}}}}}}(wysihtml5.dom),function(a){a.dom.delegate=function(b,c,d,e){return a.dom.observe(b,d,function(d){for(var f=d.target,g=a.lang.array(b.querySelectorAll(c));f&&f!==b;){if(g.contains(f)){e.call(f,d);break}f=f.parentNode}})}}(wysihtml5),function(a){a.dom.domNode=function(b){var c=[a.ELEMENT_NODE,a.TEXT_NODE],d=function(b){return b.nodeType===a.TEXT_NODE&&/^\s*$/g.test(b.data)};return{prev:function(e){var f=b.previousSibling,g=e&&e.nodeTypes?e.nodeTypes:c;return f?!a.lang.array(g).contains(f.nodeType)||e&&e.ignoreBlankTexts&&d(f)?a.dom.domNode(f).prev(e):f:null},next:function(e){var f=b.nextSibling,g=e&&e.nodeTypes?e.nodeTypes:c;return f?!a.lang.array(g).contains(f.nodeType)||e&&e.ignoreBlankTexts&&d(f)?a.dom.domNode(f).next(e):f:null}}}}(wysihtml5),wysihtml5.dom.getAsDom=function(){var a=function(a,b){var c=b.createElement("div");c.style.display="none",b.body.appendChild(c);try{c.innerHTML=a}catch(a){}return b.body.removeChild(c),c},b=function(a){if(!a._wysihtml5_supportsHTML5Tags){for(var b=0,d=c.length;b<d;b++)a.createElement(c[b]);a._wysihtml5_supportsHTML5Tags=!0}},c=["abbr","article","aside","audio","bdi","canvas","command","datalist","details","figcaption","figure","footer","header","hgroup","keygen","mark","meter","nav","output","progress","rp","rt","ruby","svg","section","source","summary","time","track","video","wbr"];return function(c,d){d=d||document;var e;return"object"==typeof c&&c.nodeType?(e=d.createElement("div"),e.appendChild(c)):wysihtml5.browser.supportsHTML5Tags(d)?(e=d.createElement("div"),e.innerHTML=c):(b(d),e=a(c,d)),e}}(),wysihtml5.dom.getParentElement=function(){function a(a,b){return!b||!b.length||("string"==typeof b?a===b:wysihtml5.lang.array(b).contains(a))}function b(a){return a.nodeType===wysihtml5.ELEMENT_NODE}function c(a,b,c){var d=(a.className||"").match(c)||[];return b?d[d.length-1]===b:!!d.length}function d(a,b,c){var d=(a.getAttribute("style")||"").match(c)||[];return b?d[d.length-1]===b:!!d.length}return function(e,f,g,h){var i=f.cssStyle||f.styleRegExp,j=f.className||f.classRegExp;for(g=g||50;g--&&e&&"BODY"!==e.nodeName&&(!h||e!==h);){if(b(e)&&a(e.nodeName,f.nodeName)&&(!i||d(e,f.cssStyle,f.styleRegExp))&&(!j||c(e,f.className,f.classRegExp)))return e;
e=e.parentNode}return null}}(),wysihtml5.dom.getStyle=function(){function c(a){return a.replace(b,function(a){return a.charAt(1).toUpperCase()})}var a={float:"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},b=/\-[a-z]/g;return function(b){return{from:function(d){if(d.nodeType===wysihtml5.ELEMENT_NODE){var e=d.ownerDocument,f=a[b]||c(b),g=d.style,h=d.currentStyle,i=g[f];if(i)return i;if(h)try{return h[f]}catch(a){}var l,m,j=e.defaultView||e.parentWindow,k=("height"===b||"width"===b)&&"TEXTAREA"===d.nodeName;return j.getComputedStyle?(k&&(l=g.overflow,g.overflow="hidden"),m=j.getComputedStyle(d,null).getPropertyValue(b),k&&(g.overflow=l||""),m):void 0}}}}}(),wysihtml5.dom.getTextNodes=function(a,b){var c=[];for(a=a.firstChild;a;a=a.nextSibling)3==a.nodeType?b&&/^\s*$/.test(a.innerText||a.textContent)||c.push(a):c=c.concat(wysihtml5.dom.getTextNodes(a,b));return c},wysihtml5.dom.hasElementWithTagName=function(){function c(a){return a._wysihtml5_identifier||(a._wysihtml5_identifier=b++)}var a={},b=1;return function(b,d){var e=c(b)+":"+d,f=a[e];return f||(f=a[e]=b.getElementsByTagName(d)),f.length>0}}(),function(a){function d(a){return a._wysihtml5_identifier||(a._wysihtml5_identifier=c++)}var b={},c=1;a.dom.hasElementWithClassName=function(c,e){if(!a.browser.supportsNativeGetElementsByClassName())return!!c.querySelector("."+e);var f=d(c)+":"+e,g=b[f];return g||(g=b[f]=c.getElementsByClassName(e)),g.length>0}}(wysihtml5),wysihtml5.dom.insert=function(a){return{after:function(b){b.parentNode.insertBefore(a,b.nextSibling)},before:function(b){b.parentNode.insertBefore(a,b)},into:function(b){b.appendChild(a)}}},wysihtml5.dom.insertCSS=function(a){return a=a.join("\n"),{into:function(b){var c=b.createElement("style");c.type="text/css",c.styleSheet?c.styleSheet.cssText=a:c.appendChild(b.createTextNode(a));var d=b.querySelector("head link");if(d)return void d.parentNode.insertBefore(c,d);var e=b.querySelector("head");e&&e.appendChild(c)}}},function(a){a.dom.lineBreaks=function(b){function c(a){return"BR"===a.nodeName}function d(b){return!!c(b)||"block"===a.dom.getStyle("display").from(b)}return{add:function(c){var e=b.ownerDocument,f=a.dom.domNode(b).next({ignoreBlankTexts:!0}),g=a.dom.domNode(b).prev({ignoreBlankTexts:!0});f&&!d(f)&&a.dom.insert(e.createElement("br")).after(b),g&&!d(g)&&a.dom.insert(e.createElement("br")).before(b)},remove:function(d){var e=a.dom.domNode(b).next({ignoreBlankTexts:!0}),f=a.dom.domNode(b).prev({ignoreBlankTexts:!0});e&&c(e)&&e.parentNode.removeChild(e),f&&c(f)&&f.parentNode.removeChild(f)}}}}(wysihtml5),wysihtml5.dom.observe=function(a,b,c){b="string"==typeof b?[b]:b;for(var d,e,f=0,g=b.length;f<g;f++)e=b[f],a.addEventListener?a.addEventListener(e,c,!1):(d=function(b){"target"in b||(b.target=b.srcElement),b.preventDefault=b.preventDefault||function(){this.returnValue=!1},b.stopPropagation=b.stopPropagation||function(){this.cancelBubble=!0},c.call(a,b)},a.attachEvent("on"+e,d));return{stop:function(){for(var e,f=0,g=b.length;f<g;f++)e=b[f],a.removeEventListener?a.removeEventListener(e,c,!1):a.detachEvent("on"+e,d)}}},wysihtml5.dom.parse=function(a,b){function h(a,b){wysihtml5.lang.object(g).merge(f).merge(b.rules).get();var k,l,m,c=b.context||a.ownerDocument||document,d=c.createDocumentFragment(),e="string"==typeof a,h=!1;for(b.clearInternals===!0&&(h=!0),k=e?wysihtml5.dom.getAsDom(a,c):a,g.selectors&&j(k,g.selectors);k.firstChild;)m=k.firstChild,l=i(m,b.cleanUp,h,b.uneditableClass),l&&d.appendChild(l),m!==l&&k.removeChild(m);if(b.unjoinNbsps)for(var n=wysihtml5.dom.getTextNodes(d),o=n.length;o--;)n[o].nodeValue=n[o].nodeValue.replace(/([\S\u00A0])\u00A0/gi,"$1 ");return k.innerHTML="",k.appendChild(d),e?wysihtml5.quirks.getCorrectInnerHTML(k):k}function i(a,b,e,f){var m,n,o,g=a.nodeType,h=a.childNodes,j=h.length,k=c[g],l=0;if(f&&1===g&&wysihtml5.dom.hasClass(a,f))return a;if(n=k&&k(a,e),!n){if(n===!1){for(m=a.ownerDocument.createDocumentFragment(),l=j;l--;)h[l]&&(o=i(h[l],b,e,f),o&&(h[l]===o&&l--,m.insertBefore(o,m.firstChild)));return"block"===wysihtml5.dom.getStyle("display").from(a)&&m.appendChild(a.ownerDocument.createElement("br")),wysihtml5.lang.array(["div","pre","p","table","td","th","ul","ol","li","dd","dl","footer","header","section","h1","h2","h3","h4","h5","h6"]).contains(a.nodeName.toLowerCase())&&a.parentNode.lastChild!==a&&(a.nextSibling&&3===a.nextSibling.nodeType&&/^\s/.test(a.nextSibling.nodeValue)||m.appendChild(a.ownerDocument.createTextNode(" "))),m.normalize&&m.normalize(),m}return null}for(l=0;l<j;l++)h[l]&&(o=i(h[l],b,e,f),o&&(h[l]===o&&l--,n.appendChild(o)));if(b&&n.nodeName.toLowerCase()===d&&(!n.childNodes.length||/^\s*$/gi.test(n.innerHTML)&&(e||"_wysihtml5-temp-placeholder"!==a.className&&"rangySelectionBoundary"!==a.className)||!n.attributes.length)){for(m=n.ownerDocument.createDocumentFragment();n.firstChild;)m.appendChild(n.firstChild);return m.normalize&&m.normalize(),m}return n.normalize&&n.normalize(),n}function j(a,b){var c,d,e;for(c in b)if(b.hasOwnProperty(c)){wysihtml5.lang.object(b[c]).isFunction()?d=b[c]:"string"==typeof b[c]&&A[b[c]]&&(d=A[b[c]]),e=a.querySelectorAll(c);for(var f=e.length;f--;)d(e[f])}}function k(a,b){var c,e,j,f=g.tags,h=a.nodeName.toLowerCase(),i=a.scopeName;if(a._wysihtml5)return null;if(a._wysihtml5=1,"wysihtml5-temp"===a.className)return null;if(i&&"HTML"!=i&&(h=i+":"+h),"outerHTML"in a&&(wysihtml5.browser.autoClosesUnclosedTags()||"P"!==a.nodeName||"</p>"===a.outerHTML.slice(-4).toLowerCase()||(h="div")),h in f){if(c=f[h],!c||c.remove)return null;if(c.unwrap)return!1;c="string"==typeof c?{rename_tag:c}:c}else{if(!a.firstChild)return null;c={rename_tag:d}}if(c.one_of_type&&!l(a,g,c.one_of_type,b)){if(!c.remove_action)return null;if("unwrap"===c.remove_action)return!1;if("rename"!==c.remove_action)return null;j=c.remove_action_rename_to||d}return e=a.ownerDocument.createElement(j||c.rename_tag||h),s(a,e,c,b),o(a,e,c),a=null,e.normalize&&e.normalize(),e}function l(a,b,c,d){var e,f;if("SPAN"===a.nodeName&&!d&&("_wysihtml5-temp-placeholder"===a.className||"rangySelectionBoundary"===a.className))return!0;for(f in c)if(c.hasOwnProperty(f)&&b.type_definitions&&b.type_definitions[f]&&(e=b.type_definitions[f],n(a,e)))return!0;return!1}function n(a,b){var f,g,i,j,l,c=a.getAttribute("class"),d=a.getAttribute("style");if(b.methods)for(var m in b.methods)if(b.methods.hasOwnProperty(m)&&z[m]&&z[m](a))return!0;if(c&&b.classes){c=c.replace(/^\s+/g,"").replace(/\s+$/g,"").split(e),f=c.length;for(var n=0;n<f;n++)if(b.classes[c[n]])return!0}if(d&&b.styles){d=d.split(";");for(g in b.styles)if(b.styles.hasOwnProperty(g))for(var o=d.length;o--;)if(l=d[o].split(":"),l[0].replace(/\s/g,"").toLowerCase()===g&&(b.styles[g]===!0||1===b.styles[g]||wysihtml5.lang.array(b.styles[g]).contains(l[1].replace(/\s/g,"").toLowerCase())))return!0}if(b.attrs)for(i in b.attrs)if(b.attrs.hasOwnProperty(i)&&(j=wysihtml5.dom.getAttribute(a,i),"string"==typeof j&&j.search(b.attrs[i])>-1))return!0;return!1}function o(a,b,c){var d,e;if(c&&c.keep_styles)for(d in c.keep_styles)if(c.keep_styles.hasOwnProperty(d)){if(e="float"===d?a.style.styleFloat||a.style.cssFloat:a.style[d],c.keep_styles[d]instanceof RegExp&&!c.keep_styles[d].test(e))continue;"float"===d?b.style[a.style.styleFloat?"styleFloat":"cssFloat"]=e:a.style[d]&&(b.style[d]=e)}}function p(a,b){var c=[];for(var d in b)b.hasOwnProperty(d)&&0===d.indexOf(a)&&c.push(d);return c}function q(a,b,c,d){var f,e=w[c];return!(!e||!(b||"alt"===a&&"IMG"==d)||(f=e(b),"string"!=typeof f))&&f}function r(a,b){var h,i,j,c=wysihtml5.lang.object(g.attributes||{}).clone(),d=wysihtml5.lang.object(c).merge(wysihtml5.lang.object(b||{}).clone()).get(),e={},f=wysihtml5.dom.getAttributes(a);for(h in d)if(/\*$/.test(h)){j=p(h.slice(0,-1),f);for(var k=0,l=j.length;k<l;k++)i=q(j[k],f[j[k]],d[h],a.nodeName),i!==!1&&(e[j[k]]=i)}else i=q(h,f[h],d[h],a.nodeName),i!==!1&&(e[h]=i);return e}function s(a,b,c,d){var s,u,v,w,z,f={},h=c.set_class,i=c.add_class,j=c.add_style,k=c.set_attributes,l=g.classes,m=0,n=[],o=[],p=[],q=[];if(k&&(f=wysihtml5.lang.object(k).clone()),f=wysihtml5.lang.object(f).merge(r(a,c.check_attributes)).get(),h&&n.push(h),i)for(w in i)z=y[i[w]],z&&(v=z(wysihtml5.dom.getAttribute(a,w)),"string"==typeof v&&n.push(v));if(j)for(w in j)z=x[j[w]],z&&(newStyle=z(wysihtml5.dom.getAttribute(a,w)),"string"==typeof newStyle&&o.push(newStyle));if("string"==typeof l&&"any"===l&&a.getAttribute("class"))if(g.classes_blacklist){for(q=a.getAttribute("class"),q&&(n=n.concat(q.split(e))),s=n.length;m<s;m++)u=n[m],g.classes_blacklist[u]||p.push(u);p.length&&(f.class=wysihtml5.lang.array(p).unique().join(" "))}else f.class=a.getAttribute("class");else{for(d||(l["_wysihtml5-temp-placeholder"]=1,l._rangySelectionBoundary=1,l["wysiwyg-tmp-selected-cell"]=1),q=a.getAttribute("class"),q&&(n=n.concat(q.split(e))),s=n.length;m<s;m++)u=n[m],l[u]&&p.push(u);p.length&&(f.class=wysihtml5.lang.array(p).unique().join(" "))}f.class&&d&&(f.class=f.class.replace("wysiwyg-tmp-selected-cell",""),/^\s*$/g.test(f.class)&&delete f.class),o.length&&(f.style=wysihtml5.lang.array(o).unique().join(" "));for(w in f)try{b.setAttribute(w,f[w])}catch(a){}f.src&&("undefined"!=typeof f.width&&b.setAttribute("width",f.width),"undefined"!=typeof f.height&&b.setAttribute("height",f.height))}function u(a){var b=a.nextSibling;if(!b||b.nodeType!==wysihtml5.TEXT_NODE){var c=a.data.replace(t,"");return a.ownerDocument.createTextNode(c)}b.data=a.data.replace(t,"")+b.data.replace(t,"")}function v(a){if(g.comments)return a.ownerDocument.createComment(a.nodeValue)}var c={1:k,3:u,8:v},d="span",e=/\s+/,f={tags:{},classes:{}},g={},t=/\uFEFF/g,w={url:function(){var a=/^https?:\/\//i;return function(b){return b&&b.match(a)?b.replace(a,function(a){return a.toLowerCase()}):null}}(),src:function(){var a=/^(\/|https?:\/\/)/i;return function(b){return b&&b.match(a)?b.replace(a,function(a){return a.toLowerCase()}):null}}(),href:function(){var a=/^(#|\/|https?:\/\/|mailto:)/i;return function(b){return b&&b.match(a)?b.replace(a,function(a){return a.toLowerCase()}):null}}(),alt:function(){var a=/[^ a-z0-9_\-]/gi;return function(b){return b?b.replace(a,""):""}}(),numbers:function(){var a=/\D/g;return function(b){return b=(b||"").replace(a,""),b||null}}(),any:function(){return function(a){return a}}()},x={align_text:function(){var a={left:"text-align: left;",right:"text-align: right;",center:"text-align: center;"};return function(b){return a[String(b).toLowerCase()]}}()},y={align_img:function(){var a={left:"wysiwyg-float-left",right:"wysiwyg-float-right"};return function(b){return a[String(b).toLowerCase()]}}(),align_text:function(){var a={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"};return function(b){return a[String(b).toLowerCase()]}}(),clear_br:function(){var a={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"};return function(b){return a[String(b).toLowerCase()]}}(),size_font:function(){var a={1:"wysiwyg-font-size-xx-small",2:"wysiwyg-font-size-small",3:"wysiwyg-font-size-medium",4:"wysiwyg-font-size-large",5:"wysiwyg-font-size-x-large",6:"wysiwyg-font-size-xx-large",7:"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"};return function(b){return a[String(b).charAt(0)]}}()},z={has_visible_contet:function(){var a,c=["img","video","picture","br","script","noscript","style","table","iframe","object","embed","audio","svg","input","button","select","textarea","canvas"];return function(b){if(a=(b.innerText||b.textContent).replace(/\s/g,""),a&&a.length>0)return!0;for(var d=c.length;d--;)if(b.querySelector(c[d]))return!0;return!!(b.offsetWidth&&b.offsetWidth>0&&b.offsetHeight&&b.offsetHeight>0)}}()},A={unwrap:function(a){wysihtml5.dom.unwrap(a)},remove:function(a){a.parentNode.removeChild(a)}};return h(a,b)},wysihtml5.dom.removeEmptyTextNodes=function(a){for(var b,c=wysihtml5.lang.array(a.childNodes).get(),d=c.length,e=0;e<d;e++)b=c[e],b.nodeType===wysihtml5.TEXT_NODE&&""===b.data&&b.parentNode.removeChild(b)},wysihtml5.dom.renameElement=function(a,b){for(var d,c=a.ownerDocument.createElement(b);d=a.firstChild;)c.appendChild(d);return wysihtml5.dom.copyAttributes(["align","className"]).from(a).to(c),a.parentNode.replaceChild(c,a),c},wysihtml5.dom.replaceWithChildNodes=function(a){if(a.parentNode){if(!a.firstChild)return void a.parentNode.removeChild(a);for(var b=a.ownerDocument.createDocumentFragment();a.firstChild;)b.appendChild(a.firstChild);a.parentNode.replaceChild(b,a),a=b=null}},function(a){function b(b){return"block"===a.getStyle("display").from(b)}function c(a){return"BR"===a.nodeName}function d(a){var b=a.ownerDocument.createElement("br");a.appendChild(b)}function e(a,e){if(a.nodeName.match(/^(MENU|UL|OL)$/)){var i,j,k,l,m,n,f=a.ownerDocument,g=f.createDocumentFragment(),h=wysihtml5.dom.domNode(a).prev({ignoreBlankTexts:!0});if(e)for(!h||b(h)||c(h)||d(g);n=a.firstElementChild||a.firstChild;){for(j=n.lastChild;i=n.firstChild;)k=i===j,l=k&&!b(i)&&!c(i),g.appendChild(i),l&&d(g);n.parentNode.removeChild(n)}else for(;n=a.firstElementChild||a.firstChild;){if(n.querySelector&&n.querySelector("div, p, ul, ol, menu, blockquote, h1, h2, h3, h4, h5, h6"))for(;i=n.firstChild;)g.appendChild(i);else{for(m=f.createElement("p");i=n.firstChild;)m.appendChild(i);g.appendChild(m)}n.parentNode.removeChild(n)}a.parentNode.replaceChild(g,a)}}a.resolveList=e}(wysihtml5.dom),function(a){var b=document,c=["parent","top","opener","frameElement","frames","localStorage","globalStorage","sessionStorage","indexedDB"],d=["open","close","openDialog","showModalDialog","alert","confirm","prompt","openDatabase","postMessage","XMLHttpRequest","XDomainRequest"],e=["referrer","write","open","close"];a.dom.Sandbox=Base.extend({constructor:function(b,c){this.callback=b||a.EMPTY_FUNCTION,this.config=a.lang.object({}).merge(c).get(),this.editableArea=this._createIframe()},insertInto:function(a){"string"==typeof a&&(a=b.getElementById(a)),a.appendChild(this.editableArea)},getIframe:function(){return this.editableArea},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var a=this.getIframe();a.parentNode.removeChild(a)},_readyError:function(){throw new Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet")},_createIframe:function(){var c=this,d=b.createElement("iframe");return d.className="wysihtml5-sandbox",a.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(d),a.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(d.src="javascript:'<html></html>'"),d.onload=function(){d.onreadystatechange=d.onload=null,c._onLoadIframe(d)},d.onreadystatechange=function(){/loaded|complete/.test(d.readyState)&&(d.onreadystatechange=d.onload=null,c._onLoadIframe(d))},d},_onLoadIframe:function(f){if(a.dom.contains(b.documentElement,f)){var g=this,h=f.contentWindow,i=f.contentWindow.document,j=b.characterSet||b.charset||"utf-8",k=this._getHtml({charset:j,stylesheets:this.config.stylesheets});if(i.open("text/html","replace"),i.write(k),i.close(),this.getWindow=function(){return f.contentWindow},this.getDocument=function(){return f.contentWindow.document},h.onerror=function(a,b,c){throw new Error("wysihtml5.Sandbox: "+a,b,c)},!a.browser.supportsSandboxedIframes()){var l,m;for(l=0,m=c.length;l<m;l++)this._unset(h,c[l]);for(l=0,m=d.length;l<m;l++)this._unset(h,d[l],a.EMPTY_FUNCTION);for(l=0,m=e.length;l<m;l++)this._unset(i,e[l]);this._unset(i,"cookie","",!0)}this.loaded=!0,setTimeout(function(){g.callback(g)},0)}},_getHtml:function(b){var f,c=b.stylesheets,d="",e=0;if(c="string"==typeof c?[c]:c)for(f=c.length;e<f;e++)d+='<link rel="stylesheet" href="'+c[e]+'">';return b.stylesheets=d,a.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(b)},_unset:function(b,c,d,e){try{b[c]=d}catch(a){}try{b.__defineGetter__(c,function(){return d})}catch(a){}if(e)try{b.__defineSetter__(c,function(){})}catch(a){}if(!a.browser.crashesWhenDefineProperty(c))try{var f={get:function(){return d}};e&&(f.set=function(){}),Object.defineProperty(b,c,f)}catch(a){}}})}(wysihtml5),function(a){var b=document;a.dom.ContentEditableArea=Base.extend({getContentEditable:function(){return this.element},getWindow:function(){return this.element.ownerDocument.defaultView},getDocument:function(){return this.element.ownerDocument},constructor:function(b,c,d){this.callback=b||a.EMPTY_FUNCTION,this.config=a.lang.object({}).merge(c).get(),d?this.element=this._bindElement(d):this.element=this._createElement()},_createElement:function(){var a=b.createElement("div");return a.className="wysihtml5-sandbox",this._loadElement(a),a},_bindElement:function(a){return a.className=a.className&&""!=a.className?a.className+" wysihtml5-sandbox":"wysihtml5-sandbox",this._loadElement(a,!0),a},_loadElement:function(a,b){var c=this;if(!b){var d=this._getHtml();a.innerHTML=d}this.getWindow=function(){return a.ownerDocument.defaultView},this.getDocument=function(){return a.ownerDocument},this.loaded=!0,setTimeout(function(){c.callback(c)},0)},_getHtml:function(a){return""}})}(wysihtml5),function(){var a={className:"class"};wysihtml5.dom.setAttributes=function(b){return{on:function(c){for(var d in b)c.setAttribute(a[d]||d,b[d])}}}}(),wysihtml5.dom.setStyles=function(a){return{on:function(b){var c=b.style;if("string"==typeof a)return void(c.cssText+=";"+a);for(var d in a)"float"===d?(c.cssFloat=a[d],c.styleFloat=a[d]):c[d]=a[d]}}},function(a){a.simulatePlaceholder=function(b,c,d){var e="placeholder",f=function(){var b=c.element.offsetWidth>0&&c.element.offsetHeight>0;c.hasPlaceholderSet()&&(c.clear(),c.element.focus(),b&&setTimeout(function(){var a=c.selection.getSelection();a.focusNode&&a.anchorNode||c.selection.selectNode(c.element.firstChild||c.element)},0)),c.placeholderSet=!1,a.removeClass(c.element,e)},g=function(){c.isEmpty()&&(c.placeholderSet=!0,c.setValue(d),a.addClass(c.element,e))};b.on("set_placeholder",g).on("unset_placeholder",f).on("focus:composer",f).on("paste:composer",f).on("blur:composer",g),g()}}(wysihtml5.dom),function(a){var b=document.documentElement;"textContent"in b?(a.setTextContent=function(a,b){a.textContent=b},a.getTextContent=function(a){return a.textContent}):"innerText"in b?(a.setTextContent=function(a,b){a.innerText=b},a.getTextContent=function(a){return a.innerText}):(a.setTextContent=function(a,b){a.nodeValue=b},a.getTextContent=function(a){return a.nodeValue})}(wysihtml5.dom),wysihtml5.dom.getAttribute=function(a,b){var c=!wysihtml5.browser.supportsGetAttributeCorrectly();b=b.toLowerCase();var d=a.nodeName;if("IMG"==d&&"src"==b&&wysihtml5.dom.isLoadedImage(a)===!0)return a.src;if(c&&"outerHTML"in a){var e=a.outerHTML.toLowerCase(),f=e.indexOf(" "+b+"=")!=-1;return f?a.getAttribute(b):null}return a.getAttribute(b)},wysihtml5.dom.getAttributes=function(a){var e,b=!wysihtml5.browser.supportsGetAttributeCorrectly(),c=a.nodeName,d=[];for(e in a.attributes)(a.attributes.hasOwnProperty&&a.attributes.hasOwnProperty(e)||!a.attributes.hasOwnProperty&&Object.prototype.hasOwnProperty.call(a.attributes,e))&&a.attributes[e].specified&&("IMG"==c&&"src"==a.attributes[e].name.toLowerCase()&&wysihtml5.dom.isLoadedImage(a)===!0?d.src=a.src:wysihtml5.lang.array(["rowspan","colspan"]).contains(a.attributes[e].name.toLowerCase())&&b?1!==a.attributes[e].value&&(d[a.attributes[e].name]=a.attributes[e].value):d[a.attributes[e].name]=a.attributes[e].value);return d},wysihtml5.dom.isLoadedImage=function(a){try{return a.complete&&!a.mozMatchesSelector(":-moz-broken")}catch(b){if(a.complete&&"complete"===a.readyState)return!0}},function(a){function f(a,b){for(var d,c=[],e=0,f=a.length;e<f;e++)if(d=a[e].querySelectorAll(b))for(var g=d.length;g--;c.unshift(d[g]));return c}function g(a){a.parentNode.removeChild(a)}function h(a,b){a.parentNode.insertBefore(b,a.nextSibling)}function i(a,b){for(var c=a.nextSibling;1!=c.nodeType;)if(c=c.nextSibling,!b||b==c.tagName.toLowerCase())return c;return null}var b=a.dom,d=function(a){this.el=a,this.isColspan=!1,this.isRowspan=!1,this.firstCol=!0,this.lastCol=!0,this.firstRow=!0,this.lastRow=!0,this.isReal=!0,this.spanCollection=[],this.modified=!1},e=function(a,c){a?(this.cell=a,this.table=b.getParentElement(a,{nodeName:["TABLE"]})):c&&(this.table=c,this.cell=this.table.querySelectorAll("th, td")[0])};e.prototype={addSpannedCellToMap:function(a,b,c,e,f,g){for(var h=[],i=c+(g?parseInt(g,10)-1:0),j=e+(f?parseInt(f,10)-1:0),k=c;k<=i;k++){"undefined"==typeof b[k]&&(b[k]=[]);for(var l=e;l<=j;l++)b[k][l]=new d(a),b[k][l].isColspan=f&&parseInt(f,10)>1,b[k][l].isRowspan=g&&parseInt(g,10)>1,b[k][l].firstCol=l==e,b[k][l].lastCol=l==j,b[k][l].firstRow=k==c,b[k][l].lastRow=k==i,b[k][l].isReal=l==e&&k==c,b[k][l].spanCollection=h,h.push(b[k][l])}},setCellAsModified:function(a){if(a.modified=!0,a.spanCollection.length>0)for(var b=0,c=a.spanCollection.length;b<c;b++)a.spanCollection[b].modified=!0},setTableMap:function(){var e,f,g,h,i,j,k,l,a=[],c=this.getTableRows();for(e=0;e<c.length;e++)for(f=c[e],g=this.getRowCells(f),j=0,"undefined"==typeof a[e]&&(a[e]=[]),h=0;h<g.length;h++){for(i=g[h];"undefined"!=typeof a[e][j];)j++;k=b.getAttribute(i,"colspan"),l=b.getAttribute(i,"rowspan"),k||l?(this.addSpannedCellToMap(i,a,e,j,k,l),j+=k?parseInt(k,10):1):(a[e][j]=new d(i),j++)}return this.map=a,a},getRowCells:function(b){var c=this.table.querySelectorAll("table"),d=c?f(c,"th, td"):[],e=b.querySelectorAll("th, td"),g=d.length>0?a.lang.array(e).without(d):e;return g},getTableRows:function(){var b=this.table.querySelectorAll("table"),c=b?f(b,"tr"):[],d=this.table.querySelectorAll("tr"),e=c.length>0?a.lang.array(d).without(c):d;return e},getMapIndex:function(a){for(var b=this.map.length,c=this.map&&this.map[0]?this.map[0].length:0,d=0;d<b;d++)for(var e=0;e<c;e++)if(this.map[d][e].el===a)return{row:d,col:e};return!1},getElementAtIndex:function(a){return this.setTableMap(),this.map[a.row]&&this.map[a.row][a.col]&&this.map[a.row][a.col].el?this.map[a.row][a.col].el:null},getMapElsTo:function(a){var b=[];if(this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(a),this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var c=this.idx_start;this.idx_start=this.idx_end,this.idx_end=c}if(this.idx_start.col>this.idx_end.col){var d=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=d}if(null!=this.idx_start&&null!=this.idx_end)for(var e=this.idx_start.row,f=this.idx_end.row;e<=f;e++)for(var g=this.idx_start.col,h=this.idx_end.col;g<=h;g++)b.push(this.map[e][g].el);return b},orderSelectionEnds:function(a){if(this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(a),this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var b=this.idx_start;this.idx_start=this.idx_end,this.idx_end=b}if(this.idx_start.col>this.idx_end.col){var c=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=c}return{start:this.map[this.idx_start.row][this.idx_start.col].el,end:this.map[this.idx_end.row][this.idx_end.col].el}},createCells:function(a,b,c){for(var f,d=this.table.ownerDocument,e=d.createDocumentFragment(),g=0;g<b;g++){if(f=d.createElement(a),c)for(var h in c)c.hasOwnProperty(h)&&f.setAttribute(h,c[h]);f.appendChild(document.createTextNode(" ")),e.appendChild(f)}return e},correctColIndexForUnreals:function(a,b){for(var c=this.map[b],d=-1,e=0;e<a;e++)c[e].isReal&&d++;return d},getLastNewCellOnRow:function(a,b){for(var d,e,c=this.getRowCells(a),f=0,g=c.length;f<g;f++)if(d=c[f],e=this.getMapIndex(d),e===!1||"undefined"!=typeof b&&e.row!=b)return d;return null},removeEmptyTable:function(){var a=this.table.querySelectorAll("td, th");return(!a||0==a.length)&&(g(this.table),!0)},splitRowToCells:function(a){if(a.isColspan){var c=parseInt(b.getAttribute(a.el,"colspan")||1,10),d=a.el.tagName.toLowerCase();if(c>1){var e=this.createCells(d,c-1);h(a.el,e)}a.el.removeAttribute("colspan")}},getRealRowEl:function(a,c){var d=null,e=null;c=c||this.idx;for(var f=0,g=this.map[c.row].length;f<g;f++)if(e=this.map[c.row][f],e.isReal&&(d=b.getParentElement(e.el,{nodeName:["TR"]})))return d;return null===d&&a&&(d=b.getParentElement(this.map[c.row][c.col].el,{nodeName:["TR"]})||null),d},injectRowAt:function(a,c,d,e,f){var g=this.getRealRowEl(!1,{row:a,col:c}),i=this.createCells(e,d);if(g){var j=this.correctColIndexForUnreals(c,a);j>=0?h(this.getRowCells(g)[j],i):g.insertBefore(i,g.firstChild)}else{var k=this.table.ownerDocument.createElement("tr");k.appendChild(i),h(b.getParentElement(f.el,{nodeName:["TR"]}),k)}},canMerge:function(a){if(this.to=a,this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(this.to),this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var b=this.idx_start;this.idx_start=this.idx_end,this.idx_end=b}if(this.idx_start.col>this.idx_end.col){var c=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=c}for(var d=this.idx_start.row,e=this.idx_end.row;d<=e;d++)for(var f=this.idx_start.col,g=this.idx_end.col;f<=g;f++)if(this.map[d][f].isColspan||this.map[d][f].isRowspan)return!1;return!0},decreaseCellSpan:function(a,c){var d=parseInt(b.getAttribute(a.el,c),10)-1;d>=1?a.el.setAttribute(c,d):(a.el.removeAttribute(c),"colspan"==c&&(a.isColspan=!1),"rowspan"==c&&(a.isRowspan=!1),a.firstCol=!0,a.lastCol=!0,a.firstRow=!0,a.lastRow=!0,a.isReal=!0)},removeSurplusLines:function(){var a,c,d,e,f,h,i;if(this.setTableMap(),this.map){for(d=0,e=this.map.length;d<e;d++){for(a=this.map[d],i=!0,f=0,h=a.length;f<h;f++)if(c=a[f],!(b.getAttribute(c.el,"rowspan")&&parseInt(b.getAttribute(c.el,"rowspan"),10)>1&&c.firstRow!==!0)){i=!1;break}if(i)for(f=0;f<h;f++)this.decreaseCellSpan(a[f],"rowspan")}var j=this.getTableRows();for(d=0,e=j.length;d<e;d++)a=j[d],0==a.childNodes.length&&/^\s*$/.test(a.textContent||a.innerText)&&g(a)}},fillMissingCells:function(){var a=0,b=0,c=null;if(this.setTableMap(),this.map){a=this.map.length;for(var e=0;e<a;e++)this.map[e].length>b&&(b=this.map[e].length);for(var f=0;f<a;f++)for(var g=0;g<b;g++)this.map[f]&&!this.map[f][g]&&g>0&&(this.map[f][g]=new d(this.createCells("td",1)),c=this.map[f][g-1],c&&c.el&&c.el.parent&&h(this.map[f][g-1].el,this.map[f][g].el))}},rectify:function(){return!this.removeEmptyTable()&&(this.removeSurplusLines(),this.fillMissingCells(),!0)},unmerge:function(){if(this.rectify()&&(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx)){var a=this.map[this.idx.row][this.idx.col],c=b.getAttribute(a.el,"colspan")?parseInt(b.getAttribute(a.el,"colspan"),10):1,d=a.el.tagName.toLowerCase();if(a.isRowspan){var e=parseInt(b.getAttribute(a.el,"rowspan"),10);if(e>1)for(var f=1,g=e-1;f<=g;f++)this.injectRowAt(this.idx.row+f,this.idx.col,c,d,a);a.el.removeAttribute("rowspan")}this.splitRowToCells(a)}},merge:function(a){if(this.rectify())if(this.canMerge(a)){for(var b=this.idx_end.row-this.idx_start.row+1,c=this.idx_end.col-this.idx_start.col+1,d=this.idx_start.row,e=this.idx_end.row;d<=e;d++)for(var f=this.idx_start.col,h=this.idx_end.col;f<=h;f++)d==this.idx_start.row&&f==this.idx_start.col?(b>1&&this.map[d][f].el.setAttribute("rowspan",b),c>1&&this.map[d][f].el.setAttribute("colspan",c)):(/^\s*<br\/?>\s*$/.test(this.map[d][f].el.innerHTML.toLowerCase())||(this.map[this.idx_start.row][this.idx_start.col].el.innerHTML+=" "+this.map[d][f].el.innerHTML),g(this.map[d][f].el));this.rectify()}else window.console&&console.log("Do not know how to merge allready merged cells.")},collapseCellToNextRow:function(a){var c=this.getMapIndex(a.el),d=c.row+1,e={row:d,col:c.col};if(d<this.map.length){var f=this.getRealRowEl(!1,e);if(null!==f){var g=this.correctColIndexForUnreals(e.col,e.row);if(g>=0)h(this.getRowCells(f)[g],a.el);else{var i=this.getLastNewCellOnRow(f,d);null!==i?h(i,a.el):f.insertBefore(a.el,f.firstChild)}parseInt(b.getAttribute(a.el,"rowspan"),10)>2?a.el.setAttribute("rowspan",parseInt(b.getAttribute(a.el,"rowspan"),10)-1):a.el.removeAttribute("rowspan")}}},removeRowCell:function(a){a.isReal?a.isRowspan?this.collapseCellToNextRow(a):g(a.el):parseInt(b.getAttribute(a.el,"rowspan"),10)>2?a.el.setAttribute("rowspan",parseInt(b.getAttribute(a.el,"rowspan"),10)-1):a.el.removeAttribute("rowspan")},getRowElementsByCell:function(){var a=[];if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(var b=this.map[this.idx.row],c=0,d=b.length;c<d;c++)b[c].isReal&&a.push(b[c].el);return a},getColumnElementsByCell:function(){var a=[];if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(var b=0,c=this.map.length;b<c;b++)this.map[b][this.idx.col]&&this.map[b][this.idx.col].isReal&&a.push(this.map[b][this.idx.col].el);return a},removeRow:function(){var a=b.getParentElement(this.cell,{nodeName:["TR"]});if(a){if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(var c=this.map[this.idx.row],d=0,e=c.length;d<e;d++)c[d].modified||(this.setCellAsModified(c[d]),this.removeRowCell(c[d]));g(a)}},removeColCell:function(a){a.isColspan?parseInt(b.getAttribute(a.el,"colspan"),10)>2?a.el.setAttribute("colspan",parseInt(b.getAttribute(a.el,"colspan"),10)-1):a.el.removeAttribute("colspan"):a.isReal&&g(a.el)},removeColumn:function(){if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(var a=0,b=this.map.length;a<b;a++)this.map[a][this.idx.col].modified||(this.setCellAsModified(this.map[a][this.idx.col]),this.removeColCell(this.map[a][this.idx.col]))},remove:function(a){if(this.rectify()){switch(a){case"row":this.removeRow();break;case"column":this.removeColumn()}this.rectify()}},addRow:function(a){var c=this.table.ownerDocument;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),"below"==a&&b.getAttribute(this.cell,"rowspan")&&(this.idx.row=this.idx.row+parseInt(b.getAttribute(this.cell,"rowspan"),10)-1),this.idx!==!1){for(var d=this.map[this.idx.row],e=c.createElement("tr"),f=0,g=d.length;f<g;f++)d[f].modified||(this.setCellAsModified(d[f]),this.addRowCell(d[f],e,a));switch(a){case"below":h(this.getRealRowEl(!0),e);break;case"above":var i=b.getParentElement(this.map[this.idx.row][this.idx.col].el,{nodeName:["TR"]});i&&i.parentNode.insertBefore(e,i)}}},addRowCell:function(a,d,e){var f=a.isColspan?{colspan:b.getAttribute(a.el,"colspan")}:null;a.isReal?"above"!=e&&a.isRowspan?a.el.setAttribute("rowspan",parseInt(b.getAttribute(a.el,"rowspan"),10)+1):d.appendChild(this.createCells("td",1,f)):"above"!=e&&a.isRowspan&&a.lastRow?d.appendChild(this.createCells("td",1,f)):c.isRowspan&&a.el.attr("rowspan",parseInt(b.getAttribute(a.el,"rowspan"),10)+1)},add:function(a){this.rectify()&&("below"!=a&&"above"!=a||this.addRow(a),"before"!=a&&"after"!=a||this.addColumn(a))},addColCell:function(a,d,e){var f,g=a.el.tagName.toLowerCase();switch(e){case"before":f=!a.isColspan||a.firstCol;break;case"after":f=!a.isColspan||a.lastCol||a.isColspan&&c.el==this.cell}if(f){switch(e){case"before":a.el.parentNode.insertBefore(this.createCells(g,1),a.el);break;case"after":h(a.el,this.createCells(g,1))}a.isRowspan&&this.handleCellAddWithRowspan(a,d+1,e)}else a.el.setAttribute("colspan",parseInt(b.getAttribute(a.el,"colspan"),10)+1)},addColumn:function(a){var c,d;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),"after"==a&&b.getAttribute(this.cell,"colspan")&&(this.idx.col=this.idx.col+parseInt(b.getAttribute(this.cell,"colspan"),10)-1),this.idx!==!1)for(var e=0,f=this.map.length;e<f;e++)c=this.map[e],c[this.idx.col]&&(d=c[this.idx.col],d.modified||(this.setCellAsModified(d),this.addColCell(d,e,a)))},handleCellAddWithRowspan:function(a,c,d){for(var j,k,m,e=parseInt(b.getAttribute(this.cell,"rowspan"),10)-1,f=b.getParentElement(a.el,{
nodeName:["TR"]}),g=a.el.tagName.toLowerCase(),l=this.table.ownerDocument,n=0;n<e;n++)if(j=this.correctColIndexForUnreals(this.idx.col,c+n),f=i(f,"tr"))if(j>0)switch(d){case"before":k=this.getRowCells(f),j>0&&this.map[c+n][this.idx.col].el!=k[j]&&j==k.length-1?h(k[j],this.createCells(g,1)):k[j].parentNode.insertBefore(this.createCells(g,1),k[j]);break;case"after":h(this.getRowCells(f)[j],this.createCells(g,1))}else f.insertBefore(this.createCells(g,1),f.firstChild);else m=l.createElement("tr"),m.appendChild(this.createCells(g,1)),this.table.appendChild(m)}},b.table={getCellsBetween:function(a,b){var c=new e(a);return c.getMapElsTo(b)},addCells:function(a,b){var c=new e(a);c.add(b)},removeCells:function(a,b){var c=new e(a);c.remove(b)},mergeCellsBetween:function(a,b){var c=new e(a);c.merge(b)},unmergeCell:function(a){var b=new e(a);b.unmerge()},orderSelectionEnds:function(a,b){var c=new e(a);return c.orderSelectionEnds(b)},indexOf:function(a){var b=new e(a);return b.setTableMap(),b.getMapIndex(a)},findCell:function(a,b){var c=new e(null,a);return c.getElementAtIndex(b)},findRowByCell:function(a){var b=new e(a);return b.getRowElementsByCell()},findColumnByCell:function(a){var b=new e(a);return b.getColumnElementsByCell()},canMerge:function(a,b){var c=new e(a);return c.canMerge(b)}}}(wysihtml5),wysihtml5.dom.query=function(a,b){var d,c=[];a.nodeType&&(a=[a]);for(var e=0,f=a.length;e<f;e++)if(d=a[e].querySelectorAll(b))for(var g=d.length;g--;c.unshift(d[g]));return c},wysihtml5.dom.compareDocumentPosition=function(){var a=document.documentElement;return a.compareDocumentPosition?function(a,b){return a.compareDocumentPosition(b)}:function(a,b){var c,d;if(c=9===a.nodeType?a:a.ownerDocument,d=9===b.nodeType?b:b.ownerDocument,a===b)return 0;if(a===b.ownerDocument)return 20;if(a.ownerDocument===b)return 10;if(c!==d)return 1;if(2===a.nodeType&&a.childNodes&&wysihtml5.lang.array(a.childNodes).indexOf(b)!==-1)return 20;if(2===b.nodeType&&b.childNodes&&wysihtml5.lang.array(b.childNodes).indexOf(a)!==-1)return 10;for(var e=a,f=[],g=null;e;){if(e==b)return 10;f.push(e),e=e.parentNode}for(e=b,g=null;e;){if(e==a)return 20;var h=wysihtml5.lang.array(f).indexOf(e);if(h!==-1){var i=f[h],j=wysihtml5.lang.array(i.childNodes).indexOf(f[h-1]),k=wysihtml5.lang.array(i.childNodes).indexOf(g);return j>k?2:4}g=e,e=e.parentNode}return 1}}(),wysihtml5.dom.unwrap=function(a){if(a.parentNode){for(;a.lastChild;)wysihtml5.dom.insert(a.lastChild).after(a);a.parentNode.removeChild(a)}},wysihtml5.dom.getPastedHtml=function(a){var b;return a.clipboardData&&(wysihtml5.lang.array(a.clipboardData.types).contains("text/html")?b=a.clipboardData.getData("text/html"):wysihtml5.lang.array(a.clipboardData.types).contains("text/plain")&&(b=wysihtml5.lang.string(a.clipboardData.getData("text/plain")).escapeHTML(!0,!0))),b},wysihtml5.dom.getPastedHtmlWithDiv=function(a,b){var c=a.selection.getBookmark(),d=a.element.ownerDocument,e=d.createElement("DIV");d.body.appendChild(e),e.style.width="1px",e.style.height="1px",e.style.overflow="hidden",e.setAttribute("contenteditable","true"),e.focus(),setTimeout(function(){a.selection.setBookmark(c),b(e.innerHTML),e.parentNode.removeChild(e)},0)},wysihtml5.quirks.cleanPastedHTML=function(){var a=function(a){var b=wysihtml5.lang.string(a).trim(),c=b.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");return new RegExp("^((?!^"+c+"$).)*$","i")},b=function(b,c){var e,f,d=wysihtml5.lang.object(b).clone(!0);for(e in d.tags)if(d.tags.hasOwnProperty(e)&&d.tags[e].keep_styles)for(f in d.tags[e].keep_styles)d.tags[e].keep_styles.hasOwnProperty(f)&&c[f]&&(d.tags[e].keep_styles[f]=a(c[f]));return d},c=function(a,b){var d;if(!a)return null;for(var e=0,f=a.length;e<f;e++)if(a[e].condition||(d=a[e].set),a[e].condition&&a[e].condition.test(b))return a[e].set;return d};return function(a,d){var g,e={color:wysihtml5.dom.getStyle("color").from(d.referenceNode),fontSize:wysihtml5.dom.getStyle("font-size").from(d.referenceNode)},f=b(c(d.rules,a)||{},e);return g=wysihtml5.dom.parse(a,{rules:f,cleanUp:!0,context:d.referenceNode.ownerDocument,uneditableClass:d.uneditableClass,clearInternals:!0,unjoinNbsps:!0})}}(),wysihtml5.quirks.ensureProperClearing=function(){var a=function(){var a=this;setTimeout(function(){var b=a.innerHTML.toLowerCase();"<p>&nbsp;</p>"!=b&&"<p>&nbsp;</p><p>&nbsp;</p>"!=b||(a.innerHTML="")},0)};return function(b){wysihtml5.dom.observe(b.element,["cut","keydown"],a)}}(),function(a){var b="%7E";a.quirks.getCorrectInnerHTML=function(c){var d=c.innerHTML;if(d.indexOf(b)===-1)return d;var f,g,h,i,e=c.querySelectorAll("[href*='~'], [src*='~']");for(i=0,h=e.length;i<h;i++)f=e[i].href||e[i].src,g=a.lang.string(f).replace("~").by(b),d=a.lang.string(d).replace(g).by(f);return d}}(wysihtml5),function(a){var b="wysihtml5-quirks-redraw";a.quirks.redraw=function(c){a.dom.addClass(c,b),a.dom.removeClass(c,b);try{var d=c.ownerDocument;d.execCommand("italic",!1,null),d.execCommand("italic",!1,null)}catch(a){}}}(wysihtml5),wysihtml5.quirks.tableCellsSelection=function(a,b){function h(){return c.observe(a,"mousedown",function(a){var b=wysihtml5.dom.getParentElement(a.target,{nodeName:["TD","TH"]});b&&i(b)}),d}function i(h){d.start=h,d.end=h,d.cells=[h],d.table=c.getParentElement(d.start,{nodeName:["TABLE"]}),d.table&&(j(),c.addClass(h,e),f=c.observe(a,"mousemove",l),g=c.observe(a,"mouseup",m),b.fire("tableselectstart").fire("tableselectstart:composer"))}function j(){if(a){var b=a.querySelectorAll("."+e);if(b.length>0)for(var d=0;d<b.length;d++)c.removeClass(b[d],e)}}function k(a){for(var b=0;b<a.length;b++)c.addClass(a[b],e)}function l(a){var g,e=null,f=c.getParentElement(a.target,{nodeName:["TD","TH"]});f&&d.table&&d.start&&(e=c.getParentElement(f,{nodeName:["TABLE"]}),e&&e===d.table&&(j(),g=d.end,d.end=f,d.cells=c.table.getCellsBetween(d.start,f),d.cells.length>1&&b.composer.selection.deselect(),k(d.cells),d.end!==g&&b.fire("tableselectchange").fire("tableselectchange:composer")))}function m(a){f.stop(),g.stop(),b.fire("tableselect").fire("tableselect:composer"),setTimeout(function(){n()},0)}function n(){var e=c.observe(a.ownerDocument,"click",function(a){e.stop(),c.getParentElement(a.target,{nodeName:["TABLE"]})!=d.table&&(j(),d.table=null,d.start=null,d.end=null,b.fire("tableunselect").fire("tableunselect:composer"))})}function o(a,e){d.start=a,d.end=e,d.table=c.getParentElement(d.start,{nodeName:["TABLE"]}),selectedCells=c.table.getCellsBetween(d.start,d.end),k(selectedCells),n(),b.fire("tableselect").fire("tableselect:composer")}var c=wysihtml5.dom,d={table:null,start:null,end:null,cells:null,select:o},e="wysiwyg-tmp-selected-cell",f=null,g=null;return h()},function(a){var b=/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*([\d\.]+)\s*\)/i,c=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/i,d=/^#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/i,e=/^#([0-9a-f])([0-9a-f])([0-9a-f])/i,f=function(a){return new RegExp("(^|\\s|;)"+a+"\\s*:\\s*[^;$]+","gi")};a.quirks.styleParser={parseColor:function(g,h){var l,m,i=f(h),j=g.match(i),k=10;if(j){for(var n=j.length;n--;)j[n]=a.lang.string(j[n].split(":")[1]).trim();if(l=j[j.length-1],b.test(l))m=l.match(b);else if(c.test(l))m=l.match(c);else if(d.test(l))m=l.match(d),k=16;else if(e.test(l))return m=l.match(e),m.shift(),m.push(1),a.lang.array(m).map(function(a,b){return b<3?16*parseInt(a,16)+parseInt(a,16):parseFloat(a)});if(m)return m.shift(),m[3]||m.push(1),a.lang.array(m).map(function(a,b){return b<3?parseInt(a,k):parseFloat(a)})}return!1},unparseColor:function(a,b){if(b){if("hex"==b)return a[0].toString(16).toUpperCase()+a[1].toString(16).toUpperCase()+a[2].toString(16).toUpperCase();if("hash"==b)return"#"+a[0].toString(16).toUpperCase()+a[1].toString(16).toUpperCase()+a[2].toString(16).toUpperCase();if("rgb"==b)return"rgb("+a[0]+","+a[1]+","+a[2]+")";if("rgba"==b)return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")";if("csv"==b)return a[0]+","+a[1]+","+a[2]+","+a[3]}return a[3]&&1!==a[3]?"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")":"rgb("+a[0]+","+a[1]+","+a[2]+")"},parseFontSize:function(b){var c=b.match(f("font-size"));return!!c&&a.lang.string(c[c.length-1].split(":")[1]).trim()}}}(wysihtml5),function(a){function c(a){var b=0;if(a.parentNode)do b+=a.offsetTop||0,a=a.offsetParent;while(a);return b}function d(a,b){for(var c=0;b!==a;)if(c++,b=b.parentNode,!b)throw new Error("not a descendant of ancestor!");return c}function e(a){if(!a.canSurroundContents())for(var b=a.commonAncestorContainer,c=d(b,a.startContainer),e=d(b,a.endContainer);!a.canSurroundContents();)c>e?(a.setStartBefore(a.startContainer),c=d(b,a.startContainer)):(a.setEndAfter(a.endContainer),e=d(b,a.endContainer))}var b=a.dom;a.Selection=Base.extend({constructor:function(a,b,c){window.rangy.init(),this.editor=a,this.composer=a.composer,this.doc=this.composer.doc,this.contain=b,this.unselectableClass=c||!1},getBookmark:function(){var a=this.getRange();return a&&e(a),a&&a.cloneRange()},setBookmark:function(a){a&&this.setSelection(a)},setBefore:function(a){var b=rangy.createRange(this.doc);return b.setStartBefore(a),b.setEndBefore(a),this.setSelection(b)},setAfter:function(a){var b=rangy.createRange(this.doc);return b.setStartAfter(a),b.setEndAfter(a),this.setSelection(b)},selectNode:function(c,d){var e=rangy.createRange(this.doc),f=c.nodeType===a.ELEMENT_NODE,g="canHaveHTML"in c?c.canHaveHTML:"IMG"!==c.nodeName,h=f?c.innerHTML:c.data,i=""===h||h===a.INVISIBLE_SPACE,j=b.getStyle("display").from(c),k="block"===j||"list-item"===j;if(i&&f&&g&&!d)try{c.innerHTML=a.INVISIBLE_SPACE}catch(a){}g?e.selectNodeContents(c):e.selectNode(c),g&&i&&f?e.collapse(k):g&&i&&(e.setStartAfter(c),e.setEndAfter(c)),this.setSelection(e)},getSelectedNode:function(a){var b,c;return a&&this.doc.selection&&"Control"===this.doc.selection.type&&(c=this.doc.selection.createRange(),c&&c.length)?c.item(0):(b=this.getSelection(this.doc),b.focusNode===b.anchorNode?b.focusNode:(c=this.getRange(this.doc),c?c.commonAncestorContainer:this.doc.body))},fixSelBorders:function(){var a=this.getRange();e(a),this.setSelection(a)},getSelectedOwnNodes:function(a){for(var c=this.getOwnRanges(),d=[],e=0,f=c.length;e<f;e++)d.push(c[e].commonAncestorContainer||this.doc.body);return d},findNodesInSelection:function(b){for(var e,c=this.getOwnRanges(),d=[],f=0,g=c.length;f<g;f++)e=c[f].getNodes([1],function(c){return a.lang.array(b).contains(c.nodeName)}),d=d.concat(e);return d},containsUneditable:function(){for(var a=this.getOwnUneditables(),b=this.getSelection(),c=0,d=a.length;c<d;c++)if(b.containsNode(a[c]))return!0;return!1},deleteContents:function(){for(var a=this.getOwnRanges(),b=a.length;b--;)a[b].deleteContents();this.setSelection(a[0])},getPreviousNode:function(b,c){if(!b){var d=this.getSelection();b=d.anchorNode}if(b===this.contain)return!1;var f,e=b.previousSibling;return e!==this.contain&&(e&&3!==e.nodeType&&1!==e.nodeType?e=this.getPreviousNode(e,c):e&&3===e.nodeType&&/^\s*$/.test(e.textContent)?e=this.getPreviousNode(e,c):c&&e&&1===e.nodeType&&!a.lang.array(["BR","HR","IMG"]).contains(e.nodeName)&&/^[\s]*$/.test(e.innerHTML)?e=this.getPreviousNode(e,c):e||b===this.contain||(f=b.parentNode,f!==this.contain&&(e=this.getPreviousNode(f,c))),e!==this.contain&&e)},getSelectionParentsByTag:function(b){for(var d,c=this.getSelectedOwnNodes(),e=[],f=0,g=c.length;f<g;f++)d=c[f].nodeName&&"LI"===c[f].nodeName?c[f]:a.dom.getParentElement(c[f],{nodeName:["LI"]},!1,this.contain),d&&e.push(d);return e.length?e:null},getRangeToNodeEnd:function(){if(this.isCollapsed()){var a=this.getRange(),b=a.startContainer,c=a.startOffset,d=rangy.createRange(this.doc);return d.selectNodeContents(b),d.setStart(b,c),d}},caretIsLastInSelection:function(){var c=(rangy.createRange(this.doc),this.getSelection(),this.getRangeToNodeEnd().cloneContents()),d=c.textContent;return/^\s*$/.test(d)},caretIsFirstInSelection:function(){var b=rangy.createRange(this.doc),c=this.getSelection(),d=this.getRange(),e=d.startContainer;return e.nodeType===a.TEXT_NODE?this.isCollapsed()&&e.nodeType===a.TEXT_NODE&&/^\s*$/.test(e.data.substr(0,d.startOffset)):(b.selectNodeContents(this.getRange().commonAncestorContainer),b.collapse(!0),this.isCollapsed()&&(b.startContainer===c.anchorNode||b.endContainer===c.anchorNode)&&b.startOffset===c.anchorOffset)},caretIsInTheBeginnig:function(b){var c=this.getSelection(),d=c.anchorNode,e=c.anchorOffset;return b?0===e&&(d.nodeName&&d.nodeName===b.toUpperCase()||a.dom.getParentElement(d.parentNode,{nodeName:b},1)):0===e&&!this.getPreviousNode(d,!0)},caretIsBeforeUneditable:function(){var a=this.getSelection(),b=a.anchorNode,c=a.anchorOffset;if(0===c){var d=this.getPreviousNode(b,!0);if(d)for(var e=this.getOwnUneditables(),f=0,g=e.length;f<g;f++)if(d===e[f])return e[f]}return!1},executeAndRestoreRangy:function(a,b){var c=this.doc.defaultView||this.doc.parentWindow,d=rangy.saveSelection(c);if(d)try{a()}catch(a){setTimeout(function(){throw a},0)}else a();rangy.restoreSelection(d)},executeAndRestore:function(c,d){var k,l,m,n,o,p,q,r,e=this.doc.body,f=d&&e.scrollTop,g=d&&e.scrollLeft,h="_wysihtml5-temp-placeholder",i='<span class="'+h+'">'+a.INVISIBLE_SPACE+"</span>",j=this.getRange(!0);if(!j)return void c(e,e);j.collapsed||(q=j.cloneRange(),p=q.createContextualFragment(i),q.collapse(!1),q.insertNode(p),q.detach()),o=j.createContextualFragment(i),j.insertNode(o),p&&(k=this.contain.querySelectorAll("."+h),j.setStartBefore(k[0]),j.setEndAfter(k[k.length-1])),this.setSelection(j);try{c(j.startContainer,j.endContainer)}catch(a){setTimeout(function(){throw a},0)}if(k=this.contain.querySelectorAll("."+h),k&&k.length){r=rangy.createRange(this.doc),m=k[0].nextSibling,k.length>1&&(n=k[k.length-1].previousSibling),n&&m?(r.setStartBefore(m),r.setEndAfter(n)):(l=this.doc.createTextNode(a.INVISIBLE_SPACE),b.insert(l).after(k[0]),r.setStartBefore(l),r.setEndAfter(l)),this.setSelection(r);for(var s=k.length;s--;)k[s].parentNode.removeChild(k[s])}else this.contain.focus();d&&(e.scrollTop=f,e.scrollLeft=g);try{k.parentNode.removeChild(k)}catch(a){}},set:function(a,b){var c=rangy.createRange(this.doc);c.setStart(a,b||0),this.setSelection(c)},insertHTML:function(a){var e,c=(rangy.createRange(this.doc),this.doc.createElement("DIV")),d=this.doc.createDocumentFragment();for(c.innerHTML=a,e=c.lastChild;c.firstChild;)d.appendChild(c.firstChild);this.insertNode(d),e&&this.setAfter(e)},insertNode:function(a){var b=this.getRange();b&&b.insertNode(a)},surround:function(a){var c,b=this.getOwnRanges(),d=[];if(0==b.length)return d;for(var e=b.length;e--;){c=this.doc.createElement(a.nodeName),d.push(c),a.className&&(c.className=a.className),a.cssStyle&&c.setAttribute("style",a.cssStyle);try{b[e].surroundContents(c),this.selectNode(c)}catch(a){c.appendChild(b[e].extractContents()),b[e].insertNode(c)}}return d},deblockAndSurround:function(b){var e,f,g,c=this.doc.createElement("div"),d=rangy.createRange(this.doc);if(c.className=b.className,this.composer.commands.exec("formatBlock",b.nodeName,b.className),e=this.contain.querySelectorAll("."+b.className),e[0])for(e[0].parentNode.insertBefore(c,e[0]),d.setStartBefore(e[0]),d.setEndAfter(e[e.length-1]),f=d.extractContents();f.firstChild;)if(g=f.firstChild,1==g.nodeType&&a.dom.hasClass(g,b.className)){for(;g.firstChild;)c.appendChild(g.firstChild);"BR"!==g.nodeName&&c.appendChild(this.doc.createElement("br")),f.removeChild(g)}else c.appendChild(g);else c=null;return c},scrollIntoView:function(){var g,b=this.doc,d=5,e=b.documentElement.scrollHeight>b.documentElement.offsetHeight,f=b._wysihtml5ScrollIntoViewElement=b._wysihtml5ScrollIntoViewElement||function(){var c=b.createElement("span");return c.innerHTML=a.INVISIBLE_SPACE,c}();e&&(this.insertNode(f),g=c(f),f.parentNode.removeChild(f),g>=b.body.scrollTop+b.documentElement.offsetHeight-d&&(b.body.scrollTop=g))},selectLine:function(){a.browser.supportsSelectionModify()?this._selectLine_W3C():this.doc.selection&&this._selectLine_MSIE()},_selectLine_W3C:function(){var a=this.doc.defaultView,b=a.getSelection();b.modify("move","left","lineboundary"),b.modify("extend","right","lineboundary")},_selectLine_MSIE:function(){var d,e,f,g,h,a=this.doc.selection.createRange(),b=a.boundingTop,c=this.doc.body.scrollWidth;if(a.moveToPoint){for(0===b&&(f=this.doc.createElement("span"),this.insertNode(f),b=f.offsetTop,f.parentNode.removeChild(f)),b+=1,g=-10;g<c;g+=2)try{a.moveToPoint(g,b);break}catch(a){}for(d=b,e=this.doc.selection.createRange(),h=c;h>=0;h--)try{e.moveToPoint(h,d);break}catch(a){}a.setEndPoint("EndToEnd",e),a.select()}},getText:function(){var a=this.getSelection();return a?a.toString():""},getNodes:function(a,b){var c=this.getRange();return c?c.getNodes([a],b):[]},fixRangeOverflow:function(a){if(this.contain&&this.contain.firstChild&&a){var b=a.compareNode(this.contain);if(2!==b)1===b&&a.setStartBefore(this.contain.firstChild),0===b&&a.setEndAfter(this.contain.lastChild),3===b&&(a.setStartBefore(this.contain.firstChild),a.setEndAfter(this.contain.lastChild));else if(this._detectInlineRangeProblems(a)){var c=a.endContainer.previousElementSibling;c&&a.setEnd(c,this._endOffsetForNode(c))}}},_endOffsetForNode:function(a){var b=document.createRange();return b.selectNodeContents(a),b.endOffset},_detectInlineRangeProblems:function(a){var c=b.compareDocumentPosition(a.startContainer,a.endContainer);return 0==a.endOffset&&4&c},getRange:function(a){var b=this.getSelection(),c=b&&b.rangeCount&&b.getRangeAt(0);return a!==!0&&this.fixRangeOverflow(c),c},getOwnUneditables:function(){var c=b.query(this.contain,"."+this.unselectableClass),d=b.query(c,"."+this.unselectableClass);return a.lang.array(c).without(d)},getOwnRanges:function(){var c,a=[],b=this.getRange();if(b&&a.push(b),this.unselectableClass&&this.contain&&b){var e,d=this.getOwnUneditables();if(d.length>0)for(var f=0,g=d.length;f<g;f++){c=[];for(var h=0,i=a.length;h<i;h++){if(a[h])switch(a[h].compareNode(d[f])){case 2:break;case 3:e=a[h].cloneRange(),e.setEndBefore(d[f]),c.push(e),e=a[h].cloneRange(),e.setStartAfter(d[f]),c.push(e);break;default:c.push(a[h])}a=c}}}return a},getSelection:function(){return rangy.getSelection(this.doc.defaultView||this.doc.parentWindow)},setSelection:function(a){var b=this.doc.defaultView||this.doc.parentWindow,c=rangy.getSelection(b);return c.setSingleRange(a)},createRange:function(){return rangy.createRange(this.doc)},isCollapsed:function(){return this.getSelection().isCollapsed},getHtml:function(){return this.getSelection().toHtml()},isEndToEndInNode:function(b){var c=this.getRange(),d=c.commonAncestorContainer,e=c.startContainer,f=c.endContainer;if(d.nodeType===a.TEXT_NODE&&(d=d.parentNode),e.nodeType===a.TEXT_NODE&&!/^\s*$/.test(e.data.substr(c.startOffset)))return!1;if(f.nodeType===a.TEXT_NODE&&!/^\s*$/.test(f.data.substr(c.endOffset)))return!1;for(;e&&e!==d;){if(e.nodeType!==a.TEXT_NODE&&!a.dom.contains(d,e))return!1;if(a.dom.domNode(e).prev({ignoreBlankTexts:!0}))return!1;e=e.parentNode}for(;f&&f!==d;){if(f.nodeType!==a.TEXT_NODE&&!a.dom.contains(d,f))return!1;if(a.dom.domNode(f).next({ignoreBlankTexts:!0}))return!1;f=f.parentNode}return!!a.lang.array(b).contains(d.nodeName)&&d},deselect:function(){var a=this.getSelection();a&&a.removeAllRanges()}})}(wysihtml5),function(a,b){function e(a,b,c){if(!a.className)return!1;var d=a.className.match(c)||[];return d[d.length-1]===b}function f(a,b){if(!a.getAttribute||!a.getAttribute("style"))return!1;a.getAttribute("style").match(b);return!!a.getAttribute("style").match(b)}function g(a,b,c){a.getAttribute("style")?(j(a,c),a.getAttribute("style")&&!/^\s*$/.test(a.getAttribute("style"))?a.setAttribute("style",b+";"+a.getAttribute("style")):a.setAttribute("style",b)):a.setAttribute("style",b)}function h(a,b,c){a.className?(i(a,c),a.className+=" "+b):a.className=b}function i(a,b){a.className&&(a.className=a.className.replace(b,""))}function j(a,b){var c,d=[];if(a.getAttribute("style")){c=a.getAttribute("style").split(";");for(var e=c.length;e--;)c[e].match(b)||/^\s*$/.test(c[e])||d.push(c[e]);d.length?a.setAttribute("style",d.join(";")):a.removeAttribute("style")}}function k(a,b){var c=[],d=b.split(";"),e=a.getAttribute("style");if(e){e=e.replace(/\s/gi,"").toLowerCase(),c.push(new RegExp("(^|\\s|;)"+b.replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi"));for(var f=d.length;f-- >0;)/^\s*$/.test(d[f])||c.push(new RegExp("(^|\\s|;)"+d[f].replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi"));for(var g=0,h=c.length;g<h;g++)if(e.match(c[g]))return c[g]}return!1}function l(c,d,e,f){return e?k(c,e):f?a.dom.hasClass(c,f):b.dom.arrayContains(d,c.tagName.toLowerCase())}function m(a,b,c,d){for(var e=a.length;e--;)if(!l(a[e],b,c,d))return!1;return!!a.length}function n(a,b,c){var d=k(a,b);return d?(j(a,d),"remove"):(g(a,b,c),"change")}function o(a,b){return a.className.replace(d," ")==b.className.replace(d," ")}function p(a){for(var b=a.parentNode;a.firstChild;)b.insertBefore(a.firstChild,a);b.removeChild(a)}function q(a,b){if(a.attributes.length!=b.attributes.length)return!1;for(var e,f,g,c=0,d=a.attributes.length;c<d;++c)if(e=a.attributes[c],g=e.name,"class"!=g){if(f=b.attributes.getNamedItem(g),e.specified!=f.specified)return!1;if(e.specified&&e.nodeValue!==f.nodeValue)return!1}return!0}function r(a,c){return b.dom.isCharacterDataNode(a)?0==c?!!a.previousSibling:c!=a.length||!!a.nextSibling:c>0&&c<a.childNodes.length}function s(a,c,d,e){var f;if(b.dom.isCharacterDataNode(c)&&(0==d?(d=b.dom.getNodeIndex(c),c=c.parentNode):d==c.length?(d=b.dom.getNodeIndex(c)+1,c=c.parentNode):f=b.dom.splitDataNode(c,d)),!(f||e&&c===e)){f=c.cloneNode(!1),f.id&&f.removeAttribute("id");for(var g;g=c.childNodes[d];)f.appendChild(g);b.dom.insertAfter(f,c)}return c==a?f:s(a,f.parentNode,b.dom.getNodeIndex(f),e)}function t(b){this.isElementMerge=b.nodeType==a.ELEMENT_NODE,this.firstTextNode=this.isElementMerge?b.lastChild:b,this.textNodes=[this.firstTextNode]}function u(a,b,d,e,f,g,h){this.tagNames=a||[c],this.cssClass=b||b!==!1&&"",this.similarClassRegExp=d,this.cssStyle=f||"",this.similarStyleRegExp=g,this.normalize=e,this.applyToAnyTagName=!1,this.container=h}var c="span",d=/\s+/g;t.prototype={doMerge:function(){for(var b,c,d,a=[],e=0,f=this.textNodes.length;e<f;++e)b=this.textNodes[e],c=b.parentNode,a[e]=b.data,e&&(c.removeChild(b),c.hasChildNodes()||c.parentNode.removeChild(c));return this.firstTextNode.data=d=a.join(""),d},getLength:function(){for(var a=this.textNodes.length,b=0;a--;)b+=this.textNodes[a].length;return b},toString:function(){for(var a=[],b=0,c=this.textNodes.length;b<c;++b)a[b]="'"+this.textNodes[b].data+"'";return"[Merge("+a.join(",")+")]"}},u.prototype={getAncestorWithClass:function(c){for(var d;c;){if(d=this.cssClass?e(c,this.cssClass,this.similarClassRegExp):""===this.cssStyle,c.nodeType==a.ELEMENT_NODE&&"false"!=c.getAttribute("contenteditable")&&b.dom.arrayContains(this.tagNames,c.tagName.toLowerCase())&&d)return c;c=c.parentNode}return!1},getAncestorWithStyle:function(c){for(var d;c;){if(d=!!this.cssStyle&&f(c,this.similarStyleRegExp),c.nodeType==a.ELEMENT_NODE&&"false"!=c.getAttribute("contenteditable")&&b.dom.arrayContains(this.tagNames,c.tagName.toLowerCase())&&d)return c;c=c.parentNode}return!1},getMatchingAncestor:function(a){var b=this.getAncestorWithClass(a),c=!1;return b?this.cssStyle&&(c="class"):(b=this.getAncestorWithStyle(a),b&&(c="style")),{element:b,type:c}},postApply:function(a,b){for(var f,k,l,c=a[0],d=a[a.length-1],e=[],g=c,h=d,i=0,j=d.length,m=0,n=a.length;m<n;++m)k=a[m],l=null,k&&k.parentNode&&(l=this.getAdjacentMergeableTextNode(k.parentNode,!1)),l?(f||(f=new t(l),e.push(f)),f.textNodes.push(k),k===c&&(g=f.firstTextNode,i=g.length),k===d&&(h=f.firstTextNode,j=f.getLength())):f=null;if(d&&d.parentNode){var o=this.getAdjacentMergeableTextNode(d.parentNode,!0);o&&(f||(f=new t(d),e.push(f)),f.textNodes.push(o))}if(e.length){for(m=0,n=e.length;m<n;++m)e[m].doMerge();b.setStart(g,i),b.setEnd(h,j)}},getAdjacentMergeableTextNode:function(b,c){var f,d=b.nodeType==a.TEXT_NODE,e=d?b.parentNode:b,g=c?"nextSibling":"previousSibling";if(d){if(f=b[g],f&&f.nodeType==a.TEXT_NODE)return f}else if(f=e[g],f&&this.areElementsMergeable(b,f))return f[c?"firstChild":"lastChild"];return null},areElementsMergeable:function(a,c){return b.dom.arrayContains(this.tagNames,(a.tagName||"").toLowerCase())&&b.dom.arrayContains(this.tagNames,(c.tagName||"").toLowerCase())&&o(a,c)&&q(a,c)},createContainer:function(a){var b=a.createElement(this.tagNames[0]);return this.cssClass&&(b.className=this.cssClass),this.cssStyle&&b.setAttribute("style",this.cssStyle),b},applyToTextNode:function(a){var c=a.parentNode;if(1==c.childNodes.length&&b.dom.arrayContains(this.tagNames,c.tagName.toLowerCase()))this.cssClass&&h(c,this.cssClass,this.similarClassRegExp),this.cssStyle&&g(c,this.cssStyle,this.similarStyleRegExp);else{var d=this.createContainer(b.dom.getDocument(a));a.parentNode.insertBefore(d,a),d.appendChild(a)}},isRemovable:function(c){return b.dom.arrayContains(this.tagNames,c.tagName.toLowerCase())&&""===a.lang.string(c.className).trim()&&(!c.getAttribute("style")||""===a.lang.string(c.getAttribute("style")).trim())},undoToTextNode:function(a,b,c,d){var e=!c,f=c||d,g=!1;if(!b.containsNode(f)){var h=b.cloneRange();h.selectNode(f),h.isPointInRange(b.endContainer,b.endOffset)&&r(b.endContainer,b.endOffset)&&(s(f,b.endContainer,b.endOffset,this.container),b.setEndAfter(f)),h.isPointInRange(b.startContainer,b.startOffset)&&r(b.startContainer,b.startOffset)&&(f=s(f,b.startContainer,b.startOffset,this.container))}!e&&this.similarClassRegExp&&i(f,this.similarClassRegExp),e&&this.similarStyleRegExp&&(g="change"===n(f,this.cssStyle,this.similarStyleRegExp)),this.isRemovable(f)&&!g&&p(f)},applyToRange:function(b){for(var c,d=b.length;d--;){if(c=b[d].getNodes([a.TEXT_NODE]),!c.length)try{var e=this.createContainer(b[d].endContainer.ownerDocument);return b[d].surroundContents(e),void this.selectNode(b[d],e)}catch(a){}if(b[d].splitBoundaries(),c=b[d].getNodes([a.TEXT_NODE]),c.length){for(var f,g=0,h=c.length;g<h;++g)f=c[g],this.getMatchingAncestor(f).element||this.applyToTextNode(f);b[d].setStart(c[0],0),f=c[c.length-1],b[d].setEnd(f,f.length),this.normalize&&this.postApply(c,b[d])}}},undoToRange:function(b){for(var c,d,g,h=b.length;h--;){if(c=b[h].getNodes([a.TEXT_NODE]),c.length)b[h].splitBoundaries(),c=b[h].getNodes([a.TEXT_NODE]);else{var i=b[h].endContainer.ownerDocument,j=i.createTextNode(a.INVISIBLE_SPACE);b[h].insertNode(j),b[h].selectNode(j),c=[j]}for(var k=0,l=c.length;k<l;++k)b[h].isValid()&&(d=c[k],g=this.getMatchingAncestor(d),"style"===g.type?this.undoToTextNode(d,b[h],!1,g.element):g.element&&this.undoToTextNode(d,b[h],g.element));1==l?this.selectNode(b[h],c[0]):(b[h].setStart(c[0],0),d=c[c.length-1],b[h].setEnd(d,d.length),this.normalize&&this.postApply(c,b[h]))}},selectNode:function(b,c){var d=c.nodeType===a.ELEMENT_NODE,e=!("canHaveHTML"in c)||c.canHaveHTML,f=d?c.innerHTML:c.data,g=""===f||f===a.INVISIBLE_SPACE;if(g&&d&&e)try{c.innerHTML=a.INVISIBLE_SPACE}catch(a){}b.selectNodeContents(c),g&&d?b.collapse(!1):g&&(b.setStartAfter(c),b.setEndAfter(c))},getTextSelectedByRange:function(a,b){var c=b.cloneRange();c.selectNodeContents(a);var d=c.intersection(b),e=d?d.toString():"";return c.detach(),e},isAppliedToRange:function(b){for(var e,g,c=[],d="full",h=b.length;h--;){if(g=b[h].getNodes([a.TEXT_NODE]),!g.length)return e=this.getMatchingAncestor(b[h].startContainer).element,!!e&&{elements:[e],coverage:d};for(var k,i=0,j=g.length;i<j;++i)k=this.getTextSelectedByRange(g[i],b[h]),e=this.getMatchingAncestor(g[i]).element,e&&""!=k?(c.push(e),1===a.dom.getTextNodes(e,!0).length?d="full":"full"===d&&(d="inline")):e||(d="partial")}return!!c.length&&{elements:c,coverage:d}},toggleRange:function(a){var c,b=this.isAppliedToRange(a);b?"full"===b.coverage?this.undoToRange(a):"inline"===b.coverage?(c=m(b.elements,this.tagNames,this.cssStyle,this.cssClass),this.undoToRange(a),c||this.applyToRange(a)):(m(b.elements,this.tagNames,this.cssStyle,this.cssClass)||this.undoToRange(a),this.applyToRange(a)):this.applyToRange(a)}},a.selection.HTMLApplier=u}(wysihtml5,rangy),wysihtml5.Commands=Base.extend({constructor:function(a){this.editor=a,this.composer=a.composer,this.doc=this.composer.doc},support:function(a){return wysihtml5.browser.supportsCommand(this.doc,a)},exec:function(a,b){var c=wysihtml5.commands[a],d=wysihtml5.lang.array(arguments).get(),e=c&&c.exec,f=null;if(this.editor.fire("beforecommand:composer"),e)d.unshift(this.composer),f=e.apply(c,d);else try{f=this.doc.execCommand(a,!1,b)}catch(a){}return this.editor.fire("aftercommand:composer"),f},state:function(a,b){var c=wysihtml5.commands[a],d=wysihtml5.lang.array(arguments).get(),e=c&&c.state;if(e)return d.unshift(this.composer),e.apply(c,d);try{return this.doc.queryCommandState(a)}catch(a){return!1}},stateValue:function(a){var b=wysihtml5.commands[a],c=wysihtml5.lang.array(arguments).get(),d=b&&b.stateValue;return!!d&&(c.unshift(this.composer),d.apply(b,c))}}),wysihtml5.commands.bold={exec:function(a,b){wysihtml5.commands.formatInline.execWithToggle(a,b,"b")},state:function(a,b){return wysihtml5.commands.formatInline.state(a,b,"b")}},function(a){function e(e,f){var k,l,m,n,o,p,q,r,s,g=e.doc,h="_wysihtml5-temp-"+ +new Date,i=/non-matching-class/g,j=0;for(a.commands.formatInline.exec(e,b,c,h,i,b,b,!0,!0),l=g.querySelectorAll(c+"."+h),k=l.length;j<k;j++){m=l[j],m.removeAttribute("class");for(s in f)"text"!==s&&m.setAttribute(s,f[s])}p=m,1===k&&(q=d.getTextContent(m),n=!!m.querySelector("*"),o=""===q||q===a.INVISIBLE_SPACE,!n&&o&&(d.setTextContent(m,f.text||m.href),r=g.createTextNode(" "),e.selection.setAfter(m),d.insert(r).after(m),p=r)),e.selection.setAfter(p)}function f(a,b,c){for(var d,e=b.length;e--;){d=b[e].attributes;for(var f=d.length;f--;)b[e].removeAttribute(d.item(f).name);for(var g in c)c.hasOwnProperty(g)&&b[e].setAttribute(g,c[g])}}var b,c="A",d=a.dom;a.commands.createLink={exec:function(a,b,c){var d=this.state(a,b);d?a.selection.executeAndRestore(function(){f(a,d,c)}):(c="object"==typeof c?c:{href:c},e(a,c))},state:function(b,c){return a.commands.formatInline.state(b,c,"A")}}}(wysihtml5),function(a){function c(a,c){for(var f,g,h,d=c.length,e=0;e<d;e++)f=c[e],g=b.getParentElement(f,{nodeName:"code"}),h=b.getTextContent(f),h.match(b.autoLink.URL_REG_EXP)&&!g?g=b.renameElement(f,"code"):b.replaceWithChildNodes(f)}var b=a.dom;a.commands.removeLink={exec:function(a,b){var d=this.state(a,b);d&&a.selection.executeAndRestore(function(){c(a,d)})},state:function(b,c){return a.commands.formatInline.state(b,c,"A")}}}(wysihtml5),function(a){var b=/wysiwyg-font-size-[0-9a-z\-]+/g;a.commands.fontSize={exec:function(c,d,e){a.commands.formatInline.execWithToggle(c,d,"span","wysiwyg-font-size-"+e,b)},state:function(c,d,e){return a.commands.formatInline.state(c,d,"span","wysiwyg-font-size-"+e,b)}}}(wysihtml5),function(a){var b=/(\s|^)font-size\s*:\s*[^;\s]+;?/gi;a.commands.fontSizeStyle={exec:function(c,d,e){e="object"==typeof e?e.size:e,/^\s*$/.test(e)||a.commands.formatInline.execWithToggle(c,d,"span",!1,!1,"font-size:"+e,b)},state:function(c,d,e){return a.commands.formatInline.state(c,d,"span",!1,!1,"font-size",b)},stateValue:function(b,c){var e,d=this.state(b,c);return d&&a.lang.object(d).isArray()&&(d=d[0]),!(!d||!(e=d.getAttribute("style")))&&a.quirks.styleParser.parseFontSize(e)}}}(wysihtml5),function(a){var b=/wysiwyg-color-[0-9a-z]+/g;a.commands.foreColor={exec:function(c,d,e){a.commands.formatInline.execWithToggle(c,d,"span","wysiwyg-color-"+e,b)},state:function(c,d,e){return a.commands.formatInline.state(c,d,"span","wysiwyg-color-"+e,b)}}}(wysihtml5),function(a){var b=/(\s|^)color\s*:\s*[^;\s]+;?/gi;a.commands.foreColorStyle={exec:function(c,d,e){var g,f=a.quirks.styleParser.parseColor("object"==typeof e?"color:"+e.color:"color:"+e,"color");
f&&(g="color: rgb("+f[0]+","+f[1]+","+f[2]+");",1!==f[3]&&(g+="color: rgba("+f[0]+","+f[1]+","+f[2]+","+f[3]+");"),a.commands.formatInline.execWithToggle(c,d,"span",!1,!1,g,b))},state:function(c,d){return a.commands.formatInline.state(c,d,"span",!1,!1,"color",b)},stateValue:function(b,c,d){var f,e=this.state(b,c);return e&&a.lang.object(e).isArray()&&(e=e[0]),!!(e&&(f=e.getAttribute("style"),f&&f))&&(val=a.quirks.styleParser.parseColor(f,"color"),a.quirks.styleParser.unparseColor(val,d))}}}(wysihtml5),function(a){var b=/(\s|^)background-color\s*:\s*[^;\s]+;?/gi;a.commands.bgColorStyle={exec:function(c,d,e){var g,f=a.quirks.styleParser.parseColor("object"==typeof e?"background-color:"+e.color:"background-color:"+e,"background-color");f&&(g="background-color: rgb("+f[0]+","+f[1]+","+f[2]+");",1!==f[3]&&(g+="background-color: rgba("+f[0]+","+f[1]+","+f[2]+","+f[3]+");"),a.commands.formatInline.execWithToggle(c,d,"span",!1,!1,g,b))},state:function(c,d){return a.commands.formatInline.state(c,d,"span",!1,!1,"background-color",b)},stateValue:function(b,c,d){var f,e=this.state(b,c),g=!1;return e&&a.lang.object(e).isArray()&&(e=e[0]),!(!e||!(f=e.getAttribute("style")))&&(g=a.quirks.styleParser.parseColor(f,"background-color"),a.quirks.styleParser.unparseColor(g,d))}}}(wysihtml5),function(a){function d(b,c,d){b.className?(f(b,d),b.className=a.lang.string(b.className+" "+c).trim()):b.className=c}function e(b,c,d){g(b,d),b.getAttribute("style")?b.setAttribute("style",a.lang.string(b.getAttribute("style")+" "+c).trim()):b.setAttribute("style",c)}function f(b,c){var d=c.test(b.className);return b.className=b.className.replace(c,""),""==a.lang.string(b.className).trim()&&b.removeAttribute("class"),d}function g(b,c){var d=c.test(b.getAttribute("style"));return b.setAttribute("style",(b.getAttribute("style")||"").replace(c,"")),""==a.lang.string(b.getAttribute("style")||"").trim()&&b.removeAttribute("style"),d}function h(a){var b=a.lastChild;b&&i(b)&&b.parentNode.removeChild(b)}function i(a){return"BR"===a.nodeName}function k(b,c){b.selection.isCollapsed()&&b.selection.selectLine();for(var d=b.selection.surround(c),e=0,f=d.length;e<f;e++)a.dom.lineBreaks(d[e]).remove(),h(d[e])}function l(b){return!!a.lang.string(b.className).trim()}function m(b){return!!a.lang.string(b.getAttribute("style")||"").trim()}var b=a.dom,c=["H1","H2","H3","H4","H5","H6","P","PRE","DIV"];a.commands.formatBlock={exec:function(h,i,j,n,o,p,q){var v,w,x,y,z,s=(h.doc,this.state(h,i,j,n,o,p,q)),t=h.config.useLineBreaks,u=t?"DIV":"P";return j="string"==typeof j?j.toUpperCase():j,s.length?void h.selection.executeAndRestoreRangy(function(){for(var c=s.length;c--;){if(o&&(w=f(s[c],o)),q&&(y=g(s[c],q)),(y||w)&&null===j&&s[c].nodeName!=u)return;var d=l(s[c]),e=m(s[c]);d||e||!t&&"P"!==j?b.renameElement(s[c],"P"===j?"DIV":u):(a.dom.lineBreaks(s[c]).add(),b.replaceWithChildNodes(s[c]))}}):void((null===j||a.lang.array(c).contains(j))&&(v=h.selection.findNodesInSelection(c).concat(h.selection.getSelectedOwnNodes()),h.selection.executeAndRestoreRangy(function(){for(var a=v.length;a--;)z=b.getParentElement(v[a],{nodeName:c}),z==h.element&&(z=null),z&&(j&&(z=b.renameElement(z,j)),n&&d(z,n,o),p&&e(z,p,q),x=!0)}),x)||k(h,{nodeName:j||u,className:n||null,cssStyle:p||null}))},state:function(c,d,e,f,g,h,i){var l,j=c.selection.getSelectedOwnNodes(),k=[];e="string"==typeof e?e.toUpperCase():e;for(var m=0,n=j.length;m<n;m++)l=b.getParentElement(j[m],{nodeName:e,className:f,classRegExp:g,cssStyle:h,styleRegExp:i}),l&&a.lang.array(k).indexOf(l)==-1&&k.push(l);return 0!=k.length&&k}}}(wysihtml5),wysihtml5.commands.formatCode={exec:function(a,b,c){var e,f,g,d=this.state(a);d?a.selection.executeAndRestore(function(){e=d.querySelector("code"),wysihtml5.dom.replaceWithChildNodes(d),e&&wysihtml5.dom.replaceWithChildNodes(e)}):(f=a.selection.getRange(),g=f.extractContents(),d=a.doc.createElement("pre"),e=a.doc.createElement("code"),c&&(e.className=c),d.appendChild(e),e.appendChild(g),f.insertNode(d),a.selection.selectNode(d))},state:function(a){var b=a.selection.getSelectedNode();return b&&b.nodeName&&"PRE"==b.nodeName&&b.firstChild&&b.firstChild.nodeName&&"CODE"==b.firstChild.nodeName?b:wysihtml5.dom.getParentElement(b,{nodeName:"CODE"})&&wysihtml5.dom.getParentElement(b,{nodeName:"PRE"})}},function(a){function d(a){var c=b[a];return c?[a.toLowerCase(),c.toLowerCase()]:[a.toLowerCase()]}function e(b,e,f,g,h,i){var j=b;return e&&(j+=":"+e),g&&(j+=":"+g),c[j]||(c[j]=new a.selection.HTMLApplier(d(b),e,f,!0,g,h,i)),c[j]}var b={strong:"b",em:"i",b:"strong",i:"em"},c={};a.commands.formatInline={exec:function(a,b,c,d,f,g,h,i,j){var k=a.selection.createRange(),l=a.selection.getOwnRanges();return!(!l||0==l.length)&&(a.selection.getSelection().removeAllRanges(),e(c,d,f,g,h,a.element).toggleRange(l),void(i?j||a.cleanUp():(k.setStart(l[0].startContainer,l[0].startOffset),k.setEnd(l[l.length-1].endContainer,l[l.length-1].endOffset),a.selection.setSelection(k),a.selection.executeAndRestore(function(){j||a.cleanUp()},!0,!0))))},execWithToggle:function(b,c,d,e,f,g,h){var i=this;if(this.state(b,c,d,e,f,g,h)&&b.selection.isCollapsed()&&!b.selection.caretIsLastInSelection()&&!b.selection.caretIsFirstInSelection()){var j=i.state(b,c,d,e,f)[0];b.selection.executeAndRestoreRangy(function(){j.parentNode;b.selection.selectNode(j,!0),a.commands.formatInline.exec(b,c,d,e,f,g,h,!0,!0)})}else this.state(b,c,d,e,f,g,h)&&!b.selection.isCollapsed()?b.selection.executeAndRestoreRangy(function(){a.commands.formatInline.exec(b,c,d,e,f,g,h,!0,!0)}):a.commands.formatInline.exec(b,c,d,e,f,g,h)},state:function(c,d,f,g,h,i,j){var m,n,k=c.doc,l=b[f]||f;return!(!a.dom.hasElementWithTagName(k,f)&&!a.dom.hasElementWithTagName(k,l))&&(!(g&&!a.dom.hasElementWithClassName(k,g))&&(m=c.selection.getOwnRanges(),!(!m||0===m.length)&&(n=e(f,g,h,i,j,c.element).isAppliedToRange(m),!(!n||!n.elements)&&n.elements)))}}}(wysihtml5),function(a){a.commands.insertBlockQuote={exec:function(b,c){var d=this.state(b,c),e=b.selection.isEndToEndInNode(["H1","H2","H3","H4","H5","H6","P"]);b.selection.executeAndRestore(function(){if(d)b.config.useLineBreaks&&a.dom.lineBreaks(d).add(),a.dom.unwrap(d);else if(b.selection.isCollapsed()&&b.selection.selectLine(),e){var c=e.ownerDocument.createElement("blockquote");a.dom.insert(c).after(e),c.appendChild(e)}else b.selection.surround({nodeName:"blockquote"})})},state:function(b,c){var d=b.selection.getSelectedNode(),e=a.dom.getParentElement(d,{nodeName:"BLOCKQUOTE"},!1,b.element);return!!e&&e}}}(wysihtml5),wysihtml5.commands.insertHTML={exec:function(a,b,c){a.commands.support(b)?a.doc.execCommand(b,!1,c):a.selection.insertHTML(c)},state:function(){return!1}},function(a){var b="IMG";a.commands.insertImage={exec:function(c,d,e){e="object"==typeof e?e:{src:e};var h,i,f=c.doc,g=this.state(c);if(g)return c.selection.setBefore(g),i=g.parentNode,i.removeChild(g),a.dom.removeEmptyTextNodes(i),"A"!==i.nodeName||i.firstChild||(c.selection.setAfter(i),i.parentNode.removeChild(i)),void a.quirks.redraw(c.element);g=f.createElement(b);for(var j in e)g.setAttribute("className"===j?"class":j,e[j]);c.selection.insertNode(g),a.browser.hasProblemsSettingCaretAfterImg()?(h=f.createTextNode(a.INVISIBLE_SPACE),c.selection.insertNode(h),c.selection.setAfter(h)):c.selection.setAfter(g)},state:function(c){var e,f,g,d=c.doc;return!!a.dom.hasElementWithTagName(d,b)&&(!!(e=c.selection.getSelectedNode())&&(e.nodeName===b?e:e.nodeType===a.ELEMENT_NODE&&(f=c.selection.getText(),!(f=a.lang.string(f).trim())&&(g=c.selection.getNodes(a.ELEMENT_NODE,function(a){return"IMG"===a.nodeName}),1===g.length&&g[0]))))}}}(wysihtml5),function(a){var b="<br>"+(a.browser.needsSpaceAfterLineBreak()?" ":"");a.commands.insertLineBreak={exec:function(c,d){c.commands.support(d)?(c.doc.execCommand(d,!1,null),a.browser.autoScrollsToCaret()||c.selection.scrollIntoView()):c.commands.exec("insertHTML",b)},state:function(){return!1}}}(wysihtml5),wysihtml5.commands.insertOrderedList={exec:function(a,b){wysihtml5.commands.insertList.exec(a,b,"OL")},state:function(a,b){return wysihtml5.commands.insertList.state(a,b,"OL")}},wysihtml5.commands.insertUnorderedList={exec:function(a,b){wysihtml5.commands.insertList.exec(a,b,"UL")},state:function(a,b){return wysihtml5.commands.insertList.state(a,b,"UL")}},wysihtml5.commands.insertList=function(a){var b=function(a,b){if(a&&a.nodeName){"string"==typeof b&&(b=[b]);for(var c=b.length;c--;)if(a.nodeName===b[c])return!0}return!1},c=function(c,d,e){var f={el:null,other:!1};if(c){var g=a.dom.getParentElement(c,{nodeName:"LI"}),h="UL"===d?"OL":"UL";b(c,d)?f.el=c:b(c,h)?f={el:c,other:!0}:g&&(b(g.parentNode,d)?f.el=g.parentNode:b(g.parentNode,h)&&(f={el:g.parentNode,other:!0}))}return f.el&&!e.element.contains(f.el)&&(f.el=null),f},d=function(b,c,d){var h,e="UL"===c?"OL":"UL";d.selection.executeAndRestore(function(){var g=f(e,d);if(g.length)for(var i=g.length;i--;)a.dom.renameElement(g[i],c.toLowerCase());else{h=f(["OL","UL"],d);for(var j=h.length;j--;)a.dom.resolveList(h[j],d.config.useLineBreaks);a.dom.resolveList(b,d.config.useLineBreaks)}})},e=function(b,c,d){var e="UL"===c?"OL":"UL";d.selection.executeAndRestore(function(){for(var g=[b].concat(f(e,d)),h=g.length;h--;)a.dom.renameElement(g[h],c.toLowerCase())})},f=function(a,c){for(var d=c.selection.getOwnRanges(),e=[],f=d.length;f--;)e=e.concat(d[f].getNodes([1],function(c){return b(c,a)}));return e},g=function(b,c){c.selection.executeAndRestoreRangy(function(){var f,g,d="_wysihtml5-temp-"+(new Date).getTime(),e=c.selection.deblockAndSurround({nodeName:"div",className:d}),h=/\uFEFF/g;e.innerHTML=e.innerHTML.replace(h,""),e&&(f=a.lang.array(["","<br>",a.INVISIBLE_SPACE]).contains(e.innerHTML),g=a.dom.convertToList(e,b.toLowerCase(),c.parent.config.uneditableContainerClassname),f&&c.selection.selectNode(g.querySelector("li"),!0))})};return{exec:function(a,b,f){var h=a.doc,i="OL"===f?"insertOrderedList":"insertUnorderedList",j=a.selection.getSelectedNode(),k=c(j,f,a);k.el?k.other?e(k.el,f,a):d(k.el,f,a):a.commands.support(i)?h.execCommand(i,!1,null):g(f,a)},state:function(a,b,d){var e=a.selection.getSelectedNode(),f=c(e,d,a);return!(!f.el||f.other)&&f.el}}}(wysihtml5),wysihtml5.commands.italic={exec:function(a,b){wysihtml5.commands.formatInline.execWithToggle(a,b,"i")},state:function(a,b){return wysihtml5.commands.formatInline.state(a,b,"i")}},function(a){var b="wysiwyg-text-align-center",c=/wysiwyg-text-align-[0-9a-z]+/g;a.commands.justifyCenter={exec:function(d,e){return a.commands.formatBlock.exec(d,"formatBlock",null,b,c)},state:function(d,e){return a.commands.formatBlock.state(d,"formatBlock",null,b,c)}}}(wysihtml5),function(a){var b="wysiwyg-text-align-left",c=/wysiwyg-text-align-[0-9a-z]+/g;a.commands.justifyLeft={exec:function(d,e){return a.commands.formatBlock.exec(d,"formatBlock",null,b,c)},state:function(d,e){return a.commands.formatBlock.state(d,"formatBlock",null,b,c)}}}(wysihtml5),function(a){var b="wysiwyg-text-align-right",c=/wysiwyg-text-align-[0-9a-z]+/g;a.commands.justifyRight={exec:function(d,e){return a.commands.formatBlock.exec(d,"formatBlock",null,b,c)},state:function(d,e){return a.commands.formatBlock.state(d,"formatBlock",null,b,c)}}}(wysihtml5),function(a){var b="wysiwyg-text-align-justify",c=/wysiwyg-text-align-[0-9a-z]+/g;a.commands.justifyFull={exec:function(d,e){return a.commands.formatBlock.exec(d,"formatBlock",null,b,c)},state:function(d,e){return a.commands.formatBlock.state(d,"formatBlock",null,b,c)}}}(wysihtml5),function(a){var b="text-align: right;",c=/(\s|^)text-align\s*:\s*[^;\s]+;?/gi;a.commands.alignRightStyle={exec:function(d,e){return a.commands.formatBlock.exec(d,"formatBlock",null,null,null,b,c)},state:function(d,e){return a.commands.formatBlock.state(d,"formatBlock",null,null,null,b,c)}}}(wysihtml5),function(a){var b="text-align: left;",c=/(\s|^)text-align\s*:\s*[^;\s]+;?/gi;a.commands.alignLeftStyle={exec:function(d,e){return a.commands.formatBlock.exec(d,"formatBlock",null,null,null,b,c)},state:function(d,e){return a.commands.formatBlock.state(d,"formatBlock",null,null,null,b,c)}}}(wysihtml5),function(a){var b="text-align: center;",c=/(\s|^)text-align\s*:\s*[^;\s]+;?/gi;a.commands.alignCenterStyle={exec:function(d,e){return a.commands.formatBlock.exec(d,"formatBlock",null,null,null,b,c)},state:function(d,e){return a.commands.formatBlock.state(d,"formatBlock",null,null,null,b,c)}}}(wysihtml5),wysihtml5.commands.redo={exec:function(a){return a.undoManager.redo()},state:function(a){return!1}},wysihtml5.commands.underline={exec:function(a,b){wysihtml5.commands.formatInline.execWithToggle(a,b,"u")},state:function(a,b){return wysihtml5.commands.formatInline.state(a,b,"u")}},wysihtml5.commands.undo={exec:function(a){return a.undoManager.undo()},state:function(a){return!1}},wysihtml5.commands.createTable={exec:function(a,b,c){var d,e,f;if(c&&c.cols&&c.rows&&parseInt(c.cols,10)>0&&parseInt(c.rows,10)>0){for(f=c.tableStyle?'<table style="'+c.tableStyle+'">':"<table>",f+="<tbody>",e=0;e<c.rows;e++){for(f+="<tr>",d=0;d<c.cols;d++)f+="<td>&nbsp;</td>";f+="</tr>"}f+="</tbody></table>",a.commands.exec("insertHTML",f)}},state:function(a,b){return!1}},wysihtml5.commands.mergeTableCells={exec:function(a,b){a.tableSelection&&a.tableSelection.start&&a.tableSelection.end&&(this.state(a,b)?wysihtml5.dom.table.unmergeCell(a.tableSelection.start):wysihtml5.dom.table.mergeCellsBetween(a.tableSelection.start,a.tableSelection.end))},state:function(a,b){if(a.tableSelection){var c=a.tableSelection.start,d=a.tableSelection.end;if(c&&d&&c==d&&(wysihtml5.dom.getAttribute(c,"colspan")&&parseInt(wysihtml5.dom.getAttribute(c,"colspan"),10)>1||wysihtml5.dom.getAttribute(c,"rowspan")&&parseInt(wysihtml5.dom.getAttribute(c,"rowspan"),10)>1))return[c]}return!1}},wysihtml5.commands.addTableCells={exec:function(a,b,c){if(a.tableSelection&&a.tableSelection.start&&a.tableSelection.end){var d=wysihtml5.dom.table.orderSelectionEnds(a.tableSelection.start,a.tableSelection.end);"before"==c||"above"==c?wysihtml5.dom.table.addCells(d.start,c):"after"!=c&&"below"!=c||wysihtml5.dom.table.addCells(d.end,c),setTimeout(function(){a.tableSelection.select(d.start,d.end)},0)}},state:function(a,b){return!1}},wysihtml5.commands.deleteTableCells={exec:function(a,b,c){if(a.tableSelection&&a.tableSelection.start&&a.tableSelection.end){var f,d=wysihtml5.dom.table.orderSelectionEnds(a.tableSelection.start,a.tableSelection.end),e=wysihtml5.dom.table.indexOf(d.start),g=a.tableSelection.table;wysihtml5.dom.table.removeCells(d.start,c),setTimeout(function(){f=wysihtml5.dom.table.findCell(g,e),f||("row"==c&&(f=wysihtml5.dom.table.findCell(g,{row:e.row-1,col:e.col})),"column"==c&&(f=wysihtml5.dom.table.findCell(g,{row:e.row,col:e.col-1}))),f&&a.tableSelection.select(f,f)},0)}},state:function(a,b){return!1}},wysihtml5.commands.indentList={exec:function(a,b,c){var d=a.selection.getSelectionParentsByTag("LI");return!!d&&this.tryToPushLiLevel(d,a.selection)},state:function(a,b){return!1},tryToPushLiLevel:function(a,b){var c,d,e,f,g,h=!1;return b.executeAndRestoreRangy(function(){for(var b=a.length;b--;)f=a[b],c="OL"===f.parentNode.nodeName?"OL":"UL",d=f.ownerDocument.createElement(c),e=wysihtml5.dom.domNode(f).prev({nodeTypes:[wysihtml5.ELEMENT_NODE]}),g=e?e.querySelector("ul, ol"):null,e&&(g?g.appendChild(f):(d.appendChild(f),e.appendChild(d)),h=!0)}),h}},wysihtml5.commands.outdentList={exec:function(a,b,c){var d=a.selection.getSelectionParentsByTag("LI");return!!d&&this.tryToPullLiLevel(d,a)},state:function(a,b){return!1},tryToPullLiLevel:function(a,b){var c,d,e,h,i,j=!1,k=this;return b.selection.executeAndRestoreRangy(function(){for(var f=a.length;f--;)if(h=a[f],h.parentNode&&(c=h.parentNode,"OL"===c.tagName||"UL"===c.tagName)){if(j=!0,d=wysihtml5.dom.getParentElement(c.parentNode,{nodeName:["OL","UL"]},!1,b.element),e=wysihtml5.dom.getParentElement(c.parentNode,{nodeName:["LI"]},!1,b.element),d&&e)h.nextSibling&&(i=k.getAfterList(c,h),h.appendChild(i)),d.insertBefore(h,e.nextSibling);else{h.nextSibling&&(i=k.getAfterList(c,h),h.appendChild(i));for(var g=h.childNodes.length;g--;)c.parentNode.insertBefore(h.childNodes[g],c.nextSibling);c.parentNode.insertBefore(document.createElement("br"),c.nextSibling),h.parentNode.removeChild(h)}0===c.childNodes.length&&c.parentNode.removeChild(c)}}),j},getAfterList:function(a,b){for(var c=a.nodeName,d=document.createElement(c);b.nextSibling;)d.appendChild(b.nextSibling);return d}},function(a){var b=90,c=89,d=8,e=46,f=25,g="data-wysihtml5-selection-node",h="data-wysihtml5-selection-offset",k=('<span id="_wysihtml5-undo" class="_wysihtml5-temp">'+a.INVISIBLE_SPACE+"</span>",'<span id="_wysihtml5-redo" class="_wysihtml5-temp">'+a.INVISIBLE_SPACE+"</span>",a.dom);a.UndoManager=a.lang.Dispatcher.extend({constructor:function(a){this.editor=a,this.composer=a.composer,this.element=this.composer.element,this.position=0,this.historyStr=[],this.historyDom=[],this.transact(),this._observe()},_observe:function(){var g,a=this;this.composer.sandbox.getDocument();k.observe(this.element,"keydown",function(d){if(!d.altKey&&(d.ctrlKey||d.metaKey)){var e=d.keyCode,f=e===b&&!d.shiftKey,g=e===b&&d.shiftKey||e===c;f?(a.undo(),d.preventDefault()):g&&(a.redo(),d.preventDefault())}}),k.observe(this.element,"keydown",function(b){var c=b.keyCode;c!==g&&(g=c,c!==d&&c!==e||a.transact())}),this.editor.on("newword:composer",function(){a.transact()}).on("beforecommand:composer",function(){a.transact()})},transact:function(){var e,i,j,k,l,b=this.historyStr[this.position-1],c=this.composer.getValue(!1,!1),d=this.element.offsetWidth>0&&this.element.offsetHeight>0;if(c!==b){var m=this.historyStr.length=this.historyDom.length=this.position;m>f&&(this.historyStr.shift(),this.historyDom.shift(),this.position--),this.position++,d&&(e=this.composer.selection.getRange(),i=e&&e.startContainer?e.startContainer:this.element,j=e&&e.startOffset?e.startOffset:0,i.nodeType===a.ELEMENT_NODE?k=i:(k=i.parentNode,l=this.getChildNodeIndex(k,i)),k.setAttribute(h,j),"undefined"!=typeof l&&k.setAttribute(g,l));var n=this.element.cloneNode(!!c);this.historyDom.push(n),this.historyStr.push(c),k&&(k.removeAttribute(h),k.removeAttribute(g))}},undo:function(){this.transact(),this.undoPossible()&&(this.set(this.historyDom[--this.position-1]),this.editor.fire("undo:composer"))},redo:function(){this.redoPossible()&&(this.set(this.historyDom[++this.position-1]),this.editor.fire("redo:composer"))},undoPossible:function(){return this.position>1},redoPossible:function(){return this.position<this.historyStr.length},set:function(a){this.element.innerHTML="";for(var b=0,c=a.childNodes,d=a.childNodes.length;b<d;b++)this.element.appendChild(c[b].cloneNode(!0));var e,f,i;a.hasAttribute(h)?(e=a.getAttribute(h),i=a.getAttribute(g),f=this.element):(f=this.element.querySelector("["+h+"]")||this.element,e=f.getAttribute(h),i=f.getAttribute(g),f.removeAttribute(h),f.removeAttribute(g)),null!==i&&(f=this.getChildNodeByIndex(f,+i)),this.composer.selection.set(f,e)},getChildNodeIndex:function(a,b){for(var c=0,d=a.childNodes,e=d.length;c<e;c++)if(d[c]===b)return c},getChildNodeByIndex:function(a,b){return a.childNodes[b]}})}(wysihtml5),wysihtml5.views.View=Base.extend({constructor:function(a,b,c){this.parent=a,this.element=b,this.config=c,this.config.noTextarea||this._observeViewChange()},_observeViewChange:function(){var a=this;this.parent.on("beforeload",function(){a.parent.on("change_view",function(b){b===a.name?(a.parent.currentView=a,a.show(),setTimeout(function(){a.focus()},0)):a.hide()})})},focus:function(){if(this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element.focus()}catch(a){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}}),function(a){var b=a.dom,c=a.browser;a.views.Composer=a.views.View.extend({name:"composer",CARET_HACK:"<br>",constructor:function(a,b,c){this.base(a,b,c),this.config.noTextarea?this.editableArea=b:this.textarea=this.parent.textarea,this.config.contentEditableMode?this._initContentEditableArea():this._initSandbox()},clear:function(){this.element.innerHTML=c.displaysCaretInEmptyContentEditableCorrectly()?"":this.CARET_HACK},getValue:function(b,c){var d=this.isEmpty()?"":a.quirks.getCorrectInnerHTML(this.element);return b!==!1&&(d=this.parent.parse(d,c!==!1)),d},setValue:function(a,b){b&&(a=this.parent.parse(a));try{this.element.innerHTML=a}catch(b){this.element.innerText=a}},cleanUp:function(){this.parent.parse(this.element)},show:function(){this.editableArea.style.display=this._displayStyle||"",this.config.noTextarea||this.textarea.element.disabled||(this.disable(),this.enable())},hide:function(){this._displayStyle=b.getStyle("display").from(this.editableArea),"none"===this._displayStyle&&(this._displayStyle=null),this.editableArea.style.display="none"},disable:function(){this.parent.fire("disable:composer"),this.element.removeAttribute("contentEditable")},enable:function(){this.parent.fire("enable:composer"),this.element.setAttribute("contentEditable","true")},focus:function(b){a.browser.doesAsyncFocus()&&this.hasPlaceholderSet()&&this.clear(),this.base();var c=this.element.lastChild;b&&c&&this.selection&&("BR"===c.nodeName?this.selection.setBefore(this.element.lastChild):this.selection.setAfter(this.element.lastChild))},getTextContent:function(){return b.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==(this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder"))&&this.placeholderSet},isEmpty:function(){var a=this.element.innerHTML.toLowerCase();return/^(\s|<br>|<\/br>|<p>|<\/p>)*$/i.test(a)||""===a||"<br>"===a||"<p></p>"===a||"<p><br></p>"===a||this.hasPlaceholderSet()},_initContentEditableArea:function(){var a=this;this.config.noTextarea?this.sandbox=new b.ContentEditableArea(function(){a._create()},{},this.editableArea):(this.sandbox=new b.ContentEditableArea(function(){a._create()}),this.editableArea=this.sandbox.getContentEditable(),b.insert(this.editableArea).after(this.textarea.element),this._createWysiwygFormField())},_initSandbox:function(){var a=this;this.sandbox=new b.Sandbox(function(){a._create()},{stylesheets:this.config.stylesheets}),this.editableArea=this.sandbox.getIframe();var c=this.textarea.element;b.insert(this.editableArea).after(c),this._createWysiwygFormField()},_createWysiwygFormField:function(){if(this.textarea.element.form){var a=document.createElement("input");a.type="hidden",a.name="_wysihtml5_mode",a.value=1,b.insert(a).after(this.textarea.element)}},_create:function(){var d=this;this.doc=this.sandbox.getDocument(),this.element=this.config.contentEditableMode?this.sandbox.getContentEditable():this.doc.body,this.config.noTextarea?this.cleanUp():(this.textarea=this.parent.textarea,this.element.innerHTML=this.textarea.getValue(!0,!1)),this.selection=new a.Selection(this.parent,this.element,this.config.uneditableContainerClassname),this.commands=new a.Commands(this.parent),this.config.noTextarea||b.copyAttributes(["className","spellcheck","title","lang","dir","accessKey"]).from(this.textarea.element).to(this.element),b.addClass(this.element,this.config.composerClassName),this.config.style&&!this.config.contentEditableMode&&this.style(),this.observe();var e=this.config.name;e&&(b.addClass(this.element,e),this.config.contentEditableMode||b.addClass(this.editableArea,e)),this.enable(),!this.config.noTextarea&&this.textarea.element.disabled&&this.disable();var f="string"==typeof this.config.placeholder?this.config.placeholder:this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder");f&&b.simulatePlaceholder(this.parent,this,f),this.commands.exec("styleWithCSS",!1),this._initAutoLinking(),this._initObjectResizing(),this._initUndoManager(),this._initLineBreaking(),this.config.noTextarea||!this.textarea.element.hasAttribute("autofocus")&&document.querySelector(":focus")!=this.textarea.element||c.isIos()||setTimeout(function(){d.focus(!0)},100),c.clearsContentEditableCorrectly()||a.quirks.ensureProperClearing(this),this.initSync&&this.config.sync&&this.initSync(),this.config.noTextarea||this.textarea.hide(),this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var d=this,e=c.canDisableAutoLinking(),f=c.doesAutoLinkingInContentEditable();if(e&&this.commands.exec("autoUrlDetect",!1),this.config.autoLink){(!f||f&&e)&&(this.parent.on("newword:composer",function(){b.getTextContent(d.element).match(b.autoLink.URL_REG_EXP)&&d.selection.executeAndRestore(function(c,e){for(var f=d.element.querySelectorAll("."+d.config.uneditableContainerClassname),g=!1,h=f.length;h--;)a.dom.contains(f[h],e)&&(g=!0);g||b.autoLink(e.parentNode,[d.config.uneditableContainerClassname])})}),b.observe(this.element,"blur",function(){b.autoLink(d.element,[d.config.uneditableContainerClassname])}));var g=this.sandbox.getDocument().getElementsByTagName("a"),h=b.autoLink.URL_REG_EXP,i=function(c){var d=a.lang.string(b.getTextContent(c)).trim();return"www."===d.substr(0,4)&&(d="http://"+d),d};b.observe(this.element,"keydown",function(a){if(g.length){var f,c=d.selection.getSelectedNode(a.target.ownerDocument),e=b.getParentElement(c,{nodeName:"A"},4);e&&(f=i(e),setTimeout(function(){var a=i(e);a!==f&&a.match(h)&&e.setAttribute("href",a)},0))}})}},_initObjectResizing:function(){if(this.commands.exec("enableObjectResizing",!0),c.supportsEvent("resizeend")){var d=["width","height"],e=d.length,f=this.element;b.observe(f,"resizeend",function(b){var i,c=b.target||b.srcElement,g=c.style,h=0;if("IMG"===c.nodeName){for(;h<e;h++)i=d[h],g[i]&&(c.setAttribute(i,parseInt(g[i],10)),g[i]="");a.quirks.redraw(f)}})}},_initUndoManager:function(){this.undoManager=new a.UndoManager(this.parent)},_initLineBreaking:function(){function g(a){var c=b.getParentElement(a,{nodeName:["P","DIV"]},2);c&&b.contains(d.element,c)&&d.selection.executeAndRestore(function(){d.config.useLineBreaks?b.replaceWithChildNodes(c):"P"!==c.nodeName&&b.renameElement(c,"p")})}var d=this,e=["LI","P","H1","H2","H3","H4","H5","H6"],f=["UL","OL","MENU"];this.config.useLineBreaks||b.observe(this.element,["focus","keydown"],function(){if(d.isEmpty()){var a=d.doc.createElement("P");d.element.innerHTML="",d.element.appendChild(a),c.displaysCaretInEmptyContentEditableCorrectly()?d.selection.selectNode(a,!0):(a.innerHTML="<br>",d.selection.setBefore(a.firstChild))}}),b.observe(this.element,"keydown",function(c){var h=c.keyCode;if(!c.shiftKey&&(h===a.ENTER_KEY||h===a.BACKSPACE_KEY)){var i=b.getParentElement(d.selection.getSelectedNode(),{nodeName:e},4);return i?void setTimeout(function(){var e,c=d.selection.getSelectedNode();if("LI"===i.nodeName){if(!c)return;e=b.getParentElement(c,{nodeName:f},2),e||g(c)}h===a.ENTER_KEY&&i.nodeName.match(/^H[1-6]$/)&&g(c)},0):void(d.config.useLineBreaks&&h===a.ENTER_KEY&&!a.browser.insertsLineBreaksOnReturn()&&(c.preventDefault(),d.commands.exec("insertLineBreak")))}})}})}(wysihtml5),function(a){var b=a.dom,c=document,d=window,e=c.createElement("div"),f=["background-color","color","cursor","font-family","font-size","font-style","font-variant","font-weight","line-height","letter-spacing","text-align","text-decoration","text-indent","text-rendering","word-break","word-wrap","word-spacing"],g=["background-color","border-collapse","border-bottom-color","border-bottom-style","border-bottom-width","border-left-color","border-left-style","border-left-width","border-right-color","border-right-style","border-right-width","border-top-color","border-top-style","border-top-width","clear","display","float","margin-bottom","margin-left","margin-right","margin-top","outline-color","outline-offset","outline-width","outline-style","padding-left","padding-right","padding-top","padding-bottom","position","top","left","right","bottom","z-index","vertical-align","text-align","-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing","-webkit-box-shadow","-moz-box-shadow","-ms-box-shadow","box-shadow","-webkit-border-top-right-radius","-moz-border-radius-topright","border-top-right-radius","-webkit-border-bottom-right-radius","-moz-border-radius-bottomright","border-bottom-right-radius","-webkit-border-bottom-left-radius","-moz-border-radius-bottomleft","border-bottom-left-radius","-webkit-border-top-left-radius","-moz-border-radius-topleft","border-top-left-radius","width","height"],h=["html                 { height: 100%; }","body                 { height: 100%; padding: 1px 0 0 0; margin: -1px 0 0 0; }","body > p:first-child { margin-top: 0; }","._wysihtml5-temp     { display: none; }",a.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","img:-moz-broken      { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"],i=function(a){if(a.setActive)try{a.setActive()}catch(a){}else{var e=a.style,f=c.documentElement.scrollTop||c.body.scrollTop,g=c.documentElement.scrollLeft||c.body.scrollLeft,h={position:e.position,top:e.top,left:e.left,WebkitUserSelect:e.WebkitUserSelect};b.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(a),a.focus(),b.setStyles(h).on(a),d.scrollTo&&d.scrollTo(g,f)}};a.views.Composer.prototype.style=function(){var p,d=this,j=c.querySelector(":focus"),k=this.textarea.element,l=k.hasAttribute("placeholder"),m=l&&k.getAttribute("placeholder"),n=k.style.display,o=k.disabled;this.focusStylesHost=e.cloneNode(!1),this.blurStylesHost=e.cloneNode(!1),this.disabledStylesHost=e.cloneNode(!1),l&&k.removeAttribute("placeholder"),k===j&&k.blur(),k.disabled=!1,k.style.display=p="none",(k.getAttribute("rows")&&"auto"===b.getStyle("height").from(k)||k.getAttribute("cols")&&"auto"===b.getStyle("width").from(k))&&(k.style.display=p=n),b.copyStyles(g).from(k).to(this.editableArea).andTo(this.blurStylesHost),b.copyStyles(f).from(k).to(this.element).andTo(this.blurStylesHost),b.insertCSS(h).into(this.element.ownerDocument),k.disabled=!0,b.copyStyles(g).from(k).to(this.disabledStylesHost),b.copyStyles(f).from(k).to(this.disabledStylesHost),k.disabled=o,k.style.display=n,i(k),k.style.display=p,b.copyStyles(g).from(k).to(this.focusStylesHost),b.copyStyles(f).from(k).to(this.focusStylesHost),k.style.display=n,b.copyStyles(["display"]).from(k).to(this.editableArea);var q=a.lang.array(g).without(["display"]);return j?j.focus():k.blur(),l&&k.setAttribute("placeholder",m),this.parent.on("focus:composer",function(){b.copyStyles(q).from(d.focusStylesHost).to(d.editableArea),b.copyStyles(f).from(d.focusStylesHost).to(d.element)}),this.parent.on("blur:composer",function(){b.copyStyles(q).from(d.blurStylesHost).to(d.editableArea),b.copyStyles(f).from(d.blurStylesHost).to(d.element)}),this.parent.observe("disable:composer",function(){b.copyStyles(q).from(d.disabledStylesHost).to(d.editableArea),b.copyStyles(f).from(d.disabledStylesHost).to(d.element)}),this.parent.observe("enable:composer",function(){b.copyStyles(q).from(d.blurStylesHost).to(d.editableArea),b.copyStyles(f).from(d.blurStylesHost).to(d.element)}),this}}(wysihtml5),function(a){var b=a.dom,c=a.browser,d={66:"bold",73:"italic",85:"underline"},e=function(a,b,c){var d=a.getPreviousNode(b,!0),e=a.getSelectedNode();if(1!==e.nodeType&&e.parentNode!==c&&(e=e.parentNode),d)if(1==e.nodeType){var f=e.firstChild;if(1==d.nodeType)for(;e.firstChild;)d.appendChild(e.firstChild);else for(;e.firstChild;)b.parentNode.insertBefore(e.firstChild,b);e.parentNode&&e.parentNode.removeChild(e),a.setBefore(f)}else 1==d.nodeType?d.appendChild(e):b.parentNode.insertBefore(e,b),a.setBefore(e)},f=function(a,b,c,d){if(b.isCollapsed())if(b.caretIsInTheBeginnig("LI"))a.preventDefault(),d.commands.exec("outdentList");else if(b.caretIsInTheBeginnig())a.preventDefault();else{if(b.caretIsFirstInSelection()&&b.getPreviousNode()&&b.getPreviousNode().nodeName&&/^H\d$/gi.test(b.getPreviousNode().nodeName)){
var f=b.getPreviousNode();if(a.preventDefault(),/^\s*$/.test(f.textContent||f.innerText))f.parentNode.removeChild(f);else{var g=f.ownerDocument.createRange();g.selectNodeContents(f),g.collapse(!1),b.setSelection(g)}}var h=b.caretIsBeforeUneditable();h&&(a.preventDefault(),e(b,h,c))}else b.containsUneditable()&&(a.preventDefault(),b.deleteContents())},g=function(a,b){if(a.selection.isCollapsed()){if(a.selection.caretIsInTheBeginnig("LI")&&a.commands.exec("indentList"))return}else a.selection.deleteContents();a.commands.exec("insertHTML","&emsp;")};a.views.Composer.prototype.observe=function(){var e=this,h=this.getValue(!1,!1),i=this.sandbox.getIframe?this.sandbox.getIframe():this.sandbox.getContentEditable(),j=this.element,k=c.supportsEventsInIframeCorrectly()||this.sandbox.getContentEditable?j:this.sandbox.getWindow(),l=["drop","paste","beforepaste"],m=["drop","paste","mouseup","focus","keyup"];if(b.observe(i,"DOMNodeRemoved",function(){clearInterval(n),e.parent.fire("destroy:composer")}),!c.supportsMutationEvents())var n=setInterval(function(){b.contains(document.documentElement,i)||(clearInterval(n),e.parent.fire("destroy:composer"))},250);b.observe(k,m,function(){setTimeout(function(){e.parent.fire("interaction").fire("interaction:composer")},0)}),this.config.handleTables&&(!this.tableClickHandle&&this.doc.execCommand&&a.browser.supportsCommand(this.doc,"enableObjectResizing")&&a.browser.supportsCommand(this.doc,"enableInlineTableEditing")&&(this.sandbox.getIframe?this.tableClickHandle=b.observe(i,["focus","mouseup","mouseover"],function(){e.doc.execCommand("enableObjectResizing",!1,"false"),e.doc.execCommand("enableInlineTableEditing",!1,"false"),e.tableClickHandle.stop()}):setTimeout(function(){e.doc.execCommand("enableObjectResizing",!1,"false"),e.doc.execCommand("enableInlineTableEditing",!1,"false")},0)),this.tableSelection=a.quirks.tableCellsSelection(j,e.parent)),b.observe(k,"focus",function(a){e.parent.fire("focus",a).fire("focus:composer",a),setTimeout(function(){h=e.getValue(!1,!1)},0)}),b.observe(k,"blur",function(a){if(h!==e.getValue(!1,!1)){var b=a;"function"==typeof Object.create&&(b=Object.create(a,{type:{value:"change"}})),e.parent.fire("change",b).fire("change:composer",b)}e.parent.fire("blur",a).fire("blur:composer",a)}),b.observe(j,"dragenter",function(){e.parent.fire("unset_placeholder")}),b.observe(j,l,function(a){e.parent.fire(a.type,a).fire(a.type+":composer",a)}),this.config.copyedFromMarking&&b.observe(j,"copy",function(a){a.clipboardData&&(a.clipboardData.setData("text/html",e.config.copyedFromMarking+e.selection.getHtml()),a.preventDefault()),e.parent.fire(a.type,a).fire(a.type+":composer",a)}),b.observe(j,"keyup",function(b){var c=b.keyCode;c!==a.SPACE_KEY&&c!==a.ENTER_KEY||e.parent.fire("newword:composer")}),this.parent.on("paste:composer",function(){setTimeout(function(){e.parent.fire("newword:composer")},0)}),c.canSelectImagesInContentEditable()||b.observe(j,"mousedown",function(b){var c=b.target,d=j.querySelectorAll("img"),f=j.querySelectorAll("."+e.config.uneditableContainerClassname+" img"),g=a.lang.array(d).without(f);"IMG"===c.nodeName&&a.lang.array(g).contains(c)&&e.selection.selectNode(c)}),c.canSelectImagesInContentEditable()||b.observe(j,"drop",function(a){setTimeout(function(){e.selection.getSelection().removeAllRanges()},0)}),c.hasHistoryIssue()&&c.supportsSelectionModify()&&b.observe(j,"keydown",function(a){if(a.metaKey||a.ctrlKey){var b=a.keyCode,c=j.ownerDocument.defaultView,d=c.getSelection();37!==b&&39!==b||(37===b&&(d.modify("extend","left","lineboundary"),a.shiftKey||d.collapseToStart()),39===b&&(d.modify("extend","right","lineboundary"),a.shiftKey||d.collapseToEnd()),a.preventDefault())}}),b.observe(j,"keydown",function(a){var b=a.keyCode,c=d[b];(a.ctrlKey||a.metaKey)&&!a.altKey&&c&&(e.commands.exec(c),a.preventDefault()),8===b?f(a,e.selection,j,e):e.config.handleTabKey&&9===b&&(a.preventDefault(),g(e,j))}),b.observe(j,"keydown",function(b){var f,c=e.selection.getSelectedNode(!0),d=b.keyCode;!c||"IMG"!==c.nodeName||d!==a.BACKSPACE_KEY&&d!==a.DELETE_KEY||(f=c.parentNode,f.removeChild(c),"A"!==f.nodeName||f.firstChild||f.parentNode.removeChild(f),setTimeout(function(){a.quirks.redraw(j)},0),b.preventDefault())}),!this.config.contentEditableMode&&c.hasIframeFocusIssue()&&(b.observe(i,"focus",function(){setTimeout(function(){e.doc.querySelector(":focus")!==e.element&&e.focus()},0)}),b.observe(this.element,"blur",function(){setTimeout(function(){e.selection.getSelection().removeAllRanges()},0)}));var o={IMG:"Image: ",A:"Link: "};b.observe(j,"mouseover",function(a){var d,b=a.target,c=b.nodeName;if("A"===c||"IMG"===c){var e=b.hasAttribute("title");e||(d=o[c]+(b.getAttribute("href")||b.getAttribute("src")),b.setAttribute("title",d))}})}}(wysihtml5),function(a){var b=400;a.views.Synchronizer=Base.extend({constructor:function(a,b,c){this.editor=a,this.textarea=b,this.composer=c,this._observe()},fromComposerToTextarea:function(b){this.textarea.setValue(a.lang.string(this.composer.getValue(!1,!1)).trim(),b)},fromTextareaToComposer:function(a){var b=this.textarea.getValue(!1,!1);b?this.composer.setValue(b,a):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function(a){"textarea"===this.editor.currentView.name?this.fromTextareaToComposer(a):this.fromComposerToTextarea(a)},_observe:function(){var c,d=this,e=this.textarea.element.form,f=function(){c=setInterval(function(){d.fromComposerToTextarea()},b)},g=function(){clearInterval(c),c=null};f(),e&&(a.dom.observe(e,"submit",function(){d.sync(!0)}),a.dom.observe(e,"reset",function(){setTimeout(function(){d.fromTextareaToComposer()},0)})),this.editor.on("change_view",function(a){"composer"!==a||c?"textarea"===a&&(d.fromComposerToTextarea(!0),g()):(d.fromTextareaToComposer(!0),f())}),this.editor.on("destroy:composer",g)}})}(wysihtml5),wysihtml5.views.Textarea=wysihtml5.views.View.extend({name:"textarea",constructor:function(a,b,c){this.base(a,b,c),this._observe()},clear:function(){this.element.value=""},getValue:function(a){var b=this.isEmpty()?"":this.element.value;return a!==!1&&(b=this.parent.parse(b)),b},setValue:function(a,b){b&&(a=this.parent.parse(a)),this.element.value=a},cleanUp:function(){var a=this.parent.parse(this.element.value);this.element.value=a},hasPlaceholderSet:function(){var a=wysihtml5.browser.supportsPlaceholderAttributeOn(this.element),b=this.element.getAttribute("placeholder")||null,c=this.element.value,d=!c;return a&&d||c===b},isEmpty:function(){return!wysihtml5.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var a=this.element,b=this.parent,c={focusin:"focus",focusout:"blur"},d=wysihtml5.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];b.on("beforeload",function(){wysihtml5.dom.observe(a,d,function(a){var d=c[a.type]||a.type;b.fire(d).fire(d+":textarea")}),wysihtml5.dom.observe(a,["paste","drop"],function(){setTimeout(function(){b.fire("paste").fire("paste:textarea")},0)})})}}),function(a){var b,c={name:b,style:!0,toolbar:b,showToolbarAfterInit:!0,autoLink:!0,handleTables:!0,handleTabKey:!0,parserRules:{tags:{br:{},span:{},div:{},p:{}},classes:{}},pasteParserRulesets:null,parser:a.dom.parse,composerClassName:"wysihtml5-editor",bodyClassName:"wysihtml5-supported",useLineBreaks:!0,stylesheets:[],placeholderText:b,supportTouchDevices:!0,cleanUp:!0,contentEditableMode:!1,uneditableContainerClassname:"wysihtml5-uneditable-container",copyedFromMarking:'<meta name="copied-from" content="wysihtml5">'};a.Editor=a.lang.Dispatcher.extend({constructor:function(b,d){if(this.editableElement="string"==typeof b?document.getElementById(b):b,this.config=a.lang.object({}).merge(c).merge(d).get(),this._isCompatible=a.browser.supported(),"textarea"!=this.editableElement.nodeName.toLowerCase()&&(this.config.contentEditableMode=!0,this.config.noTextarea=!0),this.config.noTextarea||(this.textarea=new a.views.Textarea(this,this.editableElement,this.config),this.currentView=this.textarea),!this._isCompatible||!this.config.supportTouchDevices&&a.browser.isTouchDevice()){var e=this;return void setTimeout(function(){e.fire("beforeload").fire("load")},0)}a.dom.addClass(document.body,this.config.bodyClassName),this.composer=new a.views.Composer(this,this.editableElement,this.config),this.currentView=this.composer,"function"==typeof this.config.parser&&this._initParser(),this.on("beforeload",this.handleBeforeLoad)},handleBeforeLoad:function(){this.config.noTextarea||(this.synchronizer=new a.views.Synchronizer(this,this.textarea,this.composer)),this.config.toolbar&&(this.toolbar=new a.toolbar.Toolbar(this,this.config.toolbar,this.config.showToolbarAfterInit))},isCompatible:function(){return this._isCompatible},clear:function(){return this.currentView.clear(),this},getValue:function(a,b){return this.currentView.getValue(a,b)},setValue:function(a,b){return this.fire("unset_placeholder"),a?(this.currentView.setValue(a,b),this):this.clear()},cleanUp:function(){this.currentView.cleanUp()},focus:function(a){return this.currentView.focus(a),this},disable:function(){return this.currentView.disable(),this},enable:function(){return this.currentView.enable(),this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},parse:function(b,c){var d=this.config.contentEditableMode?document:this.composer?this.composer.sandbox.getDocument():null,e=this.config.parser(b,{rules:this.config.parserRules,cleanUp:this.config.cleanUp,context:d,uneditableClass:this.config.uneditableContainerClassname,clearInternals:c});return"object"==typeof b&&a.quirks.redraw(b),e},_initParser:function(){var c,b=this;a.browser.supportsModenPaste()?this.on("paste:composer",function(d){d.preventDefault(),c=a.dom.getPastedHtml(d),c&&b._cleanAndPaste(c)}):this.on("beforepaste:composer",function(c){c.preventDefault(),a.dom.getPastedHtmlWithDiv(b.composer,function(a){a&&b._cleanAndPaste(a)})})},_cleanAndPaste:function(b){var c=a.quirks.cleanPastedHTML(b,{referenceNode:this.composer.element,rules:this.config.pasteParserRulesets||[{set:this.config.parserRules}],uneditableClass:this.config.uneditableContainerClassname});this.composer.selection.deleteContents(),this.composer.selection.insertHTML(c)}})}(wysihtml5),function(a){var b=a.dom,c="wysihtml5-command-dialog-opened",d="input, select, textarea",e="[data-wysihtml5-dialog-field]",f="data-wysihtml5-dialog-field";a.toolbar.Dialog=a.lang.Dispatcher.extend({constructor:function(a,b){this.link=a,this.container=b},_observe:function(){if(!this._observed){var e=this,f=function(a){var b=e._serialize();b==e.elementToChange?e.fire("edit",b):e.fire("save",b),e.hide(),a.preventDefault(),a.stopPropagation()};b.observe(e.link,"click",function(){b.hasClass(e.link,c)&&setTimeout(function(){e.hide()},0)}),b.observe(this.container,"keydown",function(b){var c=b.keyCode;c===a.ENTER_KEY&&f(b),c===a.ESCAPE_KEY&&(e.fire("cancel"),e.hide())}),b.delegate(this.container,"[data-wysihtml5-dialog-action=save]","click",f),b.delegate(this.container,"[data-wysihtml5-dialog-action=cancel]","click",function(a){e.fire("cancel"),e.hide(),a.preventDefault(),a.stopPropagation()});for(var g=this.container.querySelectorAll(d),h=0,i=g.length,j=function(){clearInterval(e.interval)};h<i;h++)b.observe(g[h],"change",j);this._observed=!0}},_serialize:function(){for(var a=this.elementToChange||{},b=this.container.querySelectorAll(e),c=b.length,d=0;d<c;d++)a[b[d].getAttribute(f)]=b[d].value;return a},_interpolate:function(a){for(var b,c,d,g=document.querySelector(":focus"),h=this.container.querySelectorAll(e),i=h.length,j=0;j<i;j++)b=h[j],b!==g&&(a&&"hidden"===b.type||(c=b.getAttribute(f),d=this.elementToChange&&"boolean"!=typeof this.elementToChange?this.elementToChange.getAttribute(c)||"":b.defaultValue,b.value=d))},show:function(a){if(!b.hasClass(this.link,c)){var e=this,f=this.container.querySelector(d);if(this.elementToChange=a,this._observe(),this._interpolate(),a&&(this.interval=setInterval(function(){e._interpolate(!0)},500)),b.addClass(this.link,c),this.container.style.display="",this.fire("show"),f&&!a)try{f.focus()}catch(a){}}},hide:function(){clearInterval(this.interval),this.elementToChange=null,b.removeClass(this.link,c),this.container.style.display="none",this.fire("hide")}})}(wysihtml5),function(a){var b=a.dom,c={position:"relative"},d={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1},e={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"},f={"x-webkit-speech":"",speech:""};a.toolbar.Speech=function(g,h){var i=document.createElement("input");if(!a.browser.supportsSpeechApiOn(i))return void(h.style.display="none");var j=g.editor.textarea.element.getAttribute("lang");j&&(f.lang=j);var k=document.createElement("div");a.lang.object(d).merge({width:h.offsetWidth+"px",height:h.offsetHeight+"px"}),b.insert(i).into(k),b.insert(k).into(h),b.setStyles(e).on(i),b.setAttributes(f).on(i),b.setStyles(d).on(k),b.setStyles(c).on(h);var l="onwebkitspeechchange"in i?"webkitspeechchange":"speechchange";b.observe(i,l,function(){g.execCommand("insertText",i.value),i.value=""}),b.observe(i,"click",function(a){b.hasClass(h,"wysihtml5-command-disabled")&&a.preventDefault(),a.stopPropagation()})}}(wysihtml5),function(a){var b="wysihtml5-command-disabled",c="wysihtml5-commands-disabled",d="wysihtml5-command-active",e="wysihtml5-action-active",f=a.dom;a.toolbar.Toolbar=Base.extend({constructor:function(f,g,h){this.editor=f,this.container="string"==typeof g?document.getElementById(g):g,this.composer=f.composer,this._getLinks("command"),this._getLinks("action"),this._observe(),h&&this.show(),null!=f.config.classNameCommandDisabled&&(b=f.config.classNameCommandDisabled),null!=f.config.classNameCommandsDisabled&&(c=f.config.classNameCommandsDisabled),null!=f.config.classNameCommandActive&&(d=f.config.classNameCommandActive),null!=f.config.classNameActionActive&&(e=f.config.classNameActionActive);for(var i=this.container.querySelectorAll("[data-wysihtml5-command=insertSpeech]"),j=i.length,k=0;k<j;k++)new a.toolbar.Speech(this,i[k])},_getLinks:function(b){for(var g,h,i,j,k,c=this[b+"Links"]=a.lang.array(this.container.querySelectorAll("[data-wysihtml5-"+b+"]")).get(),d=c.length,e=0,f=this[b+"Mapping"]={};e<d;e++)g=c[e],i=g.getAttribute("data-wysihtml5-"+b),j=g.getAttribute("data-wysihtml5-"+b+"-value"),h=this.container.querySelector("[data-wysihtml5-"+b+"-group='"+i+"']"),k=this._getDialog(g,i),f[i+":"+j]={link:g,group:h,name:i,value:j,dialog:k,state:!1}},_getDialog:function(b,c){var f,g,d=this,e=this.container.querySelector("[data-wysihtml5-dialog='"+c+"']");return e&&(f=a.toolbar["Dialog_"+c]?new a.toolbar["Dialog_"+c](b,e):new a.toolbar.Dialog(b,e),f.on("show",function(){g=d.composer.selection.getBookmark(),d.editor.fire("show:dialog",{command:c,dialogContainer:e,commandLink:b})}),f.on("save",function(a){g&&d.composer.selection.setBookmark(g),d._execCommand(c,a),d.editor.fire("save:dialog",{command:c,dialogContainer:e,commandLink:b})}),f.on("cancel",function(){d.editor.focus(!1),d.editor.fire("cancel:dialog",{command:c,dialogContainer:e,commandLink:b})})),f},execCommand:function(a,b){if(!this.commandsDisabled){var c=this.commandMapping[a+":"+b];c&&c.dialog&&!c.state?c.dialog.show():this._execCommand(a,b)}},_execCommand:function(a,b){this.editor.focus(!1),this.composer.commands.exec(a,b),this._updateLinkStates()},execAction:function(a){var b=this.editor;"change_view"===a&&b.textarea&&(b.currentView===b.textarea?b.fire("change_view","composer"):b.fire("change_view","textarea")),"showSource"==a&&b.fire("showSource")},_observe:function(){for(var a=this,b=this.editor,d=this.container,e=this.commandLinks.concat(this.actionLinks),g=e.length,h=0;h<g;h++)"A"===e[h].nodeName?f.setAttributes({href:"javascript:;",unselectable:"on"}).on(e[h]):f.setAttributes({unselectable:"on"}).on(e[h]);f.delegate(d,"[data-wysihtml5-command], [data-wysihtml5-action]","mousedown",function(a){a.preventDefault()}),f.delegate(d,"[data-wysihtml5-command]","click",function(b){var c=this,d=c.getAttribute("data-wysihtml5-command"),e=c.getAttribute("data-wysihtml5-command-value");a.execCommand(d,e),b.preventDefault()}),f.delegate(d,"[data-wysihtml5-action]","click",function(b){var c=this.getAttribute("data-wysihtml5-action");a.execAction(c),b.preventDefault()}),b.on("interaction:composer",function(){a._updateLinkStates()}),b.on("focus:composer",function(){a.bookmark=null}),this.editor.config.handleTables&&(b.on("tableselect:composer",function(){a.container.querySelectorAll('[data-wysihtml5-hiddentools="table"]')[0].style.display=""}),b.on("tableunselect:composer",function(){a.container.querySelectorAll('[data-wysihtml5-hiddentools="table"]')[0].style.display="none"})),b.on("change_view",function(e){b.textarea&&setTimeout(function(){a.commandsDisabled="composer"!==e,a._updateLinkStates(),a.commandsDisabled?f.addClass(d,c):f.removeClass(d,c)},0)})},_updateLinkStates:function(){var h,i,j,k,c=this.commandMapping,g=this.actionMapping;for(h in c)k=c[h],this.commandsDisabled?(i=!1,f.removeClass(k.link,d),k.group&&f.removeClass(k.group,d),k.dialog&&k.dialog.hide()):(i=this.composer.commands.state(k.name,k.value),f.removeClass(k.link,b),k.group&&f.removeClass(k.group,b)),k.state!==i&&(k.state=i,i?(f.addClass(k.link,d),k.group&&f.addClass(k.group,d),k.dialog&&("object"==typeof i||a.lang.object(i).isArray()?(!k.dialog.multiselect&&a.lang.object(i).isArray()&&(i=1!==i.length||i[0],k.state=i),k.dialog.show(i)):k.dialog.hide())):(f.removeClass(k.link,d),k.group&&f.removeClass(k.group,d),k.dialog&&k.dialog.hide()));for(h in g)j=g[h],"change_view"===j.name&&(j.state=this.editor.currentView===this.editor.textarea,j.state?f.addClass(j.link,e):f.removeClass(j.link,e))},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}})}(wysihtml5),function(a){a.toolbar.Dialog_createTable=a.toolbar.Dialog.extend({show:function(a){this.base(a)}})}(wysihtml5),function(a){var c=(a.dom,"[data-wysihtml5-dialog-field]"),d="data-wysihtml5-dialog-field";a.toolbar.Dialog_foreColorStyle=a.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){for(var a={},b=this.container.querySelectorAll(c),e=b.length,f=0;f<e;f++)a[b[f].getAttribute(d)]=b[f].value;return a},_interpolate:function(b){for(var e,h=document.querySelector(":focus"),i=this.container.querySelectorAll(c),j=i.length,k=0,l=this.elementToChange?a.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,m=l?l.getAttribute("style"):null,n=m?a.quirks.styleParser.parseColor(m,"color"):null;k<j;k++)e=i[k],e!==h&&(b&&"hidden"===e.type||"color"===e.getAttribute(d)&&(n?n[3]&&1!=n[3]?e.value="rgba("+n[0]+","+n[1]+","+n[2]+","+n[3]+");":e.value="rgb("+n[0]+","+n[1]+","+n[2]+");":e.value="rgb(0,0,0);"))}})}(wysihtml5),function(a){a.dom;a.toolbar.Dialog_fontSizeStyle=a.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){return{size:this.container.querySelector('[data-wysihtml5-dialog-field="size"]').value}},_interpolate:function(b){var c=document.querySelector(":focus"),d=this.container.querySelector("[data-wysihtml5-dialog-field='size']"),e=this.elementToChange?a.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,f=e?e.getAttribute("style"):null,g=f?a.quirks.styleParser.parseFontSize(f):null;d&&d!==c&&g&&!/^\s*$/.test(g)&&(d.value=g)}})}(wysihtml5);var Handlebars=function(){var a=function(){"use strict";function a(a){this.string=a}var b;return a.prototype.toString=function(){return""+this.string},b=a}(),b=function(a){"use strict";function b(a){return h[a]||"&amp;"}function c(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])}function d(a){return a instanceof g?a.toString():a||0===a?(a=""+a,j.test(a)?a.replace(i,b):a):""}function e(a){return!a&&0!==a||!(!m(a)||0!==a.length)}var f={},g=a,h={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},i=/[&<>"'`]/g,j=/[&<>"'`]/;f.extend=c;var k=Object.prototype.toString;f.toString=k;var l=function(a){return"function"==typeof a};l(/x/)&&(l=function(a){return"function"==typeof a&&"[object Function]"===k.call(a)});var l;f.isFunction=l;var m=Array.isArray||function(a){return!(!a||"object"!=typeof a)&&"[object Array]"===k.call(a)};return f.isArray=m,f.escapeExpression=d,f.isEmpty=e,f}(a),c=function(){"use strict";function a(a,b){var d;b&&b.firstLine&&(d=b.firstLine,a+=" - "+d+":"+b.firstColumn);for(var e=Error.prototype.constructor.call(this,a),f=0;f<c.length;f++)this[c[f]]=e[c[f]];d&&(this.lineNumber=d,this.column=b.firstColumn)}var b,c=["description","fileName","lineNumber","message","name","number","stack"];return a.prototype=new Error,b=a}(),d=function(a,b){"use strict";function c(a,b){this.helpers=a||{},this.partials=b||{},d(this)}function d(a){a.registerHelper("helperMissing",function(a){if(2!==arguments.length)throw new h("Missing helper: '"+a+"'")}),a.registerHelper("blockHelperMissing",function(b,c){var d=c.inverse||function(){},e=c.fn;return m(b)&&(b=b.call(this)),b===!0?e(this):b===!1||null==b?d(this):l(b)?b.length>0?a.helpers.each(b,c):d(this):e(b)}),a.registerHelper("each",function(a,b){var c,d=b.fn,e=b.inverse,f=0,g="";if(m(a)&&(a=a.call(this)),b.data&&(c=q(b.data)),a&&"object"==typeof a)if(l(a))for(var h=a.length;h>f;f++)c&&(c.index=f,c.first=0===f,c.last=f===a.length-1),g+=d(a[f],{data:c});else for(var i in a)a.hasOwnProperty(i)&&(c&&(c.key=i,c.index=f,c.first=0===f),g+=d(a[i],{data:c}),f++);return 0===f&&(g=e(this)),g}),a.registerHelper("if",function(a,b){return m(a)&&(a=a.call(this)),!b.hash.includeZero&&!a||g.isEmpty(a)?b.inverse(this):b.fn(this)}),a.registerHelper("unless",function(b,c){return a.helpers.if.call(this,b,{fn:c.inverse,inverse:c.fn,hash:c.hash})}),a.registerHelper("with",function(a,b){return m(a)&&(a=a.call(this)),g.isEmpty(a)?void 0:b.fn(a)}),a.registerHelper("log",function(b,c){var d=c.data&&null!=c.data.level?parseInt(c.data.level,10):1;a.log(d,b)})}function e(a,b){p.log(a,b)}var f={},g=a,h=b,i="1.3.0";f.VERSION=i;var j=4;f.COMPILER_REVISION=j;var k={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"};f.REVISION_CHANGES=k;var l=g.isArray,m=g.isFunction,n=g.toString,o="[object Object]";f.HandlebarsEnvironment=c,c.prototype={constructor:c,logger:p,log:e,registerHelper:function(a,b,c){if(n.call(a)===o){if(c||b)throw new h("Arg not supported with multiple helpers");g.extend(this.helpers,a)}else c&&(b.not=c),this.helpers[a]=b},registerPartial:function(a,b){n.call(a)===o?g.extend(this.partials,a):this.partials[a]=b}};var p={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(a,b){if(p.level<=a){var c=p.methodMap[a];"undefined"!=typeof console&&console[c]&&console[c].call(console,b)}}};f.logger=p,f.log=e;var q=function(a){var b={};return g.extend(b,a),b};return f.createFrame=q,f}(b,c),e=function(a,b,c){"use strict";function d(a){var b=a&&a[0]||1,c=m;if(b!==c){if(c>b){var d=n[c],e=n[b];throw new l("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+d+") or downgrade your runtime to an older version ("+e+").")}throw new l("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+a[1]+").")}}function e(a,b){if(!b)throw new l("No environment passed to template");var c=function(a,c,d,e,f,g){var h=b.VM.invokePartial.apply(this,arguments);if(null!=h)return h;if(b.compile){var i={helpers:e,partials:f,data:g};return f[c]=b.compile(a,{data:void 0!==g},b),f[c](d,i)}throw new l("The partial "+c+" could not be compiled when running in runtime-only mode")},d={escapeExpression:k.escapeExpression,invokePartial:c,programs:[],program:function(a,b,c){var d=this.programs[a];return c?d=g(a,b,c):d||(d=this.programs[a]=g(a,b)),d},merge:function(a,b){var c=a||b;return a&&b&&a!==b&&(c={},k.extend(c,b),k.extend(c,a)),c},programWithDepth:b.VM.programWithDepth,noop:b.VM.noop,compilerInfo:null};return function(c,e){e=e||{};var f,g,h=e.partial?e:b;e.partial||(f=e.helpers,g=e.partials);var i=a.call(d,h,c,f,g,e.data);return e.partial||b.VM.checkRevision(d.compilerInfo),i}}function f(a,b,c){var d=Array.prototype.slice.call(arguments,3),e=function(a,e){return e=e||{},b.apply(this,[a,e.data||c].concat(d))};return e.program=a,e.depth=d.length,e}function g(a,b,c){var d=function(a,d){return d=d||{},b(a,d.data||c)};return d.program=a,d.depth=0,d}function h(a,b,c,d,e,f){var g={partial:!0,helpers:d,partials:e,data:f};if(void 0===a)throw new l("The partial "+b+" could not be found");return a instanceof Function?a(c,g):void 0}function i(){return""}var j={},k=a,l=b,m=c.COMPILER_REVISION,n=c.REVISION_CHANGES;return j.checkRevision=d,j.template=e,j.programWithDepth=f,j.program=g,j.invokePartial=h,j.noop=i,j}(b,c,d),f=function(a,b,c,d,e){"use strict";var f,g=a,h=b,i=c,j=d,k=e,l=function(){var a=new g.HandlebarsEnvironment;return j.extend(a,g),a.SafeString=h,a.Exception=i,a.Utils=j,a.VM=k,a.template=function(b){return k.template(b,a)},a},m=l();return m.create=l,f=m}(d,a,c,b,e);return f}();this.wysihtml5=this.wysihtml5||{},this.wysihtml5.tpl=this.wysihtml5.tpl||{},this.wysihtml5.tpl.blockquote=Handlebars.template(function(a,b,c,d,e){function k(a,b){var d,c="";return c+="btn-"+i((d=a&&a.options,d=null==d||d===!1?d:d.toolbar,d=null==d||d===!1?d:d.size,typeof d===h?d.apply(a):d))}function l(a,b){return' \n      <span class="fa fa-quote-left"></span>\n    '}function m(a,b){return'\n      <span class="glyphicon glyphicon-quote"></span>\n    '}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g,f="",h="function",i=this.escapeExpression,j=this;return f+='<li>\n  <a class="btn ',g=c.if.call(b,(g=b&&b.options,g=null==g||g===!1?g:g.toolbar,null==g||g===!1?g:g.size),{hash:{},inverse:j.noop,fn:j.program(1,k,e),data:e}),(g||0===g)&&(f+=g),f+=' btn-default" data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="blockquote" data-wysihtml5-display-format-name="false" tabindex="-1">\n    ',g=c.if.call(b,(g=b&&b.options,g=null==g||g===!1?g:g.toolbar,null==g||g===!1?g:g.fa),{hash:{},inverse:j.program(5,m,e),fn:j.program(3,l,e),data:e}),(g||0===g)&&(f+=g),f+="\n  </a>\n</li>\n"}),this.wysihtml5.tpl.color=Handlebars.template(function(a,b,c,d,e){function k(a,b){var d,c="";return c+="btn-"+i((d=a&&a.options,d=null==d||d===!1?d:d.toolbar,d=null==d||d===!1?d:d.size,typeof d===h?d.apply(a):d))}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g,f="",h="function",i=this.escapeExpression,j=this;return f+='<li class="dropdown">\n  <a class="btn btn-default dropdown-toggle ',g=c.if.call(b,(g=b&&b.options,g=null==g||g===!1?g:g.toolbar,null==g||g===!1?g:g.size),{hash:{},inverse:j.noop,fn:j.program(1,k,e),data:e}),(g||0===g)&&(f+=g),f+='" data-toggle="dropdown" tabindex="-1">\n    <span class="current-color">'+i((g=b&&b.locale,g=null==g||g===!1?g:g.colours,g=null==g||g===!1?g:g.black,typeof g===h?g.apply(b):g))+'</span>\n    <b class="caret"></b>\n  </a>\n  <ul class="dropdown-menu">\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="black"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="black">'+i((g=b&&b.locale,g=null==g||g===!1?g:g.colours,g=null==g||g===!1?g:g.black,typeof g===h?g.apply(b):g))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="silver"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="silver">'+i((g=b&&b.locale,g=null==g||g===!1?g:g.colours,g=null==g||g===!1?g:g.silver,typeof g===h?g.apply(b):g))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="gray"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="gray">'+i((g=b&&b.locale,g=null==g||g===!1?g:g.colours,g=null==g||g===!1?g:g.gray,typeof g===h?g.apply(b):g))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="maroon"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="maroon">'+i((g=b&&b.locale,g=null==g||g===!1?g:g.colours,g=null==g||g===!1?g:g.maroon,typeof g===h?g.apply(b):g))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="red"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="red">'+i((g=b&&b.locale,g=null==g||g===!1?g:g.colours,g=null==g||g===!1?g:g.red,typeof g===h?g.apply(b):g))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="purple"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="purple">'+i((g=b&&b.locale,g=null==g||g===!1?g:g.colours,g=null==g||g===!1?g:g.purple,typeof g===h?g.apply(b):g))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="green"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="green">'+i((g=b&&b.locale,g=null==g||g===!1?g:g.colours,g=null==g||g===!1?g:g.green,typeof g===h?g.apply(b):g))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="olive"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="olive">'+i((g=b&&b.locale,g=null==g||g===!1?g:g.colours,g=null==g||g===!1?g:g.olive,typeof g===h?g.apply(b):g))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="navy"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="navy">'+i((g=b&&b.locale,g=null==g||g===!1?g:g.colours,g=null==g||g===!1?g:g.navy,typeof g===h?g.apply(b):g))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="blue"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="blue">'+i((g=b&&b.locale,g=null==g||g===!1?g:g.colours,g=null==g||g===!1?g:g.blue,typeof g===h?g.apply(b):g))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="orange"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="orange">'+i((g=b&&b.locale,g=null==g||g===!1?g:g.colours,g=null==g||g===!1?g:g.orange,typeof g===h?g.apply(b):g))+"</a></li>\n  </ul>\n</li>\n"}),this.wysihtml5.tpl.emphasis=Handlebars.template(function(a,b,c,d,e){function k(a,b){var d,c="";return c+="btn-"+i((d=a&&a.options,d=null==d||d===!1?d:d.toolbar,d=null==d||d===!1?d:d.size,typeof d===h?d.apply(a):d))}function l(a,b){var e,d="";return d+='\n    <a class="btn ',e=c.if.call(a,(e=a&&a.options,e=null==e||e===!1?e:e.toolbar,null==e||e===!1?e:e.size),{hash:{},inverse:j.noop,fn:j.program(1,k,b),data:b}),(e||0===e)&&(d+=e),d+=' btn-default" data-wysihtml5-command="small" title="CTRL+S" tabindex="-1">'+i((e=a&&a.locale,e=null==e||e===!1?e:e.emphasis,e=null==e||e===!1?e:e.small,typeof e===h?e.apply(a):e))+"</a>\n    "}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g,f="",h="function",i=this.escapeExpression,j=this;return f+='<li>\n  <div class="btn-group">\n    <a class="btn ',g=c.if.call(b,(g=b&&b.options,g=null==g||g===!1?g:g.toolbar,null==g||g===!1?g:g.size),{hash:{},inverse:j.noop,fn:j.program(1,k,e),data:e}),(g||0===g)&&(f+=g),f+=' btn-default" data-wysihtml5-command="bold" title="CTRL+B" tabindex="-1">'+i((g=b&&b.locale,g=null==g||g===!1?g:g.emphasis,g=null==g||g===!1?g:g.bold,typeof g===h?g.apply(b):g))+'</a>\n    <a class="btn ',g=c.if.call(b,(g=b&&b.options,g=null==g||g===!1?g:g.toolbar,null==g||g===!1?g:g.size),{hash:{},inverse:j.noop,fn:j.program(1,k,e),data:e}),(g||0===g)&&(f+=g),f+=' btn-default" data-wysihtml5-command="italic" title="CTRL+I" tabindex="-1">'+i((g=b&&b.locale,
g=null==g||g===!1?g:g.emphasis,g=null==g||g===!1?g:g.italic,typeof g===h?g.apply(b):g))+'</a>\n    <a class="btn ',g=c.if.call(b,(g=b&&b.options,g=null==g||g===!1?g:g.toolbar,null==g||g===!1?g:g.size),{hash:{},inverse:j.noop,fn:j.program(1,k,e),data:e}),(g||0===g)&&(f+=g),f+=' btn-default" data-wysihtml5-command="underline" title="CTRL+U" tabindex="-1">'+i((g=b&&b.locale,g=null==g||g===!1?g:g.emphasis,g=null==g||g===!1?g:g.underline,typeof g===h?g.apply(b):g))+"</a>\n    ",g=c.if.call(b,(g=b&&b.options,g=null==g||g===!1?g:g.toolbar,g=null==g||g===!1?g:g.emphasis,null==g||g===!1?g:g.small),{hash:{},inverse:j.noop,fn:j.program(3,l,e),data:e}),(g||0===g)&&(f+=g),f+="\n  </div>\n</li>\n"}),this.wysihtml5.tpl["font-styles"]=Handlebars.template(function(a,b,c,d,e){function k(a,b){var d,c="";return c+="btn-"+i((d=a&&a.options,d=null==d||d===!1?d:d.toolbar,d=null==d||d===!1?d:d.size,typeof d===h?d.apply(a):d))}function l(a,b){return'\n      <span class="fa fa-font"></span>\n    '}function m(a,b){return'\n      <span class="glyphicon glyphicon-font"></span>\n    '}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g,f="",h="function",i=this.escapeExpression,j=this;return f+='<li class="dropdown">\n  <a class="btn btn-default dropdown-toggle ',g=c.if.call(b,(g=b&&b.options,g=null==g||g===!1?g:g.toolbar,null==g||g===!1?g:g.size),{hash:{},inverse:j.noop,fn:j.program(1,k,e),data:e}),(g||0===g)&&(f+=g),f+='" data-toggle="dropdown">\n    ',g=c.if.call(b,(g=b&&b.options,g=null==g||g===!1?g:g.toolbar,null==g||g===!1?g:g.fa),{hash:{},inverse:j.program(5,m,e),fn:j.program(3,l,e),data:e}),(g||0===g)&&(f+=g),f+='\n    <span class="current-font">'+i((g=b&&b.locale,g=null==g||g===!1?g:g.font_styles,g=null==g||g===!1?g:g.normal,typeof g===h?g.apply(b):g))+'</span>\n    <b class="caret"></b>\n  </a>\n  <ul class="dropdown-menu">\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="p" tabindex="-1">'+i((g=b&&b.locale,g=null==g||g===!1?g:g.font_styles,g=null==g||g===!1?g:g.normal,typeof g===h?g.apply(b):g))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h1" tabindex="-1">'+i((g=b&&b.locale,g=null==g||g===!1?g:g.font_styles,g=null==g||g===!1?g:g.h1,typeof g===h?g.apply(b):g))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h2" tabindex="-1">'+i((g=b&&b.locale,g=null==g||g===!1?g:g.font_styles,g=null==g||g===!1?g:g.h2,typeof g===h?g.apply(b):g))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h3" tabindex="-1">'+i((g=b&&b.locale,g=null==g||g===!1?g:g.font_styles,g=null==g||g===!1?g:g.h3,typeof g===h?g.apply(b):g))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h4" tabindex="-1">'+i((g=b&&b.locale,g=null==g||g===!1?g:g.font_styles,g=null==g||g===!1?g:g.h4,typeof g===h?g.apply(b):g))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h5" tabindex="-1">'+i((g=b&&b.locale,g=null==g||g===!1?g:g.font_styles,g=null==g||g===!1?g:g.h5,typeof g===h?g.apply(b):g))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h6" tabindex="-1">'+i((g=b&&b.locale,g=null==g||g===!1?g:g.font_styles,g=null==g||g===!1?g:g.h6,typeof g===h?g.apply(b):g))+"</a></li>\n  </ul>\n</li>\n"}),this.wysihtml5.tpl.html=Handlebars.template(function(a,b,c,d,e){function k(a,b){var d,c="";return c+="btn-"+i((d=a&&a.options,d=null==d||d===!1?d:d.toolbar,d=null==d||d===!1?d:d.size,typeof d===h?d.apply(a):d))}function l(a,b){return'\n        <span class="fa fa-pencil"></span>\n      '}function m(a,b){return'\n        <span class="glyphicon glyphicon-pencil"></span>\n      '}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g,f="",h="function",i=this.escapeExpression,j=this;return f+='<li>\n  <div class="btn-group">\n    <a class="btn ',g=c.if.call(b,(g=b&&b.options,g=null==g||g===!1?g:g.toolbar,null==g||g===!1?g:g.size),{hash:{},inverse:j.noop,fn:j.program(1,k,e),data:e}),(g||0===g)&&(f+=g),f+=' btn-default" data-wysihtml5-action="change_view" title="'+i((g=b&&b.locale,g=null==g||g===!1?g:g.html,g=null==g||g===!1?g:g.edit,typeof g===h?g.apply(b):g))+'" tabindex="-1">\n      ',g=c.if.call(b,(g=b&&b.options,g=null==g||g===!1?g:g.toolbar,null==g||g===!1?g:g.fa),{hash:{},inverse:j.program(5,m,e),fn:j.program(3,l,e),data:e}),(g||0===g)&&(f+=g),f+="\n    </a>\n  </div>\n</li>\n"}),this.wysihtml5.tpl.image=Handlebars.template(function(a,b,c,d,e){function k(a,b){return"modal-sm"}function l(a,b){var d,c="";return c+="btn-"+i((d=a&&a.options,d=null==d||d===!1?d:d.toolbar,d=null==d||d===!1?d:d.size,typeof d===h?d.apply(a):d))}function m(a,b){return'\n      <span class="fa fa-file-image-o"></span>\n    '}function n(a,b){return'\n      <span class="glyphicon glyphicon-picture"></span>\n    '}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g,f="",h="function",i=this.escapeExpression,j=this;return f+='<li>\n  <div class="bootstrap-wysihtml5-insert-image-modal modal fade" data-wysihtml5-dialog="insertImage">\n    <div class="modal-dialog ',g=c.if.call(b,(g=b&&b.options,g=null==g||g===!1?g:g.toolbar,null==g||g===!1?g:g.smallmodals),{hash:{},inverse:j.noop,fn:j.program(1,k,e),data:e}),(g||0===g)&&(f+=g),f+='">\n      <div class="modal-content">\n        <div class="modal-header">\n          <a class="close" data-dismiss="modal">&times;</a>\n          <h3>'+i((g=b&&b.locale,g=null==g||g===!1?g:g.image,g=null==g||g===!1?g:g.insert,typeof g===h?g.apply(b):g))+'</h3>\n        </div>\n        <div class="modal-body">\n          <div class="form-group">\n            <input value="http://" class="bootstrap-wysihtml5-insert-image-url form-control" data-wysihtml5-dialog-field="src">\n          </div> \n        </div>\n        <div class="modal-footer">\n          <a class="btn btn-default" data-dismiss="modal" data-wysihtml5-dialog-action="cancel" href="#">'+i((g=b&&b.locale,g=null==g||g===!1?g:g.image,g=null==g||g===!1?g:g.cancel,typeof g===h?g.apply(b):g))+'</a>\n          <a class="btn btn-primary" data-dismiss="modal"  data-wysihtml5-dialog-action="save" href="#">'+i((g=b&&b.locale,g=null==g||g===!1?g:g.image,g=null==g||g===!1?g:g.insert,typeof g===h?g.apply(b):g))+'</a>\n        </div>\n      </div>\n    </div>\n  </div>\n  <a class="btn ',g=c.if.call(b,(g=b&&b.options,g=null==g||g===!1?g:g.toolbar,null==g||g===!1?g:g.size),{hash:{},inverse:j.noop,fn:j.program(3,l,e),data:e}),(g||0===g)&&(f+=g),f+=' btn-default" data-wysihtml5-command="insertImage" title="'+i((g=b&&b.locale,g=null==g||g===!1?g:g.image,g=null==g||g===!1?g:g.insert,typeof g===h?g.apply(b):g))+'" tabindex="-1">\n    ',g=c.if.call(b,(g=b&&b.options,g=null==g||g===!1?g:g.toolbar,null==g||g===!1?g:g.fa),{hash:{},inverse:j.program(7,n,e),fn:j.program(5,m,e),data:e}),(g||0===g)&&(f+=g),f+="\n  </a>\n</li>\n"}),this.wysihtml5.tpl.link=Handlebars.template(function(a,b,c,d,e){function k(a,b){return"modal-sm"}function l(a,b){var d,c="";return c+="btn-"+i((d=a&&a.options,d=null==d||d===!1?d:d.toolbar,d=null==d||d===!1?d:d.size,typeof d===h?d.apply(a):d))}function m(a,b){return'\n      <span class="fa fa-share-square-o"></span>\n    '}function n(a,b){return'\n      <span class="glyphicon glyphicon-share"></span>\n    '}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g,f="",h="function",i=this.escapeExpression,j=this;return f+='<li>\n  <div class="bootstrap-wysihtml5-insert-link-modal modal fade" data-wysihtml5-dialog="createLink">\n    <div class="modal-dialog ',g=c.if.call(b,(g=b&&b.options,g=null==g||g===!1?g:g.toolbar,null==g||g===!1?g:g.smallmodals),{hash:{},inverse:j.noop,fn:j.program(1,k,e),data:e}),(g||0===g)&&(f+=g),f+='">\n      <div class="modal-content">\n        <div class="modal-header">\n          <a class="close" data-dismiss="modal">&times;</a>\n          <h3>'+i((g=b&&b.locale,g=null==g||g===!1?g:g.link,g=null==g||g===!1?g:g.insert,typeof g===h?g.apply(b):g))+'</h3>\n        </div>\n        <div class="modal-body">\n          <div class="form-group">\n            <input value="http://" class="bootstrap-wysihtml5-insert-link-url form-control" data-wysihtml5-dialog-field="href">\n          </div> \n          <div class="checkbox">\n            <label> \n              <input type="checkbox" class="bootstrap-wysihtml5-insert-link-target" checked>'+i((g=b&&b.locale,g=null==g||g===!1?g:g.link,g=null==g||g===!1?g:g.target,typeof g===h?g.apply(b):g))+'\n            </label>\n          </div>\n        </div>\n        <div class="modal-footer">\n          <a class="btn btn-default" data-dismiss="modal" data-wysihtml5-dialog-action="cancel" href="#">'+i((g=b&&b.locale,g=null==g||g===!1?g:g.link,g=null==g||g===!1?g:g.cancel,typeof g===h?g.apply(b):g))+'</a>\n          <a href="#" class="btn btn-primary" data-dismiss="modal" data-wysihtml5-dialog-action="save">'+i((g=b&&b.locale,g=null==g||g===!1?g:g.link,g=null==g||g===!1?g:g.insert,typeof g===h?g.apply(b):g))+'</a>\n        </div>\n      </div>\n    </div>\n  </div>\n  <a class="btn ',g=c.if.call(b,(g=b&&b.options,g=null==g||g===!1?g:g.toolbar,null==g||g===!1?g:g.size),{hash:{},inverse:j.noop,fn:j.program(3,l,e),data:e}),(g||0===g)&&(f+=g),f+=' btn-default" data-wysihtml5-command="createLink" title="'+i((g=b&&b.locale,g=null==g||g===!1?g:g.link,g=null==g||g===!1?g:g.insert,typeof g===h?g.apply(b):g))+'" tabindex="-1">\n    ',g=c.if.call(b,(g=b&&b.options,g=null==g||g===!1?g:g.toolbar,null==g||g===!1?g:g.fa),{hash:{},inverse:j.program(7,n,e),fn:j.program(5,m,e),data:e}),(g||0===g)&&(f+=g),f+="\n  </a>\n</li>\n"}),this.wysihtml5.tpl.lists=Handlebars.template(function(a,b,c,d,e){function k(a,b){var d,c="";return c+="btn-"+i((d=a&&a.options,d=null==d||d===!1?d:d.toolbar,d=null==d||d===!1?d:d.size,typeof d===h?d.apply(a):d))}function l(a,b){return'\n      <span class="fa fa-list-ul"></span>\n    '}function m(a,b){return'\n      <span class="glyphicon glyphicon-list"></span>\n    '}function n(a,b){return'\n      <span class="fa fa-list-ol"></span>\n    '}function o(a,b){return'\n      <span class="glyphicon glyphicon-th-list"></span>\n    '}function p(a,b){return'\n      <span class="fa fa-outdent"></span>\n    '}function q(a,b){return'\n      <span class="glyphicon glyphicon-indent-right"></span>\n    '}function r(a,b){return'\n      <span class="fa fa-indent"></span>\n    '}function s(a,b){return'\n      <span class="glyphicon glyphicon-indent-left"></span>\n    '}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g,f="",h="function",i=this.escapeExpression,j=this;return f+='<li>\n  <div class="btn-group">\n    <a class="btn ',g=c.if.call(b,(g=b&&b.options,g=null==g||g===!1?g:g.toolbar,null==g||g===!1?g:g.size),{hash:{},inverse:j.noop,fn:j.program(1,k,e),data:e}),(g||0===g)&&(f+=g),f+=' btn-default" data-wysihtml5-command="insertUnorderedList" title="'+i((g=b&&b.locale,g=null==g||g===!1?g:g.lists,g=null==g||g===!1?g:g.unordered,typeof g===h?g.apply(b):g))+'" tabindex="-1">\n    ',g=c.if.call(b,(g=b&&b.options,g=null==g||g===!1?g:g.toolbar,null==g||g===!1?g:g.fa),{hash:{},inverse:j.program(5,m,e),fn:j.program(3,l,e),data:e}),(g||0===g)&&(f+=g),f+='\n    </a>\n    <a class="btn ',g=c.if.call(b,(g=b&&b.options,g=null==g||g===!1?g:g.toolbar,null==g||g===!1?g:g.size),{hash:{},inverse:j.noop,fn:j.program(1,k,e),data:e}),(g||0===g)&&(f+=g),f+=' btn-default" data-wysihtml5-command="insertOrderedList" title="'+i((g=b&&b.locale,g=null==g||g===!1?g:g.lists,g=null==g||g===!1?g:g.ordered,typeof g===h?g.apply(b):g))+'" tabindex="-1">\n    ',g=c.if.call(b,(g=b&&b.options,g=null==g||g===!1?g:g.toolbar,null==g||g===!1?g:g.fa),{hash:{},inverse:j.program(9,o,e),fn:j.program(7,n,e),data:e}),(g||0===g)&&(f+=g),f+='\n    </a>\n    <a class="btn ',g=c.if.call(b,(g=b&&b.options,g=null==g||g===!1?g:g.toolbar,null==g||g===!1?g:g.size),{hash:{},inverse:j.noop,fn:j.program(1,k,e),data:e}),(g||0===g)&&(f+=g),f+=' btn-default" data-wysihtml5-command="Outdent" title="'+i((g=b&&b.locale,g=null==g||g===!1?g:g.lists,g=null==g||g===!1?g:g.outdent,typeof g===h?g.apply(b):g))+'" tabindex="-1">\n    ',g=c.if.call(b,(g=b&&b.options,g=null==g||g===!1?g:g.toolbar,null==g||g===!1?g:g.fa),{hash:{},inverse:j.program(13,q,e),fn:j.program(11,p,e),data:e}),(g||0===g)&&(f+=g),f+='\n    </a>\n    <a class="btn ',g=c.if.call(b,(g=b&&b.options,g=null==g||g===!1?g:g.toolbar,null==g||g===!1?g:g.size),{hash:{},inverse:j.noop,fn:j.program(1,k,e),data:e}),(g||0===g)&&(f+=g),f+=' btn-default" data-wysihtml5-command="Indent" title="'+i((g=b&&b.locale,g=null==g||g===!1?g:g.lists,g=null==g||g===!1?g:g.indent,typeof g===h?g.apply(b):g))+'" tabindex="-1">\n    ',g=c.if.call(b,(g=b&&b.options,g=null==g||g===!1?g:g.toolbar,null==g||g===!1?g:g.fa),{hash:{},inverse:j.program(17,s,e),fn:j.program(15,r,e),data:e}),(g||0===g)&&(f+=g),f+="\n    </a>\n  </div>\n</li>\n"}),function(a){"use strict";"function"==typeof define&&define.amd?define("bootstrap.wysihtml5",["jquery","wysihtml5","bootstrap","bootstrap.wysihtml5.templates","bootstrap.wysihtml5.commands"],a):a(jQuery,wysihtml5)}(function(a,b){"use strict";var c=function(a,b){var c=function(a,c,d){if(b.tpl[a])return b.tpl[a]({locale:c,options:d})},d=function(c,d){this.el=c;var e=a.extend(!0,{},f,d);for(var g in e.customTemplates)e.customTemplates.hasOwnProperty(g)&&(b.tpl[g]=e.customTemplates[g]);this.toolbar=this.createToolbar(c,e),this.editor=this.createEditor(e)};d.prototype={constructor:d,createEditor:function(b){b=b||{},b=a.extend(!0,{},b),b.toolbar=this.toolbar[0],this.initializeEditor(this.el[0],b)},initializeEditor:function(a,c){var d=new b.Editor(this.el[0],c);if(d.on("beforeload",this.syncBootstrapDialogEvents),d.on("beforeload",this.loadParserRules),d.composer.editableArea.contentDocument?this.addMoreShortcuts(d,d.composer.editableArea.contentDocument.body||d.composer.editableArea.contentDocument,c.shortcuts):this.addMoreShortcuts(d,d.composer.editableArea,c.shortcuts),c&&c.events)for(var e in c.events)c.events.hasOwnProperty(e)&&d.on(e,c.events[e]);return d},loadParserRules:function(){"string"===a.type(this.config.parserRules)&&a.ajax({dataType:"json",url:this.config.parserRules,context:this,error:function(a,b,c){console.log(c)},success:function(a){this.config.parserRules=a,console.log("parserrules loaded")}}),this.config.pasteParserRulesets&&"string"===a.type(this.config.pasteParserRulesets)&&a.ajax({dataType:"json",url:this.config.pasteParserRulesets,context:this,error:function(a,b,c){console.log(c)},success:function(a){this.config.pasteParserRulesets=a}})},syncBootstrapDialogEvents:function(){var b=this;a.map(this.toolbar.commandMapping,function(a){return[a]}).filter(function(a){return a.dialog}).map(function(a){return a.dialog}).forEach(function(c){c.on("show",function(){a(this.container).modal("show")}),c.on("hide",function(){a(this.container).modal("hide"),setTimeout(b.composer.focus,0)}),a(c.container).on("shown.bs.modal",function(){a(this).find("input, select, textarea").first().focus()})}),this.on("change_view",function(){a(this.toolbar.container.children).find("a.btn").not('[data-wysihtml5-action="change_view"]').toggleClass("disabled")})},createToolbar:function(b,d){var e=this,h=a("<ul/>",{class:"wysihtml5-toolbar",style:"display:none"}),i=d.locale||f.locale||"en";g.hasOwnProperty(i)||(console.debug("Locale '"+i+"' not found. Available locales are: "+Object.keys(g)+". Falling back to 'en'."),i="en");var j=a.extend(!0,{},g.en,g[i]);for(var k in d.toolbar)d.toolbar[k]&&h.append(c(k,j,d));return h.find('a[data-wysihtml5-command="formatBlock"]').click(function(b){var c=b.delegateTarget||b.target||b.srcElement,d=a(c),f=d.data("wysihtml5-display-format-name"),g=d.data("wysihtml5-format-name")||d.html();void 0!==f&&"true"!==f||e.toolbar.find(".current-font").text(g)}),h.find('a[data-wysihtml5-command="foreColor"]').click(function(b){var c=b.target||b.srcElement,d=a(c);e.toolbar.find(".current-color").text(d.html())}),this.el.before(h),h},addMoreShortcuts:function(a,c,d){b.dom.observe(c,"keydown",function(c){var e=c.keyCode,f=d[e];if((c.ctrlKey||c.metaKey||c.altKey)&&f&&b.commands[f]){var g=a.toolbar.commandMapping[f+":null"];g&&g.dialog&&!g.state?g.dialog.show():b.commands[f].exec(a.composer,f),c.preventDefault()}})}};var e={resetDefaults:function(){a.fn.wysihtml5.defaultOptions=a.extend(!0,{},a.fn.wysihtml5.defaultOptionsCache)},bypassDefaults:function(b){return this.each(function(){var c=a(this);c.data("wysihtml5",new d(c,b))})},shallowExtend:function(b){var c=a.extend({},a.fn.wysihtml5.defaultOptions,b||{},a(this).data()),d=this;return e.bypassDefaults.apply(d,[c])},deepExtend:function(b){var c=a.extend(!0,{},a.fn.wysihtml5.defaultOptions,b||{}),d=this;return e.bypassDefaults.apply(d,[c])},init:function(a){var b=this;return e.shallowExtend.apply(b,[a])}};a.fn.wysihtml5=function(b){return e[b]?e[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Method "+b+" does not exist on jQuery.wysihtml5"):e.init.apply(this,arguments)},a.fn.wysihtml5.Constructor=d;var f=a.fn.wysihtml5.defaultOptions={toolbar:{"font-styles":!0,color:!1,emphasis:{small:!0},blockquote:!0,lists:!0,html:!1,link:!0,image:!0,smallmodals:!1},useLineBreaks:!1,parserRules:{classes:{"wysiwyg-color-silver":1,"wysiwyg-color-gray":1,"wysiwyg-color-white":1,"wysiwyg-color-maroon":1,"wysiwyg-color-red":1,"wysiwyg-color-purple":1,"wysiwyg-color-fuchsia":1,"wysiwyg-color-green":1,"wysiwyg-color-lime":1,"wysiwyg-color-olive":1,"wysiwyg-color-yellow":1,"wysiwyg-color-navy":1,"wysiwyg-color-blue":1,"wysiwyg-color-teal":1,"wysiwyg-color-aqua":1,"wysiwyg-color-orange":1},tags:{b:{},i:{},strong:{},em:{},p:{},br:{},ol:{},ul:{},li:{},h1:{},h2:{},h3:{},h4:{},h5:{},h6:{},blockquote:{},u:1,img:{check_attributes:{width:"numbers",alt:"alt",src:"url",height:"numbers"}},a:{check_attributes:{href:"url"},set_attributes:{target:"_blank",rel:"nofollow"}},span:1,div:1,small:1,code:1,pre:1}},locale:"en",shortcuts:{83:"small",75:"createLink"}};"undefined"==typeof a.fn.wysihtml5.defaultOptionsCache&&(a.fn.wysihtml5.defaultOptionsCache=a.extend(!0,{},a.fn.wysihtml5.defaultOptions));var g=a.fn.wysihtml5.locale={}};c(a,b)}),function(a){a.commands.small={exec:function(b,c){return a.commands.formatInline.exec(b,c,"small")},state:function(b,c){return a.commands.formatInline.state(b,c,"small")}}}(wysihtml5),function(a){"function"==typeof define&&define.amd?define("bootstrap.wysihtml5.en-US",["jquery","bootstrap.wysihtml5"],a):a(jQuery)}(function(a){a.fn.wysihtml5.locale.en=a.fn.wysihtml5.locale["en-US"]={font_styles:{normal:"Normal text",h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",h4:"Heading 4",h5:"Heading 5",h6:"Heading 6"},emphasis:{bold:"Bold",italic:"Italic",underline:"Underline",small:"Small"},lists:{unordered:"Unordered list",ordered:"Ordered list",outdent:"Outdent",indent:"Indent"},link:{insert:"Insert link",cancel:"Cancel",target:"Open link in new window"},image:{insert:"Insert image",cancel:"Cancel"},html:{edit:"Edit HTML"},colours:{black:"Black",silver:"Silver",gray:"Grey",maroon:"Maroon",red:"Red",purple:"Purple",green:"Green",olive:"Olive",navy:"Navy",blue:"Blue",orange:"Orange"}}});