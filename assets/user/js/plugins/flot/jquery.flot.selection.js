!function(a){function b(b){function f(a){c.active&&(m(a),b.getPlaceholder().trigger("plotselecting",[i()]))}function g(b){1==b.which&&(document.body.focus(),void 0!==document.onselectstart&&null==d.onselectstart&&(d.onselectstart=document.onselectstart,document.onselectstart=function(){return!1}),void 0!==document.ondrag&&null==d.ondrag&&(d.ondrag=document.ondrag,document.ondrag=function(){return!1}),l(c.first,b),c.active=!0,e=function(a){h(a)},a(document).one("mouseup",e))}function h(a){return e=null,void 0!==document.onselectstart&&(document.onselectstart=d.onselectstart),void 0!==document.ondrag&&(document.ondrag=d.ondrag),c.active=!1,m(a),q()?j():(b.getPlaceholder().trigger("plotunselected",[]),b.getPlaceholder().trigger("plotselecting",[null])),!1}function i(){if(!q())return null;if(!c.show)return null;var d={},e=c.first,f=c.second;return a.each(b.getAxes(),function(a,b){if(b.used){var c=b.c2p(e[b.direction]),g=b.c2p(f[b.direction]);d[a]={from:Math.min(c,g),to:Math.max(c,g)}}}),d}function j(){var a=i();b.getPlaceholder().trigger("plotselected",[a]),a.xaxis&&a.yaxis&&b.getPlaceholder().trigger("selected",[{x1:a.xaxis.from,y1:a.yaxis.from,x2:a.xaxis.to,y2:a.yaxis.to}])}function k(a,b,c){return b<a?a:b>c?c:b}function l(a,d){var e=b.getOptions(),f=b.getPlaceholder().offset(),g=b.getPlotOffset();a.x=k(0,d.pageX-f.left-g.left,b.width()),a.y=k(0,d.pageY-f.top-g.top,b.height()),"y"==e.selection.mode&&(a.x=a==c.first?0:b.width()),"x"==e.selection.mode&&(a.y=a==c.first?0:b.height())}function m(a){null!=a.pageX&&(l(c.second,a),q()?(c.show=!0,b.triggerRedrawOverlay()):n(!0))}function n(a){c.show&&(c.show=!1,b.triggerRedrawOverlay(),a||b.getPlaceholder().trigger("plotunselected",[]))}function o(a,c){var d,e,f,g,h=b.getAxes();for(var i in h)if(d=h[i],d.direction==c&&(g=c+d.n+"axis",a[g]||1!=d.n||(g=c+"axis"),a[g])){e=a[g].from,f=a[g].to;break}if(a[g]||(d="x"==c?b.getXAxes()[0]:b.getYAxes()[0],e=a[c+"1"],f=a[c+"2"]),null!=e&&null!=f&&e>f){var j=e;e=f,f=j}return{from:e,to:f,axis:d}}function p(a,d){var f,g=b.getOptions();"y"==g.selection.mode?(c.first.x=0,c.second.x=b.width()):(f=o(a,"x"),c.first.x=f.axis.p2c(f.from),c.second.x=f.axis.p2c(f.to)),"x"==g.selection.mode?(c.first.y=0,c.second.y=b.height()):(f=o(a,"y"),c.first.y=f.axis.p2c(f.from),c.second.y=f.axis.p2c(f.to)),c.show=!0,b.triggerRedrawOverlay(),!d&&q()&&j()}function q(){var a=b.getOptions().selection.minSize;return Math.abs(c.second.x-c.first.x)>=a&&Math.abs(c.second.y-c.first.y)>=a}var c={first:{x:-1,y:-1},second:{x:-1,y:-1},show:!1,active:!1},d={},e=null;b.clearSelection=n,b.setSelection=p,b.getSelection=i,b.hooks.bindEvents.push(function(a,b){var c=a.getOptions();null!=c.selection.mode&&(b.mousemove(f),b.mousedown(g))}),b.hooks.drawOverlay.push(function(b,d){if(c.show&&q()){var e=b.getPlotOffset(),f=b.getOptions();d.save(),d.translate(e.left,e.top);var g=a.color.parse(f.selection.color);d.strokeStyle=g.scale("a",.8).toString(),d.lineWidth=1,d.lineJoin=f.selection.shape,d.fillStyle=g.scale("a",.4).toString();var h=Math.min(c.first.x,c.second.x)+.5,i=Math.min(c.first.y,c.second.y)+.5,j=Math.abs(c.second.x-c.first.x)-1,k=Math.abs(c.second.y-c.first.y)-1;d.fillRect(h,i,j,k),d.strokeRect(h,i,j,k),d.restore()}}),b.hooks.shutdown.push(function(b,c){c.unbind("mousemove",f),c.unbind("mousedown",g),e&&a(document).unbind("mouseup",e)})}a.plot.plugins.push({init:b,options:{selection:{mode:null,color:"#e8cfac",shape:"round",minSize:5}},name:"selection",version:"1.1"})}(jQuery);