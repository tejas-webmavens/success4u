!function(a){"use strict";var b={prefilled:null,CapitalizeFirstLetter:!1,preventSubmitOnEnter:!0,isClearInputOnEsc:!0,externalTagId:!1,prefillIdFieldName:"Id",prefillValueFieldName:"Value",AjaxPush:null,AjaxPushAllTags:null,AjaxPushParameters:null,delimiters:[9,13,44],backspace:[8],maxTags:0,hiddenTagListName:null,hiddenTagListId:null,replace:!0,output:null,deleteTagsOnBackspace:!0,tagsContainer:null,tagCloseIcon:"x",tagClass:"",validator:null,onlyTagList:!1,tagList:null,fillInputOnTagRemove:!1},c={pushTag:function(b,c,e){var h,i,j,k,n,o,p,q,r,s,u,f=a(this),g=f.data("opts"),l=f.data("tlis"),m=f.data("tlid");if(b=d.trimTag(b,g.delimiterChars),b&&!(b.length<=0)){if(g.onlyTagList&&void 0!==g.tagList&&g.tagList){var v=g.tagList;a.each(v,function(a,b){v[a]=b.toLowerCase()});var w=a.inArray(b.toLowerCase(),v);if(-1===w)return}g.CapitalizeFirstLetter&&b.length>1&&(b=b.charAt(0).toUpperCase()+b.slice(1).toLowerCase()),g.validator&&!g.validator(b)||g.maxTags>0&&l.length>=g.maxTags||(h=!1,i=jQuery.map(l,function(a){return a.toLowerCase()}),n=a.inArray(b.toLowerCase(),i),-1!==n&&(h=!0),h?(f.trigger("tm:duplicated",b),a("#"+f.data("tm_rndid")+"_"+m[n]).stop().animate({backgroundColor:g.blinkBGColor_1},100).animate({backgroundColor:g.blinkBGColor_2},100).animate({backgroundColor:g.blinkBGColor_1},100).animate({backgroundColor:g.blinkBGColor_2},100).animate({backgroundColor:g.blinkBGColor_1},100).animate({backgroundColor:g.blinkBGColor_2},100)):(g.externalTagId===!0?(void 0===e&&a.error("externalTagId is not passed for tag -"+b),k=e):(j=Math.max.apply(null,m),j=j===-(1/0)?0:j,k=++j),c||f.trigger("tm:pushing",[b,k]),l.push(b),m.push(k),c||null!==g.AjaxPush&&null==g.AjaxPushAllTags&&a.inArray(b,g.prefilled)===-1&&a.post(g.AjaxPush,a.extend({tag:b},g.AjaxPushParameters)),o=f.data("tm_rndid")+"_"+k,p=f.data("tm_rndid")+"_Remover_"+k,q=a("<span/>").text(b).html(),r='<span class="'+d.tagClasses.call(f)+'" id="'+o+'">',r+="<span>"+q+"</span>",r+='<a href="#" class="tm-tag-remove" id="'+p+'" TagIdToRemove="'+k+'">',r+=g.tagCloseIcon+"</a></span> ",s=a(r),null!==g.tagsContainer?a(g.tagsContainer).append(s):m.length>1?(u=a("#"+f.data("tm_rndid")+"_"+m[m.length-2]),u.after(s)):f.before(s),s.find("#"+p).on("click",f,function(b){b.preventDefault();var c=parseInt(a(this).attr("TagIdToRemove"));d.spliceTag.call(f,c,b.data)}),d.refreshHiddenTagList.call(f),c||f.trigger("tm:pushed",[b,k]),d.showOrHide.call(f)),f.val(""))}},popTag:function(){var c,e,b=a(this),f=b.data("tlis"),g=b.data("tlid");g.length>0&&(c=g.pop(),e=f[f.length-1],b.trigger("tm:popping",[e,c]),f.pop(),a("#"+b.data("tm_rndid")+"_"+c).remove(),d.refreshHiddenTagList.call(b),b.trigger("tm:popped",[e,c]))},empty:function(){for(var f,b=a(this),c=b.data("tlis"),e=b.data("tlid");e.length>0;)f=e.pop(),c.pop(),a("#"+b.data("tm_rndid")+"_"+f).remove(),d.refreshHiddenTagList.call(b);b.trigger("tm:emptied",null),d.showOrHide.call(b)},tags:function(){var a=this,b=a.data("tlis");return b}},d={showOrHide:function(){var a=this,b=a.data("opts"),c=a.data("tlis");b.maxTags>0&&c.length<b.maxTags&&(a.show(),a.trigger("tm:show")),b.maxTags>0&&c.length>=b.maxTags&&(a.hide(),a.trigger("tm:hide"))},tagClasses:function(){var f,b=a(this),c=b.data("opts"),d=c.tagBaseClass,e=c.inputBaseClass;return f=d,b.attr("class")&&a.each(b.attr("class").split(" "),function(a,b){b.indexOf(e+"-")!==-1&&(f+=" "+d+b.substring(e.length))}),f+=c.tagClass?" "+c.tagClass:""},trimTag:function(b,c){var d;for(b=a.trim(b),d=0;d<b.length&&a.inArray(b.charCodeAt(d),c)===-1;d++);return b.substring(0,d)},refreshHiddenTagList:function(){var b=a(this),c=b.data("tlis"),d=b.data("lhiddenTagList");d&&a(d).val(c.join(b.data("opts").baseDelimiter)).change(),b.trigger("tm:refresh",c.join(b.data("opts").baseDelimiter))},killEvent:function(a){a.cancelBubble=!0,a.returnValue=!1,a.stopPropagation(),a.preventDefault()},keyInArray:function(b,c){return a.inArray(b.which,c)!==-1},applyDelimiter:function(b){var d=a(this);c.pushTag.call(d,a(this).val()),b.preventDefault()},prefill:function(b){var d=a(this),e=d.data("opts");a.each(b,function(a,b){e.externalTagId===!0?c.pushTag.call(d,b[e.prefillValueFieldName],!0,b[e.prefillIdFieldName]):c.pushTag.call(d,b,!0)})},pushAllTags:function(b,c){var d=a(this),e=d.data("opts"),f=d.data("tlis");e.AjaxPushAllTags&&("tm:pushed"===b.type&&a.inArray(c,e.prefilled)!==-1||a.post(e.AjaxPush,a.extend({tags:f.join(e.baseDelimiter)},e.AjaxPushParameters)))},spliceTag:function(b){var h,c=this,e=c.data("tlis"),f=c.data("tlid"),g=a.inArray(b,f);-1!==g&&(h=e[g],c.trigger("tm:splicing",[h,b]),a("#"+c.data("tm_rndid")+"_"+b).remove(),e.splice(g,1),f.splice(g,1),d.refreshHiddenTagList.call(c),c.trigger("tm:spliced",[h,b])),d.showOrHide.call(c)},init:function(e){var g,h,f=a.extend({},b,e);return f.hiddenTagListName=null===f.hiddenTagListName?"hidden-"+this.attr("name"):f.hiddenTagListName,g=f.delimeters||f.delimiters,h=[9,13,17,18,19,37,38,39,40],f.delimiterChars=[],f.delimiterKeys=[],a.each(g,function(b,c){a.inArray(c,h)!==-1?f.delimiterKeys.push(c):f.delimiterChars.push(c)}),f.baseDelimiter=String.fromCharCode(f.delimiterChars[0]||44),f.tagBaseClass="tm-tag",f.inputBaseClass="tm-input",a.isFunction(f.validator)||(f.validator=null),this.each(function(){var b=a(this),e="",g="",h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";if(b.data("tagManager"))return!1;b.data("tagManager",!0);for(var i=0;i<5;i++)g+=h.charAt(Math.floor(Math.random()*h.length));if(b.data("tm_rndid",g),b.data("opts",f).data("tlis",[]).data("tlid",[]),null===f.output?(e=a("<input/>",{type:"hidden",name:f.hiddenTagListName}),b.after(e),b.data("lhiddenTagList",e)):b.data("lhiddenTagList",a(f.output)),f.AjaxPushAllTags&&(b.on("tm:spliced",d.pushAllTags),b.on("tm:popped",d.pushAllTags),b.on("tm:pushed",d.pushAllTags)),b.on("focus keypress",function(b){a(this).popover&&a(this).popover("hide")}),f.isClearInputOnEsc&&b.on("keyup",function(b){27===b.which&&(a(this).val(""),d.killEvent(b))}),b.on("keypress",function(a){d.keyInArray(a,f.delimiterChars)&&d.applyDelimiter.call(b,a)}),b.on("keydown",function(a){13===a.which&&f.preventSubmitOnEnter&&d.killEvent(a),d.keyInArray(a,f.delimiterKeys)&&d.applyDelimiter.call(b,a)}),f.deleteTagsOnBackspace&&b.on("keydown",function(e){d.keyInArray(e,f.backspace)&&a(this).val().length<=0&&(c.popTag.call(b),d.killEvent(e))}),f.fillInputOnTagRemove&&b.on("tm:popped",function(b,c){a(this).val(c)}),b.change(function(a){/webkit/.test(navigator.userAgent.toLowerCase())||b.focus(),d.killEvent(a)}),null!==f.prefilled)"object"==typeof f.prefilled?d.prefill.call(b,f.prefilled):"string"==typeof f.prefilled?d.prefill.call(b,f.prefilled.split(f.baseDelimiter)):"function"==typeof f.prefilled&&d.prefill.call(b,f.prefilled());else if(null!==f.output){if(a(f.output)&&a(f.output).val()){a(f.output)}d.prefill.call(b,a(f.output).val().split(f.baseDelimiter))}}),this}};a.fn.tagsManager=function(b){var e=a(this);return 0 in this?c[b]?c[b].apply(e,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?(a.error("Method "+b+" does not exist."),!1):d.init.apply(this,arguments):this}}(jQuery);